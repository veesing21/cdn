(function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SIP=t():e.SIP=t()})(this,function(){return function(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)t.d(i,n,function(t){return e[t]}.bind(null,n));return i},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(2);t.DigestAuthentication=n.DigestAuthentication,t.Grammar=n.Grammar,t.IncomingRequest=n.IncomingRequestMessage,t.IncomingResponse=n.IncomingResponseMessage,t.LoggerFactory=n.LoggerFactory,t.NameAddrHeader=n.NameAddrHeader,t.OutgoingRequest=n.OutgoingRequestMessage,t.Timers=n.Timers,t.Transport=n.Transport,t.URI=n.URI;var s=r(78);t.ClientContext=s.ClientContext;var o=r(79);t.C=o.C;var a=r(80);t.DialogStatus=a.DialogStatus,t.SessionStatus=a.SessionStatus,t.TypeStrings=a.TypeStrings,t.UAStatus=a.UAStatus;var c=r(82);t.Exceptions=c.Exceptions;var u=r(83);t.Parser=u.Parser;var d=r(84);t.PublishContext=d.PublishContext;var p=r(85);t.ReferClientContext=p.ReferClientContext,t.ReferServerContext=p.ReferServerContext;var h=r(87);t.RegisterContext=h.RegisterContext;var l=r(86);t.ServerContext=l.ServerContext;var g=r(88);t.InviteClientContext=g.InviteClientContext,t.InviteServerContext=g.InviteServerContext,t.Session=g.Session;var f=r(90);t.Subscription=f.Subscription;var m=r(27),v={InviteClientTransaction:m.InviteClientTransaction,InviteServerTransaction:m.InviteServerTransaction,NonInviteClientTransaction:m.NonInviteClientTransaction,NonInviteServerTransaction:m.NonInviteServerTransaction};t.Transactions=v;var S=r(91);t.makeUserAgentCoreConfigurationFromUA=S.makeUserAgentCoreConfigurationFromUA,t.UA=S.UA;var T=r(81);t.Utils=T.Utils;var y=i.__importStar(r(102));t.Web=y;var E=o.C.version;t.version=E;var b="sip.js";t.name=b;var C=i.__importStar(r(2));t.Core=C;var R=r(104);t.SDK=R},function(e,t,r){"use strict";function i(e,t){function r(){this.constructor=e}b(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function n(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]])}return r}function s(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}function o(e,t){return function(r,i){t(r,i,e)}}function a(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function c(e,t,r,i){return new(r||(r=Promise))(function(n,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(o,a)}c((i=i.apply(e,t||[])).next())})}function u(e,t){function r(e){return function(t){return i([e,t])}}function i(r){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,s&&(o=2&r[0]?s.return:r[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,r[1])).done)return o;switch(s=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return c.label++,{value:r[1],done:!1};case 5:c.label++,s=r[1],r=[0];continue;case 7:r=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){c=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){c.label=r[1];break}if(6===r[0]&&c.label<o[1]){c.label=o[1],o=r;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(r);break}o[2]&&c.ops.pop(),c.trys.pop();continue}r=t.call(e,c)}catch(e){r=[6,e],s=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var n,s,o,a,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a}function d(e,t){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}function p(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function h(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,s=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return o}function l(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(h(arguments[t]));return e}function g(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,n++)i[n]=s[o];return i}function f(e){return this instanceof f?(this.v=e,this):new f(e)}function m(e,t,r){function i(e){d[e]&&(u[e]=function(t){return new Promise(function(r,i){p.push([e,t,r,i])>1||n(e,t)})})}function n(e,t){try{s(d[e](t))}catch(e){c(p[0][3],e)}}function s(e){e.value instanceof f?Promise.resolve(e.value.v).then(o,a):c(p[0][2],e)}function o(e){n("next",e)}function a(e){n("throw",e)}function c(e,t){e(t),p.shift(),p.length&&n(p[0][0],p[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u,d=r.apply(e,t||[]),p=[];return u={},i("next"),i("throw"),i("return"),u[Symbol.asyncIterator]=function(){return this},u}function v(e){function t(t,n){r[t]=e[t]?function(r){return(i=!i)?{value:f(e[t](r)),done:"return"===t}:n?n(r):r}:n}var r,i;return r={},t("next"),t("throw",function(e){throw e}),t("return"),r[Symbol.iterator]=function(){return this},r}function S(e){function t(t){i[t]=e[t]&&function(i){return new Promise(function(n,s){i=e[t](i),r(n,s,i.done,i.value)})}}function r(e,t,r,i){Promise.resolve(i).then(function(t){e({value:t,done:r})},t)}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof p?p(e):e[Symbol.iterator](),i={},t("next"),t("throw"),t("return"),i[Symbol.asyncIterator]=function(){return this},i)}function T(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function y(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function E(e){return e&&e.__esModule?e:{default:e}}r.r(t),r.d(t,"__extends",function(){return i}),r.d(t,"__assign",function(){return C}),r.d(t,"__rest",function(){return n}),r.d(t,"__decorate",function(){return s}),r.d(t,"__param",function(){return o}),r.d(t,"__metadata",function(){return a}),r.d(t,"__awaiter",function(){return c}),r.d(t,"__generator",function(){return u}),r.d(t,"__exportStar",function(){return d}),r.d(t,"__values",function(){return p}),r.d(t,"__read",function(){return h}),r.d(t,"__spread",function(){return l}),r.d(t,"__spreadArrays",function(){return g}),r.d(t,"__await",function(){return f}),r.d(t,"__asyncGenerator",function(){return m}),r.d(t,"__asyncDelegator",function(){return v}),r.d(t,"__asyncValues",function(){return S}),r.d(t,"__makeTemplateObject",function(){return T}),r.d(t,"__importStar",function(){return y}),r.d(t,"__importDefault",function(){return E});var b=function(e,t){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},b(e,t)},C=function(){return C=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r],t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},C.apply(this,arguments)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1);i.__exportStar(r(3),t),i.__exportStar(r(31),t),i.__exportStar(r(60),t),i.__exportStar(r(5),t),i.__exportStar(r(24),t),i.__exportStar(r(56),t),i.__exportStar(r(27),t),i.__exportStar(r(64),t),i.__exportStar(r(66),t),i.__exportStar(r(26),t),i.__exportStar(r(77),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1);i.__exportStar(r(4),t),i.__exportStar(r(23),t),i.__exportStar(r(55),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(5),n=function(){function e(e,t){this.core=e,this.dialogState=t,this.core.dialogs.set(this.id,this)}return e.initialDialogStateForUserAgentClient=function(e,t){var r=!1,n=t.getHeaders("record-route").reverse(),s=t.parseHeader("contact");if(!s)throw new Error("Contact undefined.");if(!(s instanceof i.NameAddrHeader))throw new Error("Contact not instance of NameAddrHeader.");var o=s.uri,a=e.cseq,c=void 0,u=e.callId,d=e.fromTag,p=t.toTag;if(!u)throw new Error("Call id undefined.");if(!d)throw new Error("From tag undefined.");if(!p)throw new Error("To tag undefined.");if(!e.from)throw new Error("From undefined.");if(!e.to)throw new Error("To undefined.");var h=e.from.uri,l=e.to.uri;if(!t.statusCode)throw new Error("Incoming response status code undefined.");var g=t.statusCode<200,f={id:u+d+p,early:g,callId:u,localTag:d,remoteTag:p,localSequenceNumber:a,remoteSequenceNumber:c,localURI:h,remoteURI:l,remoteTarget:o,routeSet:n,secure:r};return f},e.initialDialogStateForUserAgentServer=function(e,t,r){void 0===r&&(r=!1);var n=!1,s=e.getHeaders("record-route"),o=e.parseHeader("contact");if(!o)throw new Error("Contact undefined.");if(!(o instanceof i.NameAddrHeader))throw new Error("Contact not instance of NameAddrHeader.");var a=o.uri,c=e.cseq,u=void 0,d=e.callId,p=t,h=e.fromTag,l=e.from.uri,g=e.to.uri,f={id:d+p+h,early:r,callId:d,localTag:p,remoteTag:h,localSequenceNumber:u,remoteSequenceNumber:c,localURI:g,remoteURI:l,remoteTarget:a,routeSet:s,secure:n};return f},e.prototype.dispose=function(){this.core.dialogs.delete(this.id)},Object.defineProperty(e.prototype,"id",{get:function(){return this.dialogState.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"early",{get:function(){return this.dialogState.early},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"callId",{get:function(){return this.dialogState.callId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localTag",{get:function(){return this.dialogState.localTag},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remoteTag",{get:function(){return this.dialogState.remoteTag},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localSequenceNumber",{get:function(){return this.dialogState.localSequenceNumber},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remoteSequenceNumber",{get:function(){return this.dialogState.remoteSequenceNumber},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localURI",{get:function(){return this.dialogState.localURI},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remoteURI",{get:function(){return this.dialogState.remoteURI},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remoteTarget",{get:function(){return this.dialogState.remoteTarget},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"routeSet",{get:function(){return this.dialogState.routeSet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"secure",{get:function(){return this.dialogState.secure},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"userAgentCore",{get:function(){return this.core},enumerable:!0,configurable:!0}),e.prototype.confirm=function(){this.dialogState.early=!1},e.prototype.receiveRequest=function(e){if(e.method!==i.C.ACK){if(this.remoteSequenceNumber){if(e.cseq<=this.remoteSequenceNumber)throw new Error("Out of sequence in dialog request. Did you forget to call sequenceGuard()?");this.dialogState.remoteSequenceNumber=e.cseq}this.remoteSequenceNumber||(this.dialogState.remoteSequenceNumber=e.cseq)}},e.prototype.recomputeRouteSet=function(e){this.dialogState.routeSet=e.getHeaders("record-route").reverse()},e.prototype.createOutgoingRequestMessage=function(e,t){var r,i=this.remoteURI,n=this.remoteTag,s=this.localURI,o=this.localTag,a=this.callId;r=t&&t.cseq?t.cseq:this.dialogState.localSequenceNumber?this.dialogState.localSequenceNumber+=1:this.dialogState.localSequenceNumber=1;var c=this.remoteTarget,u=this.routeSet,d=t&&t.extraHeaders,p=t&&t.body,h=this.userAgentCore.makeOutgoingRequestMessage(e,c,s,i,{callId:a,cseq:r,fromTag:o,toTag:n,routeSet:u},d,p);return h},e.prototype.sequenceGuard=function(e){return e.method===i.C.ACK||(!(this.remoteSequenceNumber&&e.cseq<=this.remoteSequenceNumber)||(this.core.replyStateless(e,{statusCode:500}),!1))},e}();t.Dialog=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1);i.__exportStar(r(6),t),i.__exportStar(r(8),t),i.__exportStar(r(19),t),i.__exportStar(r(11),t),i.__exportStar(r(10),t),i.__exportStar(r(9),t),i.__exportStar(r(17),t),i.__exportStar(r(13),t),i.__exportStar(r(18),t),i.__exportStar(r(22),t),i.__exportStar(r(14),t),i.__exportStar(r(15),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1);i.__exportStar(r(7),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ACK="ACK",e.BYE="BYE",e.CANCEL="CANCEL",e.INFO="INFO",e.INVITE="INVITE",e.MESSAGE="MESSAGE",e.NOTIFY="NOTIFY",e.OPTIONS="OPTIONS",e.REGISTER="REGISTER",e.UPDATE="UPDATE",e.SUBSCRIBE="SUBSCRIBE",e.PUBLISH="PUBLISH",e.REFER="REFER",e.PRACK="PRACK"}(t.C||(t.C={}))},function(e,t,r){"use strict";function i(e){var t="string"==typeof e?e:e.body,r="string"==typeof e?"application/sdp":e.contentType,i=o(r),n={contentDisposition:i,contentType:r,content:t};return n}function n(e){var t,r,i;if(e instanceof a.IncomingRequestMessage&&e.body){var n=e.parseHeader("Content-Disposition");t=n?n.type:void 0,r=e.parseHeader("Content-Type"),i=e.body}if(e instanceof c.IncomingResponseMessage&&e.body){n=e.parseHeader("Content-Disposition");t=n?n.type:void 0,r=e.parseHeader("Content-Type"),i=e.body}if(e instanceof u.OutgoingRequestMessage&&e.body)if(t=e.getHeader("Content-Disposition"),r=e.getHeader("Content-Type"),"string"==typeof e.body){if(!r)throw new Error("Header content type header does not equal body content type.");i=e.body}else{if(r&&r!==e.body.contentType)throw new Error("Header content type header does not equal body content type.");r=e.body.contentType,i=e.body.body}if(s(e)&&(t=e.contentDisposition,r=e.contentType,i=e.content),i){if(r&&!t&&(t=o(r)),!t)throw new Error("Content disposition undefined.");if(!r)throw new Error("Content type undefined.");return{contentDisposition:t,contentType:r,content:i}}}function s(e){return!(!e||"string"!=typeof e.content||"string"!=typeof e.contentType||void 0!==e.contentDisposition)||"string"==typeof e.contentDisposition}function o(e){return"application/sdp"===e?"session":"render"}Object.defineProperty(t,"__esModule",{value:!0});var a=r(9),c=r(17),u=r(18);t.fromBodyLegacy=i,t.getBody=n,t.isBody=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(10),s=function(e){function t(){return e.call(this)||this}return i.__extends(t,e),t}(n.IncomingMessage);t.IncomingRequestMessage=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(11),n=r(16),s=function(){function e(){this.headers={}}return e.prototype.addHeader=function(e,t){var r={raw:t};e=n.headerize(e),this.headers[e]?this.headers[e].push(r):this.headers[e]=[r]},e.prototype.getHeader=function(e){var t=this.headers[n.headerize(e)];if(t)return t[0]?t[0].raw:void 0},e.prototype.getHeaders=function(e){var t=this.headers[n.headerize(e)],r=[];if(!t)return[];for(var i=0,s=t;i<s.length;i++){var o=s[i];r.push(o.raw)}return r},e.prototype.hasHeader=function(e){return!!this.headers[n.headerize(e)]},e.prototype.parseHeader=function(e,t){if(void 0===t&&(t=0),e=n.headerize(e),this.headers[e]&&!(t>=this.headers[e].length)){var r=this.headers[e][t],s=r.raw;if(r.parsed)return r.parsed;var o=i.Grammar.parse(s,e.replace(/-/g,"_"));return-1===o?void this.headers[e].splice(t,1):(r.parsed=o,o)}},e.prototype.s=function(e,t){return void 0===t&&(t=0),this.parseHeader(e,t)},e.prototype.setHeader=function(e,t){this.headers[n.headerize(e)]=[{raw:t}]},e.prototype.toString=function(){return this.data},e}();t.IncomingMessage=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=i.__importStar(r(12));(function(e){function t(e,t){var r={startRule:t};try{n.parse(e,r)}catch(e){r.data=-1}return r.data}function r(t){var r=e.parse(t,"Name_Addr_Header");return-1!==r?r:void 0}function i(t){var r=e.parse(t,"SIP_URI");return-1!==r?r:void 0}e.parse=t,e.nameAddrHeaderParse=r,e.URIParse=i})(t.Grammar||(t.Grammar={}))},function(e,t,r){"use strict";function i(e,t){function r(){return e.substring(R,C)}function i(){return p(R,C)}function n(e,t){return{type:"literal",text:e,ignoreCase:t}}function c(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function u(){return{type:"end"}}function d(t){var r,i=_[t];if(i)return i;for(r=t-1;!_[r];)r--;for(i=_[r],i={line:i.line,column:i.column};r<t;)10===e.charCodeAt(r)?(i.line++,i.column=1):i.column++,r++;return _[t]=i,i}function p(e,t){var r=d(e),i=d(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:i.line,column:i.column}}}function h(e){C<w||(C>w&&(w=C,A=[]),A.push(e))}function l(e,t,r){return new a(a.buildMessage(e,t),e,t,r)}function g(e){return e.split("").map(function(e){return e.charCodeAt(0)-32})}function f(t){for(var r,i=b[t],n=0,s=[],o=i.length,a=[],c=[];;){for(;n<o;)switch(i[n]){case 0:c.push(E[i[n+1]]),n+=2;break;case 1:c.push(void 0),n++;break;case 2:c.push(null),n++;break;case 3:c.push(S),n++;break;case 4:c.push([]),n++;break;case 5:c.push(C),n++;break;case 6:c.pop(),n++;break;case 7:C=c.pop(),n++;break;case 8:c.length-=i[n+1],n+=2;break;case 9:c.splice(-2,1),n++;break;case 10:c[c.length-2].push(c.pop()),n++;break;case 11:c.push(c.splice(c.length-i[n+1],i[n+1])),n+=2;break;case 12:c.push(e.substring(c.pop(),C)),n++;break;case 13:a.push(o),s.push(n+3+i[n+1]+i[n+2]),c[c.length-1]?(o=n+3+i[n+1],n+=3):(o=n+3+i[n+1]+i[n+2],n+=3+i[n+1]);break;case 14:a.push(o),s.push(n+3+i[n+1]+i[n+2]),c[c.length-1]===S?(o=n+3+i[n+1],n+=3):(o=n+3+i[n+1]+i[n+2],n+=3+i[n+1]);break;case 15:a.push(o),s.push(n+3+i[n+1]+i[n+2]),c[c.length-1]!==S?(o=n+3+i[n+1],n+=3):(o=n+3+i[n+1]+i[n+2],n+=3+i[n+1]);break;case 16:c[c.length-1]!==S?(a.push(o),s.push(n),o=n+2+i[n+1],n+=2):n+=2+i[n+1];break;case 17:a.push(o),s.push(n+3+i[n+1]+i[n+2]),e.length>C?(o=n+3+i[n+1],n+=3):(o=n+3+i[n+1]+i[n+2],n+=3+i[n+1]);break;case 18:a.push(o),s.push(n+4+i[n+2]+i[n+3]),e.substr(C,E[i[n+1]].length)===E[i[n+1]]?(o=n+4+i[n+2],n+=4):(o=n+4+i[n+2]+i[n+3],n+=4+i[n+2]);break;case 19:a.push(o),s.push(n+4+i[n+2]+i[n+3]),e.substr(C,E[i[n+1]].length).toLowerCase()===E[i[n+1]]?(o=n+4+i[n+2],n+=4):(o=n+4+i[n+2]+i[n+3],n+=4+i[n+2]);break;case 20:a.push(o),s.push(n+4+i[n+2]+i[n+3]),E[i[n+1]].test(e.charAt(C))?(o=n+4+i[n+2],n+=4):(o=n+4+i[n+2]+i[n+3],n+=4+i[n+2]);break;case 21:c.push(e.substr(C,i[n+1])),C+=i[n+1],n+=2;break;case 22:c.push(E[i[n+1]]),C+=E[i[n+1]].length,n+=2;break;case 23:c.push(S),0===I&&h(E[i[n+1]]),n+=2;break;case 24:R=c[c.length-1-i[n+1]],n+=2;break;case 25:R=C,n++;break;case 26:r=i.slice(n+4,n+4+i[n+3]).map(function(e){return c[c.length-1-e]}),c.splice(c.length-i[n+2],i[n+2],E[i[n+1]].apply(null,r)),n+=4+i[n+3];break;case 27:c.push(f(i[n+1])),n+=2;break;case 28:I++,n++;break;case 29:I--,n++;break;default:throw new Error("Invalid opcode: "+i[n]+".")}if(!(a.length>0))break;o=a.pop(),n=s.pop()}return c[0]}function m(e,t){return[e].concat(t)}t=void 0!==t?t:{};var v,S={},T={Contact:119,Name_Addr_Header:156,Record_Route:176,Request_Response:81,SIP_URI:45,Subscription_State:186,Supported:191,Require:182,Via:194,absoluteURI:84,Call_ID:118,Content_Disposition:130,Content_Length:135,Content_Type:136,CSeq:146,displayName:122,Event:149,From:151,host:52,Max_Forwards:154,Min_SE:213,Proxy_Authenticate:157,quoted_string:40,Refer_To:178,Replaces:179,Session_Expires:210,stun_URI:217,To:192,turn_URI:223,uuid:226,WWW_Authenticate:209,challenge:158,sipfrag:230,Referred_By:231},y=119,E=["\r\n",n("\r\n",!1),/^[0-9]/,c([["0","9"]],!1,!1),/^[a-zA-Z]/,c([["a","z"],["A","Z"]],!1,!1),/^[0-9a-fA-F]/,c([["0","9"],["a","f"],["A","F"]],!1,!1),/^[\0-\xFF]/,c([["\0","√ø"]],!1,!1),/^["]/,c(['"'],!1,!1)," ",n(" ",!1),"\t",n("\t",!1),/^[a-zA-Z0-9]/,c([["a","z"],["A","Z"],["0","9"]],!1,!1),";",n(";",!1),"/",n("/",!1),"?",n("?",!1),":",n(":",!1),"@",n("@",!1),"&",n("&",!1),"=",n("=",!1),"+",n("+",!1),"$",n("$",!1),",",n(",",!1),"-",n("-",!1),"_",n("_",!1),".",n(".",!1),"!",n("!",!1),"~",n("~",!1),"*",n("*",!1),"'",n("'",!1),"(",n("(",!1),")",n(")",!1),"%",n("%",!1),function(){return" "},function(){return":"},/^[!-~]/,c([["!","~"]],!1,!1),/^[\x80-\uFFFF]/,c([["¬Ä","Ôøø"]],!1,!1),/^[\x80-\xBF]/,c([["¬Ä","¬ø"]],!1,!1),/^[a-f]/,c([["a","f"]],!1,!1),"`",n("`",!1),"<",n("<",!1),">",n(">",!1),"\\",n("\\",!1),"[",n("[",!1),"]",n("]",!1),"{",n("{",!1),"}",n("}",!1),function(){return"*"},function(){return"/"},function(){return"="},function(){return"("},function(){return")"},function(){return">"},function(){return"<"},function(){return","},function(){return";"},function(){return":"},function(){return'"'},/^[!-']/,c([["!","'"]],!1,!1),/^[*-[]/,c([["*","["]],!1,!1),/^[\]-~]/,c([["]","~"]],!1,!1),function(e){return e},/^[#-[]/,c([["#","["]],!1,!1),/^[\0-\t]/,c([["\0","\t"]],!1,!1),/^[\x0B-\f]/,c([["\v","\f"]],!1,!1),/^[\x0E-\x7F]/,c([["",""]],!1,!1),function(){t=t||{data:{}},t.data.uri=new o.URI(t.data.scheme,t.data.user,t.data.host,t.data.port),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port},function(){t=t||{data:{}},t.data.uri=new o.URI(t.data.scheme,t.data.user,t.data.host,t.data.port,t.data.uri_params,t.data.uri_headers),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port,delete t.data.uri_params,"SIP_URI"===t.startRule&&(t.data=t.data.uri)},"sips",n("sips",!0),"sip",n("sip",!0),function(e){t=t||{data:{}},t.data.scheme=e},function(){t=t||{data:{}},t.data.user=decodeURIComponent(r().slice(0,-1))},function(){t=t||{data:{}},t.data.password=r()},function(){return t=t||{data:{}},t.data.host=r(),t.data.host},function(){return t=t||{data:{}},t.data.host_type="domain",r()},/^[a-zA-Z0-9_\-]/,c([["a","z"],["A","Z"],["0","9"],"_","-"],!1,!1),/^[a-zA-Z0-9\-]/,c([["a","z"],["A","Z"],["0","9"],"-"],!1,!1),function(){return t=t||{data:{}},t.data.host_type="IPv6",r()},"::",n("::",!1),function(){return t=t||{data:{}},t.data.host_type="IPv6",r()},function(){return t=t||{data:{}},t.data.host_type="IPv4",r()},"25",n("25",!1),/^[0-5]/,c([["0","5"]],!1,!1),"2",n("2",!1),/^[0-4]/,c([["0","4"]],!1,!1),"1",n("1",!1),/^[1-9]/,c([["1","9"]],!1,!1),function(e){return t=t||{data:{}},e=parseInt(e.join("")),t.data.port=e,e},"transport=",n("transport=",!0),"udp",n("udp",!0),"tcp",n("tcp",!0),"sctp",n("sctp",!0),"tls",n("tls",!0),function(e){t=t||{data:{}},t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.transport=e.toLowerCase()},"user=",n("user=",!0),"phone",n("phone",!0),"ip",n("ip",!0),function(e){t=t||{data:{}},t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.user=e.toLowerCase()},"method=",n("method=",!0),function(e){t=t||{data:{}},t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.method=e},"ttl=",n("ttl=",!0),function(e){t=t||{data:{}},t.data.params||(t.data.params={}),t.data.params.ttl=e},"maddr=",n("maddr=",!0),function(e){t=t||{data:{}},t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.maddr=e},"lr",n("lr",!0),function(){t=t||{data:{}},t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.lr=void 0},function(e,r){t=t||{data:{}},t.data.uri_params||(t.data.uri_params={}),r=null===r?void 0:r[1],t.data.uri_params[e.toLowerCase()]=r},function(e,r){e=e.join("").toLowerCase(),r=r.join(""),t=t||{data:{}},t.data.uri_headers||(t.data.uri_headers={}),t.data.uri_headers[e]?t.data.uri_headers[e].push(r):t.data.uri_headers[e]=[r]},function(){t=t||{data:{}},"Refer_To"===t.startRule&&(t.data.uri=new o.URI(t.data.scheme,t.data.user,t.data.host,t.data.port,t.data.uri_params,t.data.uri_headers),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port,delete t.data.uri_params)},"//",n("//",!1),function(){t=t||{data:{}},t.data.scheme=r()},n("SIP",!0),function(){t=t||{data:{}},t.data.sip_version=r()},"INVITE",n("INVITE",!1),"ACK",n("ACK",!1),"VXACH",n("VXACH",!1),"OPTIONS",n("OPTIONS",!1),"BYE",n("BYE",!1),"CANCEL",n("CANCEL",!1),"REGISTER",n("REGISTER",!1),"SUBSCRIBE",n("SUBSCRIBE",!1),"NOTIFY",n("NOTIFY",!1),"REFER",n("REFER",!1),"PUBLISH",n("PUBLISH",!1),function(){return t=t||{data:{}},t.data.method=r(),t.data.method},function(e){t=t||{data:{}},t.data.status_code=parseInt(e.join(""))},function(){t=t||{data:{}},t.data.reason_phrase=r()},function(){t=t||{data:{}},t.data=r()},function(){var e,r;for(t=t||{data:{}},r=t.data.multi_header.length,e=0;e<r;e++)if(null===t.data.multi_header[e].parsed){t.data=null;break}null!==t.data?t.data=t.data.multi_header:t.data=-1},function(){var e;t=t||{data:{}},t.data.multi_header||(t.data.multi_header=[]);try{e=new s.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),delete t.data.uri,delete t.data.displayName,delete t.data.params}catch(t){e=null}t.data.multi_header.push({position:C,offset:i().start.offset,parsed:e})},function(e){e=r().trim(),'"'===e[0]&&(e=e.substring(1,e.length-1)),t=t||{data:{}},t.data.displayName=e},"q",n("q",!0),function(e){t=t||{data:{}},t.data.params||(t.data.params={}),t.data.params.q=e},"expires",n("expires",!0),function(e){t=t||{data:{}},t.data.params||(t.data.params={}),t.data.params.expires=e},function(e){return parseInt(e.join(""))},"0",n("0",!1),function(){return parseFloat(r())},function(e,r){t=t||{data:{}},t.data.params||(t.data.params={}),r=null===r?void 0:r[1],t.data.params[e.toLowerCase()]=r},"render",n("render",!0),"session",n("session",!0),"icon",n("icon",!0),"alert",n("alert",!0),function(){t=t||{data:{}},"Content_Disposition"===t.startRule&&(t.data.type=r().toLowerCase())},"handling",n("handling",!0),"optional",n("optional",!0),"required",n("required",!0),function(e){t=t||{data:{}},t.data=parseInt(e.join(""))},function(){t=t||{data:{}},t.data=r()},"text",n("text",!0),"image",n("image",!0),"audio",n("audio",!0),"video",n("video",!0),"application",n("application",!0),"message",n("message",!0),"multipart",n("multipart",!0),"x-",n("x-",!0),function(e){t=t||{data:{}},t.data.value=parseInt(e.join(""))},function(e){t=t||{data:{}},t.data=e},function(e){t=t||{data:{}},t.data.event=e.toLowerCase()},function(){t=t||{data:{}};var e=t.data.tag;t.data=new s.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),e&&t.data.setParam("tag",e)},"tag",n("tag",!0),function(e){t=t||{data:{}},t.data.tag=e},function(e){t=t||{data:{}},t.data=parseInt(e.join(""))},function(e){t=t||{data:{}},t.data=e},function(){t=t||{data:{}},t.data=new s.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params)},"digest",n("Digest",!0),"realm",n("realm",!0),function(e){t=t||{data:{}},t.data.realm=e},"domain",n("domain",!0),"nonce",n("nonce",!0),function(e){t=t||{data:{}},t.data.nonce=e},"opaque",n("opaque",!0),function(e){t=t||{data:{}},t.data.opaque=e},"stale",n("stale",!0),"true",n("true",!0),function(){t=t||{data:{}},t.data.stale=!0},"false",n("false",!0),function(){t=t||{data:{}},t.data.stale=!1},"algorithm",n("algorithm",!0),"md5",n("MD5",!0),"md5-sess",n("MD5-sess",!0),function(e){t=t||{data:{}},t.data.algorithm=e.toUpperCase()},"qop",n("qop",!0),"auth-int",n("auth-int",!0),"auth",n("auth",!0),function(e){t=t||{data:{}},t.data.qop||(t.data.qop=[]),t.data.qop.push(e.toLowerCase())},function(e){t=t||{data:{}},t.data.value=parseInt(e.join(""))},function(){var e,r;for(t=t||{data:{}},r=t.data.multi_header.length,e=0;e<r;e++)if(null===t.data.multi_header[e].parsed){t.data=null;break}null!==t.data?t.data=t.data.multi_header:t.data=-1},function(){var e;t=t||{data:{}},t.data.multi_header||(t.data.multi_header=[]);try{e=new s.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),delete t.data.uri,delete t.data.displayName,delete t.data.params}catch(t){e=null}t.data.multi_header.push({position:C,offset:i().start.offset,parsed:e})},function(){t=t||{data:{}},t.data=new s.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params)},function(){t=t||{data:{}},t.data.replaces_from_tag&&t.data.replaces_to_tag||(t.data=-1)},function(){t=t||{data:{}},t.data={call_id:t.data}},"from-tag",n("from-tag",!0),function(e){t=t||{data:{}},t.data.replaces_from_tag=e},"to-tag",n("to-tag",!0),function(e){t=t||{data:{}},t.data.replaces_to_tag=e},"early-only",n("early-only",!0),function(){t=t||{data:{}},t.data.early_only=!0},function(e,t){return t},function(e,t){return m(e,t)},function(e){t=t||{data:{}},"Require"===t.startRule&&(t.data=e||[])},function(e){t=t||{data:{}},t.data.value=parseInt(e.join(""))},"active",n("active",!0),"pending",n("pending",!0),"terminated",n("terminated",!0),function(){t=t||{data:{}},t.data.state=r()},"reason",n("reason",!0),function(e){t=t||{data:{}},void 0!==e&&(t.data.reason=e)},function(e){t=t||{data:{}},void 0!==e&&(t.data.expires=e)},"retry_after",n("retry_after",!0),function(e){t=t||{data:{}},void 0!==e&&(t.data.retry_after=e)},"deactivated",n("deactivated",!0),"probation",n("probation",!0),"rejected",n("rejected",!0),"timeout",n("timeout",!0),"giveup",n("giveup",!0),"noresource",n("noresource",!0),"invariant",n("invariant",!0),function(e){t=t||{data:{}},"Supported"===t.startRule&&(t.data=e||[])},function(){t=t||{data:{}};var e=t.data.tag;t.data=new s.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),e&&t.data.setParam("tag",e)},"ttl",n("ttl",!0),function(e){t=t||{data:{}},t.data.ttl=e},"maddr",n("maddr",!0),function(e){t=t||{data:{}},t.data.maddr=e},"received",n("received",!0),function(e){t=t||{data:{}},t.data.received=e},"branch",n("branch",!0),function(e){t=t||{data:{}},t.data.branch=e},"rport",n("rport",!0),function(e){t=t||{data:{}},void 0!==e&&(t.data.rport=e.join(""))},function(e){t=t||{data:{}},t.data.protocol=e},n("UDP",!0),n("TCP",!0),n("TLS",!0),n("SCTP",!0),function(e){t=t||{data:{}},t.data.transport=e},function(){t=t||{data:{}},t.data.host=r()},function(e){t=t||{data:{}},t.data.port=parseInt(e.join(""))},function(e){return parseInt(e.join(""))},function(e){t=t||{data:{}},"Session_Expires"===t.startRule&&(t.data.deltaSeconds=e)},"refresher",n("refresher",!1),"uas",n("uas",!1),"uac",n("uac",!1),function(e){t=t||{data:{}},"Session_Expires"===t.startRule&&(t.data.refresher=e)},function(e){t=t||{data:{}},"Min_SE"===t.startRule&&(t.data=e)},"stuns",n("stuns",!0),"stun",n("stun",!0),function(e){t=t||{data:{}},t.data.scheme=e},function(e){t=t||{data:{}},t.data.host=e},"?transport=",n("?transport=",!1),"turns",n("turns",!0),"turn",n("turn",!0),function(e){t=t||{data:{}
},t.data.transport=e},function(){t=t||{data:{}},t.data=r()},"Referred-By",n("Referred-By",!1),"b",n("b",!1),"cid",n("cid",!1)],b=[g('2 ""6 7!'),g('4"""5!7#'),g('4$""5!7%'),g('4&""5!7\''),g(";'.# &;("),g('4(""5!7)'),g('4*""5!7+'),g('2,""6,7-'),g('2.""6.7/'),g('40""5!71'),g('22""6273.¬â &24""6475.} &26""6677.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),g(";).# &;,"),g('2F""6F7G.} &2H""6H7I.q &2J""6J7K.e &2L""6L7M.Y &2N""6N7O.M &2P""6P7Q.A &2R""6R7S.5 &2T""6T7U.) &2V""6V7W'),g('%%2X""6X7Y/5#;#/,$;#/#$+#)(#\'#("\'#&\'#/"!&,)'),g('%%$;$0#*;$&/,#; /#$+")("\'#&\'#." &"/=#$;$/&#0#*;$&&&#/\'$8":Z" )("\'#&\'#'),g(';.." &"'),g("%$;'.# &;(0)*;'.# &;(&/?#28\"\"6879/0$;//'$8#:[# )(#'#(\"'#&'#"),g('%%$;2/&#0#*;2&&&#/g#$%$;.0#*;.&/,#;2/#$+")("\'#&\'#0=*%$;.0#*;.&/,#;2/#$+")("\'#&\'#&/#$+")("\'#&\'#/"!&,)'),g('4\\""5!7].# &;3'),g('4^""5!7_'),g('4`""5!7a'),g(';!.) &4b""5!7c'),g('%$;).¬ï &2F""6F7G.¬â &2J""6J7K.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O/¬û#0¬õ*;).¬ï &2F""6F7G.¬â &2J""6J7K.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O&&&#/"!&,)'),g('%$;).¬â &2F""6F7G.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O/¬í#0¬è*;).¬â &2F""6F7G.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O&&&#/"!&,)'),g('2T""6T7U.√£ &2V""6V7W.√ó &2f""6f7g.√ã &2h""6h7i.¬ø &2:""6:7;.¬≥ &2D""6D7E.¬ß &22""6273.¬õ &28""6879.¬è &2j""6j7k.¬É &;&.} &24""6475.q &2l""6l7m.e &2n""6n7o.Y &26""6677.M &2>""6>7?.A &2p""6p7q.5 &2r""6r7s.) &;\'.# &;('),g('%$;).ƒ´ &2F""6F7G.ƒü &2J""6J7K.ƒì &2L""6L7M.ƒá &2X""6X7Y.√ª &2P""6P7Q.√Ø &2H""6H7I.√£ &2@""6@7A.√ó &2d""6d7e.√ã &2R""6R7S.¬ø &2N""6N7O.¬≥ &2T""6T7U.¬ß &2V""6V7W.¬õ &2f""6f7g.¬è &2h""6h7i.¬É &28""6879.w &2j""6j7k.k &;&.e &24""6475.Y &2l""6l7m.M &2n""6n7o.A &26""6677.5 &2p""6p7q.) &2r""6r7s/ƒ¥#0ƒ±*;).ƒ´ &2F""6F7G.ƒü &2J""6J7K.ƒì &2L""6L7M.ƒá &2X""6X7Y.√ª &2P""6P7Q.√Ø &2H""6H7I.√£ &2@""6@7A.√ó &2d""6d7e.√ã &2R""6R7S.¬ø &2N""6N7O.¬≥ &2T""6T7U.¬ß &2V""6V7W.¬õ &2f""6f7g.¬è &2h""6h7i.¬É &28""6879.w &2j""6j7k.k &;&.e &24""6475.Y &2l""6l7m.M &2n""6n7o.A &26""6677.5 &2p""6p7q.) &2r""6r7s&&&#/"!&,)'),g("%;//?#2P\"\"6P7Q/0$;//'$8#:t# )(#'#(\"'#&'#"),g("%;//?#24\"\"6475/0$;//'$8#:u# )(#'#(\"'#&'#"),g("%;//?#2>\"\"6>7?/0$;//'$8#:v# )(#'#(\"'#&'#"),g("%;//?#2T\"\"6T7U/0$;//'$8#:w# )(#'#(\"'#&'#"),g("%;//?#2V\"\"6V7W/0$;//'$8#:x# )(#'#(\"'#&'#"),g('%2h""6h7i/0#;//\'$8":y" )("\'#&\'#'),g('%;//6#2f""6f7g/\'$8":z" )("\'#&\'#'),g("%;//?#2D\"\"6D7E/0$;//'$8#:{# )(#'#(\"'#&'#"),g("%;//?#22\"\"6273/0$;//'$8#:|# )(#'#(\"'#&'#"),g("%;//?#28\"\"6879/0$;//'$8#:}# )(#'#(\"'#&'#"),g("%;//0#;&/'$8\":~\" )(\"'#&'#"),g("%;&/0#;//'$8\":~\" )(\"'#&'#"),g("%;=/T#$;G.) &;K.# &;F0/*;G.) &;K.# &;F&/,$;>/#$+#)(#'#(\"'#&'#"),g('4""5!7¬Ä.A &4¬Å""5!7¬Ç.5 &4¬É""5!7¬Ñ.) &;3.# &;.'),g("%%;//Q#;&/H$$;J.# &;K0)*;J.# &;K&/,$;&/#$+$)($'#(#'#(\"'#&'#/\"!&,)"),g("%;//]#;&/T$%$;J.# &;K0)*;J.# &;K&/\"!&,)/1$;&/($8$:¬Ö$!!)($'#(#'#(\"'#&'#"),g(';..G &2L""6L7M.; &4¬Ü""5!7¬á./ &4¬É""5!7¬Ñ.# &;3'),g('%2j""6j7k/J#4¬à""5!7¬â.5 &4¬ä""5!7¬ã.) &4¬å""5!7¬ç/#$+")("\'#&\'#'),g("%;N/M#28\"\"6879/>$;O.\" &\"/0$;S/'$8$:¬é$ )($'#(#'#(\"'#&'#"),g("%;N/d#28\"\"6879/U$;O.\" &\"/G$;S/>$;_/5$;l.\" &\"/'$8&:¬è& )(&'#(%'#($'#(#'#(\"'#&'#"),g('%3¬ê""5$7¬ë.) &3¬í""5#7¬ì/\' 8!:¬î!! )'),g('%;P/]#%28""6879/,#;R/#$+")("\'#&\'#." &"/6$2:""6:7;/\'$8#:¬ï# )(#\'#("\'#&\'#'),g("$;+.) &;-.# &;Q/2#0/*;+.) &;-.# &;Q&&&#"),g('2<""6<7=.q &2>""6>7?.e &2@""6@7A.Y &2B""6B7C.M &2D""6D7E.A &22""6273.5 &26""6677.) &24""6475'),g('%$;+._ &;-.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E0e*;+._ &;-.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E&/& 8!:¬ñ! )'),g('%;T/J#%28""6879/,#;^/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),g("%;U.) &;\\.# &;X/& 8!:¬ó! )"),g('%$%;V/2#2J""6J7K/#$+")("\'#&\'#0<*%;V/2#2J""6J7K/#$+")("\'#&\'#&/D#;W/;$2J""6J7K." &"/\'$8#:¬ò# )(#\'#("\'#&\'#'),g('$4¬ô""5!7¬ö/,#0)*4¬ô""5!7¬ö&&&#'),g('%4$""5!7%/?#$4¬õ""5!7¬ú0)*4¬õ""5!7¬ú&/#$+")("\'#&\'#'),g('%2l""6l7m/?#;Y/6$2n""6n7o/\'$8#:¬ù# )(#\'#("\'#&\'#'),g('%%;Z/¬≥#28""6879/¬§$;Z/¬õ$28""6879/¬å$;Z/¬É$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+-)(-\'#(,\'#(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ﬁê &%2¬û""6¬û7¬ü/¬§#;Z/¬õ$28""6879/¬å$;Z/¬É$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+,)(,\'#(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.€π &%2¬û""6¬û7¬ü/¬å#;Z/¬É$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+*)(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Ÿ∫ &%2¬û""6¬û7¬ü/t#;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ÿì &%2¬û""6¬û7¬ü/\\#;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+&)(&\'#(%\'#($\'#(#\'#("\'#&\'#.◊Ñ &%2¬û""6¬û7¬ü/D#;Z/;$28""6879/,$;[/#$+$)($\'#(#\'#("\'#&\'#.÷ç &%2¬û""6¬û7¬ü/,#;[/#$+")("\'#&\'#.’Æ &%2¬û""6¬û7¬ü/,#;Z/#$+")("\'#&\'#.’è &%;Z/¬õ#2¬û""6¬û7¬ü/¬å$;Z/¬É$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$++)(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.”á &%;Z/¬™#%28""6879/,#;Z/#$+")("\'#&\'#." &"/¬É$2¬û""6¬û7¬ü/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+*)(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.–∞ &%;Z/¬π#%28""6879/,#;Z/#$+")("\'#&\'#." &"/¬í$%28""6879/,#;Z/#$+")("\'#&\'#." &"/k$2¬û""6¬û7¬ü/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+))()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Œä &%;Z/√à#%28""6879/,#;Z/#$+")("\'#&\'#." &"/¬°$%28""6879/,#;Z/#$+")("\'#&\'#." &"/z$%28""6879/,#;Z/#$+")("\'#&\'#." &"/S$2¬û""6¬û7¬ü/D$;Z/;$28""6879/,$;[/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Àï &%;Z/√ó#%28""6879/,#;Z/#$+")("\'#&\'#." &"/¬∞$%28""6879/,#;Z/#$+")("\'#&\'#." &"/¬â$%28""6879/,#;Z/#$+")("\'#&\'#." &"/b$%28""6879/,#;Z/#$+")("\'#&\'#." &"/;$2¬û""6¬û7¬ü/,$;[/#$+\')(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.»ë &%;Z/√æ#%28""6879/,#;Z/#$+")("\'#&\'#." &"/√ó$%28""6879/,#;Z/#$+")("\'#&\'#." &"/¬∞$%28""6879/,#;Z/#$+")("\'#&\'#." &"/¬â$%28""6879/,#;Z/#$+")("\'#&\'#." &"/b$%28""6879/,#;Z/#$+")("\'#&\'#." &"/;$2¬û""6¬û7¬ü/,$;Z/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ƒ¶ &%;Z/ƒú#%28""6879/,#;Z/#$+")("\'#&\'#." &"/√µ$%28""6879/,#;Z/#$+")("\'#&\'#." &"/√é$%28""6879/,#;Z/#$+")("\'#&\'#." &"/¬ß$%28""6879/,#;Z/#$+")("\'#&\'#." &"/¬Ä$%28""6879/,#;Z/#$+")("\'#&\'#." &"/Y$%28""6879/,#;Z/#$+")("\'#&\'#." &"/2$2¬û""6¬û7¬ü/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#/& 8!:¬†! )'),g('%;#/M#;#." &"/?$;#." &"/1$;#." &"/#$+$)($\'#(#\'#("\'#&\'#'),g("%;Z/;#28\"\"6879/,$;Z/#$+#)(#'#(\"'#&'#.# &;\\"),g("%;]/o#2J\"\"6J7K/`$;]/W$2J\"\"6J7K/H$;]/?$2J\"\"6J7K/0$;]/'$8':¬°' )(''#(&'#(%'#($'#(#'#(\"'#&'#"),g('%2¬¢""6¬¢7¬£/2#4¬§""5!7¬•/#$+")("\'#&\'#.¬ò &%2¬¶""6¬¶7¬ß/;#4¬®""5!7¬©/,$;!/#$+#)(#\'#("\'#&\'#.j &%2¬™""6¬™7¬´/5#;!/,$;!/#$+#)(#\'#("\'#&\'#.B &%4¬¨""5!7¬≠/,#;!/#$+")("\'#&\'#.# &;!'),g('%%;!." &"/[#;!." &"/M$;!." &"/?$;!." &"/1$;!." &"/#$+%)(%\'#($\'#(#\'#("\'#&\'#/\' 8!:¬Æ!! )'),g('$%22""6273/,#;`/#$+")("\'#&\'#0<*%22""6273/,#;`/#$+")("\'#&\'#&'),g(";a.A &;b.; &;c.5 &;d./ &;e.) &;f.# &;g"),g('%3¬Ø""5*7¬∞/a#3¬±""5#7¬≤.G &3¬≥""5#7¬¥.; &3¬µ""5$7¬∂./ &3¬∑""5#7¬∏.# &;6/($8":¬π"! )("\'#&\'#'),g('%3¬∫""5%7¬ª/I#3¬º""5%7¬Ω./ &3¬æ""5"7¬ø.# &;6/($8":√Ä"! )("\'#&\'#'),g('%3√Å""5\'7√Ç/1#;¬ê/($8":√É"! )("\'#&\'#'),g('%3√Ñ""5$7√Ö/1#;√∞/($8":√Ü"! )("\'#&\'#'),g('%3√á""5&7√à/1#;T/($8":√â"! )("\'#&\'#'),g('%3√ä""5"7√ã/N#%2>""6>7?/,#;6/#$+")("\'#&\'#." &"/\'$8":√å" )("\'#&\'#'),g('%;h/P#%2>""6>7?/,#;i/#$+")("\'#&\'#." &"/)$8":√ç""! )("\'#&\'#'),g('%$;j/&#0#*;j&&&#/"!&,)'),g('%$;j/&#0#*;j&&&#/"!&,)'),g(";k.) &;+.# &;-"),g('2l""6l7m.e &2n""6n7o.Y &24""6475.M &28""6879.A &2<""6<7=.5 &2@""6@7A.) &2B""6B7C'),g('%26""6677/n#;m/e$$%2<""6<7=/,#;m/#$+")("\'#&\'#0<*%2<""6<7=/,#;m/#$+")("\'#&\'#&/#$+#)(#\'#("\'#&\'#'),g('%;n/A#2>""6>7?/2$;o/)$8#:√é#"" )(#\'#("\'#&\'#'),g("$;p.) &;+.# &;-/2#0/*;p.) &;+.# &;-&&&#"),g("$;p.) &;+.# &;-0/*;p.) &;+.# &;-&"),g('2l""6l7m.e &2n""6n7o.Y &24""6475.M &26""6677.A &28""6879.5 &2@""6@7A.) &2B""6B7C'),g(";¬ë.# &;r"),g("%;¬ê/G#;'/>$;s/5$;'/,$;¬Ñ/#$+%)(%'#($'#(#'#(\"'#&'#"),g(";M.# &;t"),g("%;/E#28\"\"6879/6$;u.# &;x/'$8#:√è# )(#'#(\"'#&'#"),g('%;v.# &;w/J#%26""6677/,#;¬É/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),g('%2√ê""6√ê7√ë/:#;¬Ä/1$;w." &"/#$+#)(#\'#("\'#&\'#'),g('%24""6475/,#;{/#$+")("\'#&\'#'),g("%;z/3#$;y0#*;y&/#$+\")(\"'#&'#"),g(";*.) &;+.# &;-"),g(';+.¬è &;-.¬â &22""6273.} &26""6677.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),g('%;|/e#$%24""6475/,#;|/#$+")("\'#&\'#0<*%24""6475/,#;|/#$+")("\'#&\'#&/#$+")("\'#&\'#'),g('%$;~0#*;~&/e#$%22""6273/,#;}/#$+")("\'#&\'#0<*%22""6273/,#;}/#$+")("\'#&\'#&/#$+")("\'#&\'#'),g("$;~0#*;~&"),g(';+.w &;-.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),g('%%;"/¬á#$;".G &;!.A &2@""6@7A.5 &2F""6F7G.) &2J""6J7K0M*;".G &;!.A &2@""6@7A.5 &2F""6F7G.) &2J""6J7K&/#$+")("\'#&\'#/& 8!:√í! )'),g(";¬Å.# &;¬Ç"),g('%%;O/2#2:""6:7;/#$+")("\'#&\'#." &"/,#;S/#$+")("\'#&\'#." &"'),g('$;+.¬É &;-.} &2B""6B7C.q &2D""6D7E.e &22""6273.Y &28""6879.M &2:""6:7;.A &2<""6<7=.5 &2>""6>7?.) &2@""6@7A/¬å#0¬â*;+.¬É &;-.} &2B""6B7C.q &2D""6D7E.e &22""6273.Y &28""6879.M &2:""6:7;.A &2<""6<7=.5 &2>""6>7?.) &2@""6@7A&&&#'),g("$;y0#*;y&"),g('%3¬í""5#7√ì/q#24""6475/b$$;!/&#0#*;!&&&#/L$2J""6J7K/=$$;!/&#0#*;!&&&#/\'$8%:√î% )(%\'#($\'#(#\'#("\'#&\'#'),g('2√ï""6√ï7√ñ'),g('2√ó""6√ó7√ò'),g('2√ô""6√ô7√ö'),g('2√õ""6√õ7√ú'),g('2√ù""6√ù7√û'),g('2√ü""6√ü7√†'),g('2√°""6√°7√¢'),g('2√£""6√£7√§'),g('2√•""6√•7√¶'),g('2√ß""6√ß7√®'),g('2√©""6√©7√™'),g("%;¬Ö.Y &;¬Ü.S &;¬à.M &;¬â.G &;¬ä.A &;¬ã.; &;¬å.5 &;¬è./ &;¬ç.) &;¬é.# &;6/& 8!:√´! )"),g("%;¬Ñ/G#;'/>$;¬í/5$;'/,$;¬î/#$+%)(%'#($'#(#'#(\"'#&'#"),g("%;¬ì/' 8!:√¨!! )"),g("%;!/5#;!/,$;!/#$+#)(#'#(\"'#&'#"),g("%$;*.A &;+.; &;-.5 &;3./ &;4.) &;'.# &;(0G*;*.A &;+.; &;-.5 &;3./ &;4.) &;'.# &;(&/& 8!:√≠! )"),g("%;¬∂/Y#$%;A/,#;¬∂/#$+\")(\"'#&'#06*%;A/,#;¬∂/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),g('%;9/N#%2:""6:7;/,#;9/#$+")("\'#&\'#." &"/\'$8":√Æ" )("\'#&\'#'),g("%;:.c &%;¬ò/Y#$%;A/,#;¬ò/#$+\")(\"'#&'#06*%;A/,#;¬ò/#$+\")(\"'#&'#&/#$+\")(\"'#&'#/& 8!:√Ø! )"),g("%;L.# &;¬ô/]#$%;B/,#;¬õ/#$+\")(\"'#&'#06*%;B/,#;¬õ/#$+\")(\"'#&'#&/'$8\":√∞\" )(\"'#&'#"),g("%;¬ö.\" &\"/>#;@/5$;M/,$;?/#$+$)($'#(#'#(\"'#&'#"),g("%%;6/Y#$%;./,#;6/#$+\")(\"'#&'#06*%;./,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#.# &;H/' 8!:√±!! )"),g(";¬ú.) &;¬ù.# &;¬†"),g("%3√≤\"\"5!7√≥/:#;</1$;¬ü/($8#:√¥#! )(#'#(\"'#&'#"),g("%3√µ\"\"5'7√∂/:#;</1$;¬û/($8#:√∑#! )(#'#(\"'#&'#"),g("%$;!/&#0#*;!&&&#/' 8!:√∏!! )"),g('%2√π""6√π7√∫/o#%2J""6J7K/M#;!." &"/?$;!." &"/1$;!." &"/#$+$)($\'#(#\'#("\'#&\'#." &"/\'$8":√ª" )("\'#&\'#'),g('%;6/J#%;</,#;¬°/#$+")("\'#&\'#." &"/)$8":√º""! )("\'#&\'#'),g(";6.) &;T.# &;H"),g("%;¬£/Y#$%;B/,#;¬§/#$+\")(\"'#&'#06*%;B/,#;¬§/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),g('%3√Ω""5&7√æ.G &3√ø""5\'7ƒÄ.; &3ƒÅ""5$7ƒÇ./ &3ƒÉ""5%7ƒÑ.# &;6/& 8!:ƒÖ! )'),g(";¬•.# &;¬†"),g('%3ƒÜ""5(7ƒá/M#;</D$3ƒà""5(7ƒâ./ &3ƒä""5(7ƒã.# &;6/#$+#)(#\'#("\'#&\'#'),g("%;6/Y#$%;A/,#;6/#$+\")(\"'#&'#06*%;A/,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),g("%$;!/&#0#*;!&&&#/' 8!:ƒå!! )"),g("%;¬©/& 8!:ƒç! )"),g("%;¬™/k#;;/b$;¬Ø/Y$$%;B/,#;¬∞/#$+\")(\"'#&'#06*%;B/,#;¬∞/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),g(";¬´.# &;¬¨"),g('3ƒé""5$7ƒè.S &3ƒê""5%7ƒë.G &3ƒí""5%7ƒì.; &3ƒî""5%7ƒï./ &3ƒñ""5+7ƒó.# &;¬≠'),g('3ƒò""5\'7ƒô./ &3ƒö""5)7ƒõ.# &;¬≠'),g(";6.# &;¬Æ"),g('%3ƒú""5"7ƒù/,#;6/#$+")("\'#&\'#'),g(";¬≠.# &;6"),g("%;6/5#;</,$;¬±/#$+#)(#'#(\"'#&'#"),g(";6.# &;H"),g("%;¬≥/5#;./,$;¬ê/#$+#)(#'#(\"'#&'#"),g("%$;!/&#0#*;!&&&#/' 8!:ƒû!! )"),g("%;¬û/' 8!:ƒü!! )"),g('%;¬∂/^#$%;B/,#;¬†/#$+")("\'#&\'#06*%;B/,#;¬†/#$+")("\'#&\'#&/($8":ƒ†"!!)("\'#&\'#'),g('%%;7/e#$%2J""6J7K/,#;7/#$+")("\'#&\'#0<*%2J""6J7K/,#;7/#$+")("\'#&\'#&/#$+")("\'#&\'#/"!&,)'),g("%;L.# &;¬ô/]#$%;B/,#;¬∏/#$+\")(\"'#&'#06*%;B/,#;¬∏/#$+\")(\"'#&'#&/'$8\":ƒ°\" )(\"'#&'#"),g(";¬π.# &;¬†"),g("%3ƒ¢\"\"5#7ƒ£/:#;</1$;6/($8#:ƒ§#! )(#'#(\"'#&'#"),g("%$;!/&#0#*;!&&&#/' 8!:ƒ•!! )"),g("%;¬û/' 8!:ƒ¶!! )"),g("%$;¬ö0#*;¬ö&/x#;@/o$;M/f$;?/]$$%;B/,#;¬†/#$+\")(\"'#&'#06*%;B/,#;¬†/#$+\")(\"'#&'#&/'$8%:ƒß% )(%'#($'#(#'#(\"'#&'#"),g(";¬æ"),g("%3ƒ®\"\"5&7ƒ©/k#;./b$;√Å/Y$$%;A/,#;√Å/#$+\")(\"'#&'#06*%;A/,#;√Å/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#.# &;¬ø"),g("%;6/k#;./b$;√Ä/Y$$%;A/,#;√Ä/#$+\")(\"'#&'#06*%;A/,#;√Ä/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),g("%;6/;#;</2$;6.# &;H/#$+#)(#'#(\"'#&'#"),g(";√Ç.G &;√Ñ.A &;√Ü.; &;√à.5 &;√â./ &;√ä.) &;√ã.# &;√Ä"),g("%3ƒ™\"\"5%7ƒ´/5#;</,$;√É/#$+#)(#'#(\"'#&'#"),g("%;I/' 8!:ƒ¨!! )"),g("%3ƒ≠\"\"5&7ƒÆ/¬ó#;</¬é$;D/¬Ö$;√Ö/|$$%$;'/&#0#*;'&&&#/,#;√Ö/#$+\")(\"'#&'#0C*%$;'/&#0#*;'&&&#/,#;√Ö/#$+\")(\"'#&'#&/,$;E/#$+&)(&'#(%'#($'#(#'#(\"'#&'#"),g(";t.# &;w"),g("%3ƒØ\"\"5%7ƒ∞/5#;</,$;√á/#$+#)(#'#(\"'#&'#"),g("%;I/' 8!:ƒ±!! )"),g("%3ƒ≤\"\"5&7ƒ≥/:#;</1$;I/($8#:ƒ¥#! )(#'#(\"'#&'#"),g('%3ƒµ""5%7ƒ∂/]#;</T$%3ƒ∑""5$7ƒ∏/& 8!:ƒπ! ).4 &%3ƒ∫""5%7ƒª/& 8!:ƒº! )/#$+#)(#\'#("\'#&\'#'),g('%3ƒΩ""5)7ƒæ/R#;</I$3ƒø""5#7≈Ä./ &3≈Å""5(7≈Ç.# &;6/($8#:≈É#! )(#\'#("\'#&\'#'),g('%3≈Ñ""5#7≈Ö/¬ì#;</¬ä$;D/¬Å$%;√å/e#$%2D""6D7E/,#;√å/#$+")("\'#&\'#0<*%2D""6D7E/,#;√å/#$+")("\'#&\'#&/#$+")("\'#&\'#/,$;E/#$+%)(%\'#($\'#(#\'#("\'#&\'#'),g('%3≈Ü""5(7≈á./ &3≈à""5$7≈â.# &;6/\' 8!:≈ä!! )'),g("%;6/Y#$%;A/,#;6/#$+\")(\"'#&'#06*%;A/,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),g("%;√è/G#;./>$;√è/5$;./,$;¬ê/#$+%)(%'#($'#(#'#(\"'#&'#"),g("%$;!/&#0#*;!&&&#/' 8!:≈ã!! )"),g("%;√ë/]#$%;A/,#;√ë/#$+\")(\"'#&'#06*%;A/,#;√ë/#$+\")(\"'#&'#&/'$8\":≈å\" )(\"'#&'#"),g("%;¬ô/]#$%;B/,#;¬†/#$+\")(\"'#&'#06*%;B/,#;¬†/#$+\")(\"'#&'#&/'$8\":≈ç\" )(\"'#&'#"),g('%;L.O &;¬ô.I &%;@." &"/:#;t/1$;?." &"/#$+#)(#\'#("\'#&\'#/]#$%;B/,#;¬†/#$+")("\'#&\'#06*%;B/,#;¬†/#$+")("\'#&\'#&/\'$8":≈é" )("\'#&\'#'),g("%;√î/]#$%;B/,#;√ï/#$+\")(\"'#&'#06*%;B/,#;√ï/#$+\")(\"'#&'#&/'$8\":≈è\" )(\"'#&'#"),g("%;¬ñ/& 8!:≈ê! )"),g('%3≈ë""5(7≈í/:#;</1$;6/($8#:≈ì#! )(#\'#("\'#&\'#.g &%3≈î""5&7≈ï/:#;</1$;6/($8#:≈ñ#! )(#\'#("\'#&\'#.: &%3≈ó""5*7≈ò/& 8!:≈ô! ).# &;¬†'),g('%%;6/k#$%;A/2#;6/)$8":≈ö""$ )("\'#&\'#0<*%;A/2#;6/)$8":≈ö""$ )("\'#&\'#&/)$8":≈õ""! )("\'#&\'#." &"/\' 8!:≈ú!! )'),g("%;√ò/Y#$%;A/,#;√ò/#$+\")(\"'#&'#06*%;A/,#;√ò/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),g("%;¬ô/Y#$%;B/,#;¬†/#$+\")(\"'#&'#06*%;B/,#;¬†/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),g("%$;!/&#0#*;!&&&#/' 8!:≈ù!! )"),g("%;√õ/Y#$%;B/,#;√ú/#$+\")(\"'#&'#06*%;B/,#;√ú/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),g('%3≈û""5&7≈ü.; &3≈†""5\'7≈°./ &3≈¢""5*7≈£.# &;6/& 8!:≈§! )'),g("%3≈•\"\"5&7≈¶/:#;</1$;√ù/($8#:≈ß#! )(#'#(\"'#&'#.} &%3√µ\"\"5'7√∂/:#;</1$;¬û/($8#:≈®#! )(#'#(\"'#&'#.P &%3≈©\"\"5+7≈™/:#;</1$;¬û/($8#:≈´#! )(#'#(\"'#&'#.# &;¬†"),g('3≈¨""5+7≈≠.k &3≈Æ""5)7≈Ø._ &3≈∞""5(7≈±.S &3≈≤""5\'7≈≥.G &3≈¥""5&7≈µ.; &3≈∂""5*7≈∑./ &3≈∏""5)7≈π.# &;6'),g(';1." &"'),g('%%;6/k#$%;A/2#;6/)$8":≈ö""$ )("\'#&\'#0<*%;A/2#;6/)$8":≈ö""$ )("\'#&\'#&/)$8":≈õ""! )("\'#&\'#." &"/\' 8!:≈∫!! )'),g("%;L.# &;¬ô/]#$%;B/,#;√°/#$+\")(\"'#&'#06*%;B/,#;√°/#$+\")(\"'#&'#&/'$8\":≈ª\" )(\"'#&'#"),g(";¬π.# &;¬†"),g("%;√£/Y#$%;A/,#;√£/#$+\")(\"'#&'#06*%;A/,#;√£/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),g("%;√™/k#;./b$;√≠/Y$$%;B/,#;√§/#$+\")(\"'#&'#06*%;B/,#;√§/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),g(";√•.; &;√¶.5 &;√ß./ &;√®.) &;√©.# &;¬†"),g("%3≈º\"\"5#7≈Ω/:#;</1$;√∞/($8#:≈æ#! )(#'#(\"'#&'#"),g("%3≈ø\"\"5%7∆Ä/:#;</1$;T/($8#:∆Å#! )(#'#(\"'#&'#"),g("%3∆Ç\"\"5(7∆É/F#;</=$;\\.) &;Y.# &;X/($8#:∆Ñ#! )(#'#(\"'#&'#"),g("%3∆Ö\"\"5&7∆Ü/:#;</1$;6/($8#:∆á#! )(#'#(\"'#&'#"),g("%3∆à\"\"5%7∆â/A#;</8$$;!0#*;!&/($8#:∆ä#! )(#'#(\"'#&'#"),g("%;√´/G#;;/>$;6/5$;;/,$;√¨/#$+%)(%'#($'#(#'#(\"'#&'#"),g('%3¬í""5#7√ì.# &;6/\' 8!:∆ã!! )'),g('%3¬±""5#7∆å.G &3¬≥""5#7∆ç.; &3¬∑""5#7∆é./ &3¬µ""5$7∆è.# &;6/\' 8!:∆ê!! )'),g('%;√Æ/D#%;C/,#;√Ø/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),g("%;U.) &;\\.# &;X/& 8!:∆ë! )"),g('%%;!." &"/[#;!." &"/M$;!." &"/?$;!." &"/1$;!." &"/#$+%)(%\'#($\'#(#\'#("\'#&\'#/\' 8!:∆í!! )'),g('%%;!/?#;!." &"/1$;!." &"/#$+#)(#\'#("\'#&\'#/\' 8!:∆ì!! )'),g(";¬æ"),g('%;¬û/^#$%;B/,#;√≥/#$+")("\'#&\'#06*%;B/,#;√≥/#$+")("\'#&\'#&/($8":∆î"!!)("\'#&\'#'),g(";√¥.# &;¬†"),g('%2∆ï""6∆ï7∆ñ/L#;</C$2∆ó""6∆ó7∆ò.) &2∆ô""6∆ô7∆ö/($8#:∆õ#! )(#\'#("\'#&\'#'),g('%;¬û/^#$%;B/,#;¬†/#$+")("\'#&\'#06*%;B/,#;¬†/#$+")("\'#&\'#&/($8":∆ú"!!)("\'#&\'#'),g("%;6/5#;0/,$;√∑/#$+#)(#'#(\"'#&'#"),g("$;2.) &;4.# &;.0/*;2.) &;4.# &;.&"),g("$;%0#*;%&"),g("%;√∫/;#28\"\"6879/,$;√ª/#$+#)(#'#(\"'#&'#"),g('%3∆ù""5%7∆û.) &3∆ü""5$7∆†/\' 8!:∆°!! )'),g('%;√º/J#%28""6879/,#;^/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),g("%;\\.) &;X.# &;¬Ç/' 8!:∆¢!! )"),g(';".S &;!.M &2F""6F7G.A &2J""6J7K.5 &2H""6H7I.) &2N""6N7O'),g('2L""6L7M.¬ï &2B""6B7C.¬â &2<""6<7=.} &2R""6R7S.q &2T""6T7U.e &2V""6V7W.Y &2P""6P7Q.M &2@""6@7A.A &2D""6D7E.5 &22""6273.) &2>""6>7?'),g('%;ƒÄ/b#28""6879/S$;√ª/J$%2∆£""6∆£7∆§/,#;√¨/#$+")("\'#&\'#." &"/#$+$)($\'#(#\'#("\'#&\'#'),g('%3∆•""5%7∆¶.) &3∆ß""5$7∆®/\' 8!:∆°!! )'),g('%3¬±""5#7¬≤.6 &3¬≥""5#7¬¥.* &$;+0#*;+&/\' 8!:∆©!! )'),g("%;ƒÑ/¬á#2F\"\"6F7G/x$;ƒÉ/o$2F\"\"6F7G/`$;ƒÉ/W$2F\"\"6F7G/H$;ƒÉ/?$2F\"\"6F7G/0$;ƒÖ/'$8):∆™) )()'#(('#(''#(&'#(%'#($'#(#'#(\"'#&'#"),g("%;#/>#;#/5$;#/,$;#/#$+$)($'#(#'#(\"'#&'#"),g("%;ƒÉ/,#;ƒÉ/#$+\")(\"'#&'#"),g("%;ƒÉ/5#;ƒÉ/,$;ƒÉ/#$+#)(#'#(\"'#&'#"),g("%;q/T#$;m0#*;m&/D$%; /,#;√∏/#$+\")(\"'#&'#.\" &\"/#$+#)(#'#(\"'#&'#"),g('%2∆´""6∆´7∆¨.) &2∆≠""6∆≠7∆Æ/w#;0/n$;ƒà/e$$%;B/2#;ƒâ.# &;¬†/#$+")("\'#&\'#0<*%;B/2#;ƒâ.# &;¬†/#$+")("\'#&\'#&/#$+$)($\'#(#\'#("\'#&\'#'),g(";¬ô.# &;L"),g("%2∆Ø\"\"6∆Ø7∆∞/5#;</,$;ƒä/#$+#)(#'#(\"'#&'#"),g("%;D/S#;,/J$2:\"\"6:7;/;$;,.# &;T/,$;E/#$+%)(%'#($'#(#'#(\"'#&'#")],C=0,R=0,_=[{line:1,column:1}],w=0,A=[],I=0;if(void 0!==t.startRule){if(!(t.startRule in T))throw new Error("Can't start parsing from rule \""+t.startRule+'".');y=T[t.startRule]}if(t.data={},v=f(y),v!==S&&C===e.length)return v;throw v!==S&&C<e.length&&h(u()),l(A,w<e.length?e.charAt(w):null,w<e.length?p(w,w+1):p(w,w))}Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),s=r(13),o=r(15),a=function(e){function t(r,i,n,s){var o=e.call(this)||this;return o.message=r,o.expected=i,o.found=n,o.location=s,o.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(o,t),o}return n.__extends(t,e),t.buildMessage=function(e,t){function r(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+r(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+r(e)})}function n(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+r(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+r(e)})}function s(e){switch(e.type){case"literal":return'"'+i(e.text)+'"';case"class":var t=e.parts.map(function(e){return Array.isArray(e)?n(e[0])+"-"+n(e[1]):n(e)});return"["+(e.inverted?"^":"")+t+"]";case"any":return"any character";case"end":return"end of input";case"other":return e.description}}function o(e){var t,r,i=e.map(s);if(i.sort(),i.length>0){for(t=1,r=1;t<i.length;t++)i[t-1]!==i[t]&&(i[r]=i[t],r++);i.length=r}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}function a(e){return e?'"'+i(e)+'"':"end of input"}return"Expected "+o(e)+" but "+a(t)+" found."},t}(Error);t.SyntaxError=a,t.parse=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(14),s=function(e){function t(t,r,i){var n=e.call(this,i)||this;return n.uri=t,n._displayName=r,n}return i.__extends(t,e),Object.defineProperty(t.prototype,"friendlyName",{get:function(){return this.displayName||this.uri.aor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayName",{get:function(){return this._displayName},set:function(e){this._displayName=e},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new t(this.uri.clone(),this._displayName,JSON.parse(JSON.stringify(this.parameters)))},t.prototype.toString=function(){var e=this.displayName||"0"===this.displayName?'"'+this.displayName+'" ':"";for(var t in e+="<"+this.uri.toString()+">",this.parameters)this.parameters.hasOwnProperty(t)&&(e+=";"+t,null!==this.parameters[t]&&(e+="="+this.parameters[t]));return e},t}(n.Parameters);t.NameAddrHeader=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){for(var t in this.parameters={},e)e.hasOwnProperty(t)&&this.setParam(t,e[t])}return e.prototype.setParam=function(e,t){e&&(this.parameters[e.toLowerCase()]=null==t?null:t.toString())},e.prototype.getParam=function(e){if(e)return this.parameters[e.toLowerCase()]},e.prototype.hasParam=function(e){return!!e&&!!this.parameters.hasOwnProperty(e.toLowerCase())},e.prototype.deleteParam=function(e){if(e=e.toLowerCase(),this.parameters.hasOwnProperty(e)){var t=this.parameters[e];return delete this.parameters[e],t}},e.prototype.clearParams=function(){this.parameters={}},e}();t.Parameters=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(14),s=function(e){function t(t,r,i,n,s,o){var a=e.call(this,s)||this;if(a.headers={},!i)throw new TypeError('missing or invalid "host" parameter');for(var c in t=t||"sip",o)o.hasOwnProperty(c)&&a.setHeader(c,o[c]);return a.raw={scheme:t,user:r,host:i,port:n},a.normal={scheme:t.toLowerCase(),user:r,host:i.toLowerCase(),port:n},a}return i.__extends(t,e),Object.defineProperty(t.prototype,"scheme",{get:function(){return this.normal.scheme},set:function(e){this.raw.scheme=e,this.normal.scheme=e.toLowerCase()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"user",{get:function(){return this.normal.user},set:function(e){this.normal.user=this.raw.user=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"host",{get:function(){return this.normal.host},set:function(e){this.raw.host=e,this.normal.host=e.toLowerCase()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aor",{get:function(){return this.normal.user+"@"+this.normal.host},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"port",{get:function(){return this.normal.port},set:function(e){this.normal.port=this.raw.port=e},enumerable:!0,configurable:!0}),t.prototype.setHeader=function(e,t){this.headers[this.headerize(e)]=t instanceof Array?t:[t]},t.prototype.getHeader=function(e){if(e)return this.headers[this.headerize(e)]},t.prototype.hasHeader=function(e){return!!e&&!!this.headers.hasOwnProperty(this.headerize(e))},t.prototype.deleteHeader=function(e){if(e=this.headerize(e),this.headers.hasOwnProperty(e)){var t=this.headers[e];return delete this.headers[e],t}},t.prototype.clearHeaders=function(){this.headers={}},t.prototype.clone=function(){return new t(this._raw.scheme,this._raw.user||"",this._raw.host,this._raw.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},t.prototype.toRaw=function(){return this._toString(this._raw)},t.prototype.toString=function(){return this._toString(this._normal)},Object.defineProperty(t.prototype,"_normal",{get:function(){return this.normal},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_raw",{get:function(){return this.raw},enumerable:!0,configurable:!0}),t.prototype._toString=function(e){var t=e.scheme+":";for(var r in e.scheme.toLowerCase().match("^sips?$")||(t+="//"),e.user&&(t+=this.escapeUser(e.user)+"@"),t+=e.host,(e.port||0===e.port)&&(t+=":"+e.port),this.parameters)this.parameters.hasOwnProperty(r)&&(t+=";"+r,null!==this.parameters[r]&&(t+="="+this.parameters[r]));var i=[];for(var n in this.headers)if(this.headers.hasOwnProperty(n))for(var s in this.headers[n])this.headers[n].hasOwnProperty(s)&&i.push(n+"="+this.headers[n][s]);return i.length>0&&(t+="?"+i.join("&")),t},t.prototype.escapeUser=function(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},t.prototype.headerize=function(e){for(var t={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},r=e.toLowerCase().replace(/_/g,"-").split("-"),i=r.length,n="",s=0;s<i;s++)0!==s&&(n+="-"),n+=r[s].charAt(0).toUpperCase()+r[s].substring(1);return t[n]&&(n=t[n]),n},t}(n.Parameters);t.URI=s},function(e,t,r){"use strict";function i(e,t){void 0===t&&(t=32);for(var r="",i=0;i<e;i++){var n=Math.floor(Math.random()*t);r+=n.toString(t)}return r}function n(e){return c[e]||""}function s(){return i(10)}function o(e){for(var t={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},r=e.toLowerCase().replace(/_/g,"-").split("-"),i=r.length,n="",s=0;s<i;s++)0!==s&&(n+="-"),n+=r[s].charAt(0).toUpperCase()+r[s].substring(1);return t[n]&&(n=t[n]),n}function a(e){return encodeURIComponent(e).replace(/%[A-F\d]{2}/g,"U").length}Object.defineProperty(t,"__esModule",{value:!0}),t.createRandomToken=i,t.getReasonPhrase=n,t.newTag=s,t.headerize=o,t.str_utf8_length=a;var c={100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(10),s=function(e){function t(){return e.call(this)||this}return i.__extends(t,e),t}(n.IncomingMessage);t.IncomingResponseMessage=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(13),s=r(16),o=function(){function e(t,r,n,o,a,c,u){this.headers={},this.extraHeaders=[],this.options=e.getDefaultOptions(),a&&(this.options=i.__assign({},this.options,a),this.options.optionTags&&this.options.optionTags.length&&(this.options.optionTags=this.options.optionTags.slice()),this.options.routeSet&&this.options.routeSet.length&&(this.options.routeSet=this.options.routeSet.slice())),c&&c.length&&(this.extraHeaders=c.slice()),u&&(this.body={body:u.content,contentType:u.contentType}),this.method=t,this.ruri=r.clone(),this.fromURI=n.clone(),this.fromTag=this.options.fromTag?this.options.fromTag:s.newTag(),this.from=e.makeNameAddrHeader(this.fromURI,this.options.fromDisplayName,this.fromTag),this.toURI=o.clone(),this.toTag=this.options.toTag,this.to=e.makeNameAddrHeader(this.toURI,this.options.toDisplayName,this.toTag),this.callId=this.options.callId?this.options.callId:this.options.callIdPrefix+s.createRandomToken(15),this.cseq=this.options.cseq,this.setHeader("route",this.options.routeSet),this.setHeader("via",""),this.setHeader("to",this.to.toString()),this.setHeader("from",this.from.toString()),this.setHeader("cseq",this.cseq+" "+this.method),this.setHeader("call-id",this.callId),this.setHeader("max-forwards","70")}return e.getDefaultOptions=function(){return{callId:"",callIdPrefix:"",cseq:1,toDisplayName:"",toTag:"",fromDisplayName:"",fromTag:"",forceRport:!1,hackViaTcp:!1,optionTags:["outbound"],routeSet:[],userAgentString:"sip.js",viaHost:""}},e.makeNameAddrHeader=function(e,t,r){var i={};return r&&(i.tag=r),new n.NameAddrHeader(e,t,i)},e.prototype.getHeader=function(e){var t=this.headers[s.headerize(e)];if(t){if(t[0])return t[0]}else for(var r=new RegExp("^\\s*"+e+"\\s*:","i"),i=0,n=this.extraHeaders;i<n.length;i++){var o=n[i];if(r.test(o))return o.substring(o.indexOf(":")+1).trim()}},e.prototype.getHeaders=function(e){var t=[],r=this.headers[s.headerize(e)];if(r)for(var i=0,n=r;i<n.length;i++){var o=n[i];t.push(o)}else for(var a=new RegExp("^\\s*"+e+"\\s*:","i"),c=0,u=this.extraHeaders;c<u.length;c++){var d=u[c];a.test(d)&&t.push(d.substring(d.indexOf(":")+1).trim())}return t},e.prototype.hasHeader=function(e){if(this.headers[s.headerize(e)])return!0;for(var t=new RegExp("^\\s*"+e+"\\s*:","i"),r=0,i=this.extraHeaders;r<i.length;r++){var n=i[r];if(t.test(n))return!0}return!1},e.prototype.setHeader=function(e,t){this.headers[s.headerize(e)]=t instanceof Array?t:[t]},e.prototype.setViaHeader=function(e,t){void 0===t&&(t="WSS"),this.options.hackViaTcp&&(t="TCP");var r="SIP/2.0/"+t;r+=" "+this.options.viaHost+";branch="+e,this.options.forceRport&&(r+=";rport"),this.setHeader("via",r),this.branch=e},e.prototype.toString=function(){var e="";for(var t in e+=this.method+" "+this.ruri.toRaw()+" SIP/2.0\r\n",this.headers)if(this.headers[t])for(var r=0,i=this.headers[t];r<i.length;r++){var n=i[r];e+=t+": "+n+"\r\n"}for(var o=0,a=this.extraHeaders;o<a.length;o++){t=a[o];e+=t.trim()+"\r\n"}return e+="Supported: "+this.options.optionTags.join(", ")+"\r\n",e+="User-Agent: "+this.options.userAgentString+"\r\n",this.body?"string"==typeof this.body?(e+="Content-Length: "+s.str_utf8_length(this.body)+"\r\n\r\n",e+=this.body):this.body.body&&this.body.contentType?(e+="Content-Type: "+this.body.contentType+"\r\n",e+="Content-Length: "+s.str_utf8_length(this.body.body)+"\r\n\r\n",e+=this.body.body):e+="Content-Length: 0\r\n\r\n":e+="Content-Length: 0\r\n\r\n",e},e}();t.OutgoingRequestMessage=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=i.__importDefault(r(20)),s=r(16),o=function(){function e(e,t,r){this.logger=e.getLogger("sipjs.digestauthentication"),this.username=t,this.password=r,this.nc=0,this.ncHex="00000000"}return e.prototype.authenticate=function(e,t,r){if(this.algorithm=t.algorithm,this.realm=t.realm,this.nonce=t.nonce,this.opaque=t.opaque,this.stale=t.stale,this.algorithm){if("MD5"!==this.algorithm)return this.logger.warn("challenge with Digest algorithm different than 'MD5', authentication aborted"),!1}else this.algorithm="MD5";if(!this.realm)return this.logger.warn("challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return this.logger.warn("challenge without Digest nonce, authentication aborted"),!1;if(t.qop)if(t.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(t.qop.indexOf("auth-int")>-1))return this.logger.warn("challenge without Digest qop different than 'auth' or 'auth-int', authentication aborted"),!1;this.qop="auth-int"}else this.qop=void 0;return this.method=e.method,this.uri=e.ruri,this.cnonce=s.createRandomToken(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(r),!0},e.prototype.toString=function(){var e=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push("algorithm="+this.algorithm),e.push('username="'+this.username+'"'),e.push('realm="'+this.realm+'"'),e.push('nonce="'+this.nonce+'"'),e.push('uri="'+this.uri+'"'),e.push('response="'+this.response+'"'),this.opaque&&e.push('opaque="'+this.opaque+'"'),this.qop&&(e.push("qop="+this.qop),e.push('cnonce="'+this.cnonce+'"'),e.push("nc="+this.ncHex)),"Digest "+e.join(", ")},e.prototype.updateNcHex=function(){var e=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-e.length)+e},e.prototype.calculateResponse=function(e){var t,r=n.default(this.username+":"+this.realm+":"+this.password);"auth"===this.qop?(t=n.default(this.method+":"+this.uri),
this.response=n.default(r+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+t)):"auth-int"===this.qop?(t=n.default(this.method+":"+this.uri+":"+n.default(e||"")),this.response=n.default(r+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+t)):void 0===this.qop&&(t=n.default(this.method+":"+this.uri),this.response=n.default(r+":"+this.nonce+":"+t))},e}();t.DigestAuthentication=o},function(e,t,r){var i;i=function(e){return function(t){function r(e,t,r,i,n,s,o){var a=e+(t&r|~t&i)+n+o;return(a<<s|a>>>32-s)+t}function i(e,t,r,i,n,s,o){var a=e+(t&i|r&~i)+n+o;return(a<<s|a>>>32-s)+t}function n(e,t,r,i,n,s,o){var a=e+(t^r^i)+n+o;return(a<<s|a>>>32-s)+t}function s(e,t,r,i,n,s,o){var a=e+(r^(t|~i))+n+o;return(a<<s|a>>>32-s)+t}var o=e,a=o.lib,c=a.WordArray,u=a.Hasher,d=o.algo,p=[];(function(){for(var e=0;e<64;e++)p[e]=4294967296*t.abs(t.sin(e+1))|0})();var h=d.MD5=u.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var o=0;o<16;o++){var a=t+o,c=e[a];e[a]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}var u=this._hash.words,d=e[t+0],h=e[t+1],l=e[t+2],g=e[t+3],f=e[t+4],m=e[t+5],v=e[t+6],S=e[t+7],T=e[t+8],y=e[t+9],E=e[t+10],b=e[t+11],C=e[t+12],R=e[t+13],_=e[t+14],w=e[t+15],A=u[0],I=u[1],O=u[2],N=u[3];A=r(A,I,O,N,d,7,p[0]),N=r(N,A,I,O,h,12,p[1]),O=r(O,N,A,I,l,17,p[2]),I=r(I,O,N,A,g,22,p[3]),A=r(A,I,O,N,f,7,p[4]),N=r(N,A,I,O,m,12,p[5]),O=r(O,N,A,I,v,17,p[6]),I=r(I,O,N,A,S,22,p[7]),A=r(A,I,O,N,T,7,p[8]),N=r(N,A,I,O,y,12,p[9]),O=r(O,N,A,I,E,17,p[10]),I=r(I,O,N,A,b,22,p[11]),A=r(A,I,O,N,C,7,p[12]),N=r(N,A,I,O,R,12,p[13]),O=r(O,N,A,I,_,17,p[14]),I=r(I,O,N,A,w,22,p[15]),A=i(A,I,O,N,h,5,p[16]),N=i(N,A,I,O,v,9,p[17]),O=i(O,N,A,I,b,14,p[18]),I=i(I,O,N,A,d,20,p[19]),A=i(A,I,O,N,m,5,p[20]),N=i(N,A,I,O,E,9,p[21]),O=i(O,N,A,I,w,14,p[22]),I=i(I,O,N,A,f,20,p[23]),A=i(A,I,O,N,y,5,p[24]),N=i(N,A,I,O,_,9,p[25]),O=i(O,N,A,I,g,14,p[26]),I=i(I,O,N,A,T,20,p[27]),A=i(A,I,O,N,R,5,p[28]),N=i(N,A,I,O,l,9,p[29]),O=i(O,N,A,I,S,14,p[30]),I=i(I,O,N,A,C,20,p[31]),A=n(A,I,O,N,m,4,p[32]),N=n(N,A,I,O,T,11,p[33]),O=n(O,N,A,I,b,16,p[34]),I=n(I,O,N,A,_,23,p[35]),A=n(A,I,O,N,h,4,p[36]),N=n(N,A,I,O,f,11,p[37]),O=n(O,N,A,I,S,16,p[38]),I=n(I,O,N,A,E,23,p[39]),A=n(A,I,O,N,R,4,p[40]),N=n(N,A,I,O,d,11,p[41]),O=n(O,N,A,I,g,16,p[42]),I=n(I,O,N,A,v,23,p[43]),A=n(A,I,O,N,y,4,p[44]),N=n(N,A,I,O,C,11,p[45]),O=n(O,N,A,I,w,16,p[46]),I=n(I,O,N,A,l,23,p[47]),A=s(A,I,O,N,d,6,p[48]),N=s(N,A,I,O,S,10,p[49]),O=s(O,N,A,I,_,15,p[50]),I=s(I,O,N,A,m,21,p[51]),A=s(A,I,O,N,C,6,p[52]),N=s(N,A,I,O,g,10,p[53]),O=s(O,N,A,I,E,15,p[54]),I=s(I,O,N,A,h,21,p[55]),A=s(A,I,O,N,T,6,p[56]),N=s(N,A,I,O,w,10,p[57]),O=s(O,N,A,I,v,15,p[58]),I=s(I,O,N,A,R,21,p[59]),A=s(A,I,O,N,f,6,p[60]),N=s(N,A,I,O,b,10,p[61]),O=s(O,N,A,I,l,15,p[62]),I=s(I,O,N,A,y,21,p[63]),u[0]=u[0]+A|0,u[1]=u[1]+I|0,u[2]=u[2]+O|0,u[3]=u[3]+N|0},_doFinalize:function(){var e=this._data,r=e.words,i=8*this._nDataBytes,n=8*e.sigBytes;r[n>>>5]|=128<<24-n%32;var s=t.floor(i/4294967296),o=i;r[15+(n+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),r[14+(n+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),e.sigBytes=4*(r.length+1),this._process();for(var a=this._hash,c=a.words,u=0;u<4;u++){var d=c[u];c[u]=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8)}return a},clone:function(){var e=u.clone.call(this);return e._hash=this._hash.clone(),e}});o.MD5=u._createHelper(h),o.HmacMD5=u._createHmacHelper(h)}(Math),e.MD5},e.exports=i(r(21))},function(e,t,r){var i;i=function(){var e=e||function(e,t){var r=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),i={},n=i.lib={},s=n.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=n.WordArray=s.extend({init:function(e,r){e=this.words=e||[],this.sigBytes=r!=t?r:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,r=e.words,i=this.sigBytes,n=e.sigBytes;if(this.clamp(),i%4)for(var s=0;s<n;s++){var o=r[s>>>2]>>>24-s%4*8&255;t[i+s>>>2]|=o<<24-(i+s)%4*8}else for(s=0;s<n;s+=4)t[i+s>>>2]=r[s>>>2];return this.sigBytes+=n,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r,i=[],n=function(t){t=t;var r=987654321,i=4294967295;return function(){r=36969*(65535&r)+(r>>16)&i,t=18e3*(65535&t)+(t>>16)&i;var n=(r<<16)+t&i;return n/=4294967296,n+=.5,n*(e.random()>.5?1:-1)}},s=0;s<t;s+=4){var a=n(4294967296*(r||e.random()));r=987654071*a(),i.push(4294967296*a()|0)}return new o.init(i,t)}}),a=i.enc={},c=a.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],n=0;n<r;n++){var s=t[n>>>2]>>>24-n%4*8&255;i.push((s>>>4).toString(16)),i.push((15&s).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i+=2)r[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new o.init(r,t/2)}},u=a.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],n=0;n<r;n++){var s=t[n>>>2]>>>24-n%4*8&255;i.push(String.fromCharCode(s))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i++)r[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new o.init(r,t)}},d=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},p=n.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,i=r.words,n=r.sigBytes,s=this.blockSize,a=4*s,c=n/a;c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0);var u=c*s,d=e.min(4*u,n);if(u){for(var p=0;p<u;p+=s)this._doProcessBlock(i,p);var h=i.splice(0,u);r.sigBytes-=d}return new o.init(h,d)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),h=(n.Hasher=p.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new h.HMAC.init(e,r).finalize(t)}}}),i.algo={});return i}(Math);return e},e.exports=i()},function(e,t,r){"use strict";function i(e,t){var r="\r\n";if(t.statusCode<100||t.statusCode>699)throw new TypeError("Invalid statusCode: "+t.statusCode);var i=t.reasonPhrase?t.reasonPhrase:n.getReasonPhrase(t.statusCode),s="SIP/2.0 "+t.statusCode+" "+i+r;t.statusCode>=100&&t.statusCode,t.statusCode;var o="From: "+e.getHeader("From")+r,a="Call-ID: "+e.callId+r,c="CSeq: "+e.cseq+" "+e.method+r,u=e.getHeaders("via").reduce(function(e,t){return e+"Via: "+t+r},""),d="To: "+e.getHeader("to");if(t.statusCode>100&&!e.parseHeader("to").hasParam("tag")){var p=t.toTag;p||(p=n.newTag()),d+=";tag="+p}d+=r;var h="";t.supported&&(h="Supported: "+t.supported.join(", ")+r);var l="";t.userAgent&&(l="User-Agent: "+t.userAgent+r);var g="";return t.extraHeaders&&(g=t.extraHeaders.reduce(function(e,t){return e+t.trim()+r},"")),s+=u,s+=o,s+=d,s+=c,s+=a,s+=h,s+=l,s+=g,t.body?(s+="Content-Type: "+t.body.contentType+r,s+="Content-Length: "+n.str_utf8_length(t.body.content)+r+r,s+=t.body.content):s+="Content-Length: 0"+r+r,{message:s}}Object.defineProperty(t,"__esModule",{value:!0});var n=r(16);t.constructOutgoingResponse=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(5),s=r(24),o=r(26),a=r(27),c=r(41),u=r(43),d=r(45),p=r(46),h=r(47),l=r(48),g=r(49),f=r(50),m=r(51),v=r(52),S=r(53),T=r(54),y=r(4),E=function(e){function t(t,r,i,n){var o=e.call(this,r,i)||this;return o.initialTransaction=t,o._signalingState=s.SignalingState.Initial,o.ackWait=!1,o.delegate=n,t instanceof a.InviteServerTransaction&&(o.ackWait=!0),o.early||o.start2xxRetransmissionTimer(),o.signalingStateTransition(t.request),o.logger=r.loggerFactory.getLogger("sip.invite-dialog"),o.logger.log("INVITE dialog "+o.id+" constructed"),o}return i.__extends(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this),this._signalingState=s.SignalingState.Closed,this._offer=void 0,this._answer=void 0,this.invite2xxTimer&&(clearTimeout(this.invite2xxTimer),this.invite2xxTimer=void 0),this.logger.log("INVITE dialog "+this.id+" destroyed")},Object.defineProperty(t.prototype,"sessionState",{get:function(){return this.early?s.SessionState.Early:this.ackWait?s.SessionState.AckWait:this._signalingState===s.SignalingState.Closed?s.SessionState.Terminated:s.SessionState.Confirmed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"signalingState",{get:function(){return this._signalingState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"offer",{get:function(){return this._offer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"answer",{get:function(){return this._answer},enumerable:!0,configurable:!0}),t.prototype.confirm=function(){this.early&&this.start2xxRetransmissionTimer(),e.prototype.confirm.call(this)},t.prototype.reConfirm=function(){this.reinviteUserAgentServer&&this.startReInvite2xxRetransmissionTimer()},t.prototype.ack=function(e){var t;if(void 0===e&&(e={}),this.logger.log("INVITE dialog "+this.id+" sending ACK request"),this.reinviteUserAgentClient){if(!(this.reinviteUserAgentClient.transaction instanceof a.InviteClientTransaction))throw new Error("Transaction not instance of InviteClientTransaction.");t=this.reinviteUserAgentClient.transaction,this.reinviteUserAgentClient=void 0}else{if(!(this.initialTransaction instanceof a.InviteClientTransaction))throw new Error("Initial transaction not instance of InviteClientTransaction.");t=this.initialTransaction}e.cseq=t.request.cseq;var r=this.createOutgoingRequestMessage(n.C.ACK,e);return t.ackResponse(r),this.signalingStateTransition(r),{message:r}},t.prototype.bye=function(e,t){if(this.logger.log("INVITE dialog "+this.id+" sending BYE request"),this.initialTransaction instanceof a.InviteServerTransaction){if(this.early)throw new Error("UAS MUST NOT send a BYE on early dialogs.");if(this.ackWait&&this.initialTransaction.state!==a.TransactionState.Terminated)throw new Error("UAS MUST NOT send a BYE on a confirmed dialog until it has received an ACK for its 2xx response or until the server transaction times out.")}return new c.ByeUserAgentClient(this,e,t)},t.prototype.info=function(e,t){if(this.logger.log("INVITE dialog "+this.id+" sending INFO request"),this.early)throw new Error("Dialog not confirmed.");return new d.InfoUserAgentClient(this,e,t)},t.prototype.invite=function(e,t){if(this.logger.log("INVITE dialog "+this.id+" sending INVITE request"),this.early)throw new Error("Dialog not confirmed.");if(this.reinviteUserAgentClient)throw new Error("There is an ongoing re-INVITE client transaction.");if(this.reinviteUserAgentServer)throw new Error("There is an ongoing re-INVITE server transaction.");return new m.ReInviteUserAgentClient(this,e,t)},t.prototype.notify=function(e,t){if(this.logger.log("INVITE dialog "+this.id+" sending NOTIFY request"),this.early)throw new Error("Dialog not confirmed.");return new h.NotifyUserAgentClient(this,e,t)},t.prototype.prack=function(e,t){return this.logger.log("INVITE dialog "+this.id+" sending PRACK request"),new g.PrackUserAgentClient(this,e,t)},t.prototype.refer=function(e,t){if(this.logger.log("INVITE dialog "+this.id+" sending REFER request"),this.early)throw new Error("Dialog not confirmed.");return new S.ReferUserAgentClient(this,e,t)},t.prototype.receiveRequest=function(t){if(this.logger.log("INVITE dialog "+this.id+" received "+t.method+" request"),t.method===n.C.ACK){if(this.ackWait){if(this.initialTransaction instanceof a.InviteClientTransaction)return void this.logger.warn("INVITE dialog "+this.id+" received unexpected "+t.method+" request, dropping.");if(this.initialTransaction.request.cseq!==t.cseq)return void this.logger.warn("INVITE dialog "+this.id+" received unexpected "+t.method+" request, dropping.");this.ackWait=!1}else{if(!this.reinviteUserAgentServer)return void this.logger.warn("INVITE dialog "+this.id+" received unexpected "+t.method+" request, dropping.");if(this.reinviteUserAgentServer.transaction.request.cseq!==t.cseq)return void this.logger.warn("INVITE dialog "+this.id+" received unexpected "+t.method+" request, dropping.");this.reinviteUserAgentServer=void 0}return this.signalingStateTransition(t),void(this.delegate&&this.delegate.onAck&&this.delegate.onAck({message:t}))}if(this.sequenceGuard(t)){if(t.method===n.C.INVITE){if(this.reinviteUserAgentServer){var r=Math.floor(10*Math.random())+1,i=["Retry-After: "+r];return void this.core.replyStateless(t,{statusCode:500,extraHeaders:i})}if(this.reinviteUserAgentClient)return void this.core.replyStateless(t,{statusCode:491})}if(e.prototype.receiveRequest.call(this,t),t.method===n.C.INVITE){var s=t.parseHeader("contact");if(!s)throw new Error("Contact undefined.");if(!(s instanceof n.NameAddrHeader))throw new Error("Contact not instance of NameAddrHeader.");this.dialogState.remoteTarget=s.uri}switch(t.method){case n.C.BYE:var o=new u.ByeUserAgentServer(this,t);this.delegate&&this.delegate.onBye?this.delegate.onBye(o):o.accept(),this.dispose();break;case n.C.INFO:o=new p.InfoUserAgentServer(this,t);this.delegate&&this.delegate.onInfo?this.delegate.onInfo(o):o.reject({statusCode:469,extraHeaders:["Recv-Info :"]});break;case n.C.INVITE:o=new v.ReInviteUserAgentServer(this,t);this.signalingStateTransition(t),this.delegate&&this.delegate.onInvite?this.delegate.onInvite(o):o.reject({statusCode:488});break;case n.C.NOTIFY:o=new l.NotifyUserAgentServer(this,t);this.delegate&&this.delegate.onNotify?this.delegate.onNotify(o):o.accept();break;case n.C.PRACK:o=new f.PrackUserAgentServer(this,t);this.delegate&&this.delegate.onPrack?this.delegate.onPrack(o):o.accept();break;case n.C.REFER:o=new T.ReferUserAgentServer(this,t);this.delegate&&this.delegate.onRefer?this.delegate.onRefer(o):o.reject();break;default:this.logger.log("INVITE dialog "+this.id+" received unimplemented "+t.method+" request"),this.core.replyStateless(t,{statusCode:501})}}else this.logger.log("INVITE dialog "+this.id+" rejected out of order "+t.method+" request.")},t.prototype.reliableSequenceGuard=function(e){var t=e.statusCode;if(!t)throw new Error("Status code undefined");if(t>100&&t<200){var r=e.getHeader("require"),i=e.getHeader("rseq"),n=r&&r.includes("100rel")&&i?Number(i):void 0;if(n){if(this.rseq&&this.rseq+1!==n)return!1;this.rseq||(this.rseq=n)}}return!0},t.prototype.signalingStateTransition=function(e){var t=n.getBody(e);if(t&&"session"===t.contentDisposition){if(e instanceof n.IncomingRequestMessage)switch(this._signalingState){case s.SignalingState.Initial:case s.SignalingState.Stable:this._signalingState=s.SignalingState.HaveRemoteOffer,this._offer=t,this._answer=void 0;break;case s.SignalingState.HaveLocalOffer:this._signalingState=s.SignalingState.Stable,this._answer=t;break;case s.SignalingState.HaveRemoteOffer:case s.SignalingState.Closed:break;default:throw new Error("Unexpected signaling state.")}if(e instanceof n.IncomingResponseMessage)switch(this._signalingState){case s.SignalingState.Initial:case s.SignalingState.Stable:this._signalingState=s.SignalingState.HaveRemoteOffer,this._offer=t,this._answer=void 0;break;case s.SignalingState.HaveLocalOffer:this._signalingState=s.SignalingState.Stable,this._answer=t;break;case s.SignalingState.HaveRemoteOffer:case s.SignalingState.Closed:break;default:throw new Error("Unexpected signaling state.")}if(e instanceof n.OutgoingRequestMessage)switch(this._signalingState){case s.SignalingState.Initial:case s.SignalingState.Stable:this._signalingState=s.SignalingState.HaveLocalOffer,this._offer=t,this._answer=void 0;break;case s.SignalingState.HaveLocalOffer:break;case s.SignalingState.HaveRemoteOffer:this._signalingState=s.SignalingState.Stable,this._answer=t;break;case s.SignalingState.Closed:break;default:throw new Error("Unexpected signaling state.")}if(n.isBody(e))switch(this._signalingState){case s.SignalingState.Initial:case s.SignalingState.Stable:this._signalingState=s.SignalingState.HaveLocalOffer,this._offer=t,this._answer=void 0;break;case s.SignalingState.HaveLocalOffer:break;case s.SignalingState.HaveRemoteOffer:this._signalingState=s.SignalingState.Stable,this._answer=t;break;case s.SignalingState.Closed:break;default:throw new Error("Unexpected signaling state.")}}},t.prototype.start2xxRetransmissionTimer=function(){var e=this;if(this.initialTransaction instanceof a.InviteServerTransaction){var t=this.initialTransaction,r=o.Timers.T1,i=function(){e.ackWait?(e.logger.log("No ACK for 2xx response received, attempting retransmission"),t.retransmitAcceptedResponse(),r=Math.min(2*r,o.Timers.T2),e.invite2xxTimer=setTimeout(i,r)):e.invite2xxTimer=void 0};this.invite2xxTimer=setTimeout(i,r);var n=function(){t.state===a.TransactionState.Terminated&&(t.removeListener("stateChanged",n),e.invite2xxTimer&&(clearTimeout(e.invite2xxTimer),e.invite2xxTimer=void 0),e.ackWait&&(e.delegate&&e.delegate.onAckTimeout?e.delegate.onAckTimeout():e.bye()))};t.addListener("stateChanged",n)}},t.prototype.startReInvite2xxRetransmissionTimer=function(){var e=this;if(this.reinviteUserAgentServer&&this.reinviteUserAgentServer.transaction instanceof a.InviteServerTransaction){var t=this.reinviteUserAgentServer.transaction,r=o.Timers.T1,i=function(){e.reinviteUserAgentServer?(e.logger.log("No ACK for 2xx response received, attempting retransmission"),t.retransmitAcceptedResponse(),r=Math.min(2*r,o.Timers.T2),e.invite2xxTimer=setTimeout(i,r)):e.invite2xxTimer=void 0};this.invite2xxTimer=setTimeout(i,r);var n=function(){t.state===a.TransactionState.Terminated&&(t.removeListener("stateChanged",n),e.invite2xxTimer&&(clearTimeout(e.invite2xxTimer),e.invite2xxTimer=void 0),e.reinviteUserAgentServer)};t.addListener("stateChanged",n)}},t}(y.Dialog);t.SessionDialog=E},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1);i.__exportStar(r(25),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Initial="Initial",e.Early="Early",e.AckWait="AckWait",e.Confirmed="Confirmed",e.Terminated="Terminated"}(t.SessionState||(t.SessionState={})),function(e){e.Initial="Initial",e.HaveLocalOffer="HaveLocalOffer",e.HaveRemoteOffer="HaveRemoteOffer",e.Stable="Stable",e.Closed="Closed"}(t.SignalingState||(t.SignalingState={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=500,n=4e3,s=5e3;t.Timers={T1:i,T2:n,T4:s,TIMER_B:64*i,TIMER_D:0*i,TIMER_F:64*i,TIMER_H:64*i,TIMER_I:0*s,TIMER_J:0*i,TIMER_K:0*s,TIMER_L:64*i,TIMER_M:64*i,TIMER_N:64*i,PROVISIONAL_RESPONSE_INTERVAL:6e4}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1);i.__exportStar(r(28),t),i.__exportStar(r(35),t),i.__exportStar(r(37),t),i.__exportStar(r(39),t),i.__exportStar(r(40),t),i.__exportStar(r(35),t),i.__exportStar(r(38),t),i.__exportStar(r(36),t),i.__exportStar(r(29),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(29),s=function(e){function t(r,i,n,s,o){var a=e.call(this,i,n,t.makeId(r),s,o)||this;a._request=r,a.user=n;var c=i.server&&i.server.scheme?i.server.scheme:void 0;return r.setViaHeader(a.id,c),a}return i.__extends(t,e),t.makeId=function(e){if("CANCEL"===e.method){if(!e.branch)throw new Error("Outgoing CANCEL request without a branch.");return e.branch}return"z9hG4bK"+Math.floor(1e7*Math.random())},Object.defineProperty(t.prototype,"request",{get:function(){return this._request},enumerable:!0,configurable:!0}),t.prototype.onRequestTimeout=function(){this.user.onRequestTimeout&&this.user.onRequestTimeout()},t}(n.Transaction);t.ClientTransaction=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(30),s=r(31),o=function(e){function t(t,r,i,n,s){var o=e.call(this)||this;return o._transport=t,o._user=r,o._id=i,o._state=n,o.logger=r.loggerFactory.getLogger(s,i),o.logger.debug("Constructing "+o.typeToString()+" with id "+o.id+"."),o}return i.__extends(t,e),t.prototype.dispose=function(){this.logger.debug("Destroyed "+this.typeToString()+" with id "+this.id+".")},Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kind",{get:function(){throw new Error("Invalid kind.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transport",{get:function(){return this._transport},enumerable:!0,configurable:!0}),t.prototype.on=function(t,r){return e.prototype.on.call(this,t,r)},t.prototype.logTransportError=function(e,t){this.logger.error(e.message),this.logger.error("Transport error occurred in "+this.typeToString()+" with id "+this.id+"."),this.logger.error(t)},t.prototype.send=function(e){var t=this;return this.transport.send(e).catch(function(e){var r;if(!(e instanceof s.TransportError))throw r=e&&"string"==typeof e.message?new s.TransportError(e.message):new s.TransportError,t.onTransportError(r),r;t.onTransportError(e)})},t.prototype.setState=function(e){this.logger.debug('State change to "'+e+'" on '+this.typeToString()+" with id "+this.id+"."),this._state=e,this._user.onStateChange&&this._user.onStateChange(e),this.emit("stateChanged")},t.prototype.typeToString=function(){return"UnknownType"},t}(n.EventEmitter);t.Transaction=o},function(e,t,r){"use strict";function i(e){console&&console.warn&&console.warn(e)}function n(){n.init.call(this)}function s(e){return void 0===e._maxListeners?n.defaultMaxListeners:e._maxListeners}function o(e,t,r,n){var o,a,c;if("function"!=typeof r)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r);if(a=e._events,void 0===a?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),a=e._events),c=a[t]),void 0===c)c=a[t]=r,++e._eventsCount;else if("function"==typeof c?c=a[t]=n?[r,c]:[c,r]:n?c.unshift(r):c.push(r),o=s(e),o>0&&c.length>o&&!c.warned){c.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=c.length,i(u)}return e}function a(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,m(this.listener,this.target,e))}function c(e,t,r){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=a.bind(i);return n.listener=r,i.wrapFn=n,n}function u(e,t,r){var i=e._events;if(void 0===i)return[];var n=i[t];return void 0===n?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?l(n):p(n,n.length)}function d(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function p(e,t){for(var r=new Array(t),i=0;i<t;++i)r[i]=e[i];return r}function h(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function l(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}var g,f="object"==typeof Reflect?Reflect:null,m=f&&"function"==typeof f.apply?f.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};g=f&&"function"==typeof f.ownKeys?f.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var v=Number.isNaN||function(e){return e!=e};e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var S=10;Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return S},set:function(e){if("number"!=typeof e||e<0||v(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");S=e}}),n.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||v(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},n.prototype.getMaxListeners=function(){return s(this)},n.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,n=this._events;if(void 0!==n)i=i&&void 0===n.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var a=n[e];if(void 0===a)return!1;if("function"==typeof a)m(a,this,t);else{var c=a.length,u=p(a,c);for(r=0;r<c;++r)m(u[r],this,t)}return!0},n.prototype.addListener=function(e,t){return o(this,e,t,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(e,t){return o(this,e,t,!0)},n.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,c(this,e,t)),this},n.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,c(this,e,t)),this},n.prototype.removeListener=function(e,t){var r,i,n,s,o;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(i=this._events,void 0===i)return this;if(r=i[e],void 0===r)return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){o=r[s].listener,n=s;break}if(n<0)return this;0===n?r.shift():h(r,n),1===r.length&&(i[e]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(e){var t,r,i;if(r=this._events,void 0===r)return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var n,s=Object.keys(r);for(i=0;i<s.length;++i)n=s[i],"removeListener"!==n&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=r[e],"function"==typeof t)this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},n.prototype.listeners=function(e){return u(this,e,!0)},n.prototype.rawListeners=function(e){return u(this,e,!1)},n.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):d.call(e,t)},n.prototype.listenerCount=d,n.prototype.eventNames=function(){return this._eventsCount>0?g(this._events):[]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1);i.__exportStar(r(32),t),i.__exportStar(r(33),t),i.__exportStar(r(34),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=function(e){function t(t){var r=this.constructor,i=e.call(this,t)||this;return Object.setPrototypeOf(i,r.prototype),i}return i.__extends(t,e),t}(Error);t.Exception=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(32),s=function(e){function t(t){return e.call(this,t||"Transaction state error.")||this}return i.__extends(t,e),t}(n.Exception);t.TransactionStateError=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(32),s=function(e){function t(t){return e.call(this,t||"Unspecified transport error.")||this}return i.__extends(t,e),t}(n.Exception);t.TransportError=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(26),s=r(28),o=r(36),a=function(e){function t(t,r,i){var s=e.call(this,t,r,i,o.TransactionState.Calling,"sip.transaction.ict")||this;return s.ackRetransmissionCache=new Map,s.B=setTimeout(function(){return s.timer_B()},n.Timers.TIMER_B),s.send(t.toString()).catch(function(e){s.logTransportError(e,"Failed to send initial outgoing request.")}),s}return i.__extends(t,e),t.prototype.dispose=function(){this.B&&(clearTimeout(this.B),this.B=void 0),this.D&&(clearTimeout(this.D),this.D=void 0),this.M&&(clearTimeout(this.M),this.M=void 0),e.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"kind",{get:function(){return"ict"},enumerable:!0,configurable:!0}),t.prototype.ackResponse=function(e){var t=this,r=e.toTag;if(!r)throw new Error("To tag undefined.");var i="z9hG4bK"+Math.floor(1e7*Math.random()),n=this.transport.server&&this.transport.server.scheme?this.transport.server.scheme:void 0;e.setViaHeader(i,n),this.ackRetransmissionCache.set(r,e),this.send(e.toString()).catch(function(e){t.logTransportError(e,"Failed to send ACK to 2xx response.")})},t.prototype.receiveResponse=function(e){var t=this,r=e.statusCode;if(!r||r<100||r>699)throw new Error("Invalid status code "+r);switch(this.state){case o.TransactionState.Calling:if(r>=100&&r<=199)return this.stateTransition(o.TransactionState.Proceeding),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(r>=200&&r<=299)return this.ackRetransmissionCache.set(e.toTag,void 0),this.stateTransition(o.TransactionState.Accepted),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(r>=300&&r<=699)return this.stateTransition(o.TransactionState.Completed),this.ack(e),void(this.user.receiveResponse&&this.user.receiveResponse(e));break;case o.TransactionState.Proceeding:if(r>=100&&r<=199)return void(this.user.receiveResponse&&this.user.receiveResponse(e));if(r>=200&&r<=299)return this.ackRetransmissionCache.set(e.toTag,void 0),this.stateTransition(o.TransactionState.Accepted),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(r>=300&&r<=699)return this.stateTransition(o.TransactionState.Completed),this.ack(e),void(this.user.receiveResponse&&this.user.receiveResponse(e));break;case o.TransactionState.Accepted:if(r>=200&&r<=299){if(!this.ackRetransmissionCache.has(e.toTag))return this.ackRetransmissionCache.set(e.toTag,void 0),void(this.user.receiveResponse&&this.user.receiveResponse(e));var i=this.ackRetransmissionCache.get(e.toTag);return i?void this.send(i.toString()).catch(function(e){t.logTransportError(e,"Failed to send retransmission of ACK to 2xx response.")}):void 0}break;case o.TransactionState.Completed:if(r>=300&&r<=699)return void this.ack(e);break;case o.TransactionState.Terminated:break;default:throw new Error("Invalid state "+this.state)}var n="Received unexpected "+r+" response while in state "+this.state+".";this.logger.warn(n)},t.prototype.onTransportError=function(e){
this.user.onTransportError&&this.user.onTransportError(e),this.stateTransition(o.TransactionState.Terminated,!0)},t.prototype.typeToString=function(){return"INVITE client transaction"},t.prototype.ack=function(e){var t=this,r=this.request.ruri,i=this.request.callId,n=this.request.cseq,s=this.request.getHeader("from"),o=e.getHeader("to"),a=this.request.getHeader("via"),c=this.request.getHeader("route");if(!s)throw new Error("From undefined.");if(!o)throw new Error("To undefined.");if(!a)throw new Error("Via undefined.");var u="ACK "+r+" SIP/2.0\r\n";c&&(u+="Route: "+c+"\r\n"),u+="Via: "+a+"\r\n",u+="To: "+o+"\r\n",u+="From: "+s+"\r\n",u+="Call-ID: "+i+"\r\n",u+="CSeq: "+n+" ACK\r\n",u+="Max-Forwards: 70\r\n",u+="Content-Length: 0\r\n\r\n",this.send(u).catch(function(e){t.logTransportError(e,"Failed to send ACK to non-2xx response.")})},t.prototype.stateTransition=function(e,t){var r=this;void 0===t&&(t=!1);var i=function(){throw new Error("Invalid state transition from "+r.state+" to "+e)};switch(e){case o.TransactionState.Calling:i();break;case o.TransactionState.Proceeding:this.state!==o.TransactionState.Calling&&i();break;case o.TransactionState.Accepted:case o.TransactionState.Completed:this.state!==o.TransactionState.Calling&&this.state!==o.TransactionState.Proceeding&&i();break;case o.TransactionState.Terminated:this.state!==o.TransactionState.Calling&&this.state!==o.TransactionState.Accepted&&this.state!==o.TransactionState.Completed&&(t||i());break;default:i()}this.B&&(clearTimeout(this.B),this.B=void 0),o.TransactionState.Proceeding,e===o.TransactionState.Completed&&(this.D=setTimeout(function(){return r.timer_D()},n.Timers.TIMER_D)),e===o.TransactionState.Accepted&&(this.M=setTimeout(function(){return r.timer_M()},n.Timers.TIMER_M)),e===o.TransactionState.Terminated&&this.dispose(),this.setState(e)},t.prototype.timer_A=function(){},t.prototype.timer_B=function(){this.logger.debug("Timer B expired for INVITE client transaction "+this.id+"."),this.state===o.TransactionState.Calling&&(this.onRequestTimeout(),this.stateTransition(o.TransactionState.Terminated))},t.prototype.timer_D=function(){this.logger.debug("Timer D expired for INVITE client transaction "+this.id+"."),this.state===o.TransactionState.Completed&&this.stateTransition(o.TransactionState.Terminated)},t.prototype.timer_M=function(){this.logger.debug("Timer M expired for INVITE client transaction "+this.id+"."),this.state===o.TransactionState.Accepted&&this.stateTransition(o.TransactionState.Terminated)},t}(s.ClientTransaction);t.InviteClientTransaction=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Accepted="Accepted",e.Calling="Calling",e.Completed="Completed",e.Confirmed="Confirmed",e.Proceeding="Proceeding",e.Terminated="Terminated",e.Trying="Trying"}(t.TransactionState||(t.TransactionState={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(5),s=r(26),o=r(38),a=r(36),c=function(e){function t(t,r,i){return e.call(this,t,r,i,a.TransactionState.Proceeding,"sip.transaction.ist")||this}return i.__extends(t,e),t.prototype.dispose=function(){this.stopProgressExtensionTimer(),this.H&&(clearTimeout(this.H),this.H=void 0),this.I&&(clearTimeout(this.I),this.I=void 0),this.L&&(clearTimeout(this.L),this.L=void 0),e.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"kind",{get:function(){return"ist"},enumerable:!0,configurable:!0}),t.prototype.receiveRequest=function(e){var t=this;switch(this.state){case a.TransactionState.Proceeding:if(e.method===n.C.INVITE)return void(this.lastProvisionalResponse&&this.send(this.lastProvisionalResponse).catch(function(e){t.logTransportError(e,"Failed to send retransmission of provisional response.")}));break;case a.TransactionState.Accepted:if(e.method===n.C.INVITE)return;break;case a.TransactionState.Completed:if(e.method===n.C.INVITE){if(!this.lastFinalResponse)throw new Error("Last final response undefined.");return void this.send(this.lastFinalResponse).catch(function(e){t.logTransportError(e,"Failed to send retransmission of final response.")})}if(e.method===n.C.ACK)return void this.stateTransition(a.TransactionState.Confirmed);break;case a.TransactionState.Confirmed:case a.TransactionState.Terminated:if(e.method===n.C.INVITE||e.method===n.C.ACK)return;break;default:throw new Error("Invalid state "+this.state)}var r="INVITE server transaction received unexpected "+e.method+" request while in state "+this.state+".";this.logger.warn(r)},t.prototype.receiveResponse=function(e,t){var r=this;if(e<100||e>699)throw new Error("Invalid status code "+e);switch(this.state){case a.TransactionState.Proceeding:if(e>=100&&e<=199)return this.lastProvisionalResponse=t,e>100&&this.startProgressExtensionTimer(),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send 1xx response.")});if(e>=200&&e<=299)return this.lastFinalResponse=t,this.stateTransition(a.TransactionState.Accepted),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send 2xx response.")});if(e>=300&&e<=699)return this.lastFinalResponse=t,this.stateTransition(a.TransactionState.Completed),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send non-2xx final response.")});break;case a.TransactionState.Accepted:if(e>=200&&e<=299)return void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send 2xx response.")});break;case a.TransactionState.Completed:case a.TransactionState.Confirmed:case a.TransactionState.Terminated:break;default:throw new Error("Invalid state "+this.state)}var i="INVITE server transaction received unexpected "+e+" response from TU while in state "+this.state+".";throw this.logger.error(i),new Error(i)},t.prototype.retransmitAcceptedResponse=function(){var e=this;this.state===a.TransactionState.Accepted&&this.lastFinalResponse&&this.send(this.lastFinalResponse).catch(function(t){e.logTransportError(t,"Failed to send 2xx response.")})},t.prototype.onTransportError=function(e){this.user.onTransportError&&this.user.onTransportError(e)},t.prototype.typeToString=function(){return"INVITE server transaction"},t.prototype.stateTransition=function(e){var t=this,r=function(){throw new Error("Invalid state transition from "+t.state+" to "+e)};switch(e){case a.TransactionState.Proceeding:r();break;case a.TransactionState.Accepted:case a.TransactionState.Completed:this.state!==a.TransactionState.Proceeding&&r();break;case a.TransactionState.Confirmed:this.state!==a.TransactionState.Completed&&r();break;case a.TransactionState.Terminated:this.state!==a.TransactionState.Accepted&&this.state!==a.TransactionState.Completed&&this.state!==a.TransactionState.Confirmed&&r();break;default:r()}this.stopProgressExtensionTimer(),e===a.TransactionState.Accepted&&(this.L=setTimeout(function(){return t.timer_L()},s.Timers.TIMER_L)),e===a.TransactionState.Completed&&(this.H=setTimeout(function(){return t.timer_H()},s.Timers.TIMER_H)),e===a.TransactionState.Confirmed&&(this.I=setTimeout(function(){return t.timer_I()},s.Timers.TIMER_I)),e===a.TransactionState.Terminated&&this.dispose(),this.setState(e)},t.prototype.startProgressExtensionTimer=function(){var e=this;void 0===this.progressExtensionTimer&&(this.progressExtensionTimer=setInterval(function(){if(e.logger.debug("Progress extension timer expired for INVITE server transaction "+e.id+"."),!e.lastProvisionalResponse)throw new Error("Last provisional response undefined.");e.send(e.lastProvisionalResponse).catch(function(t){e.logTransportError(t,"Failed to send retransmission of provisional response.")})},s.Timers.PROVISIONAL_RESPONSE_INTERVAL))},t.prototype.stopProgressExtensionTimer=function(){void 0!==this.progressExtensionTimer&&(clearInterval(this.progressExtensionTimer),this.progressExtensionTimer=void 0)},t.prototype.timer_G=function(){},t.prototype.timer_H=function(){this.logger.debug("Timer H expired for INVITE server transaction "+this.id+"."),this.state===a.TransactionState.Completed&&(this.logger.warn("ACK to negative final response was never received, terminating transaction."),this.stateTransition(a.TransactionState.Terminated))},t.prototype.timer_I=function(){this.logger.debug("Timer I expired for INVITE server transaction "+this.id+"."),this.stateTransition(a.TransactionState.Terminated)},t.prototype.timer_L=function(){this.logger.debug("Timer L expired for INVITE server transaction "+this.id+"."),this.state===a.TransactionState.Accepted&&this.stateTransition(a.TransactionState.Terminated)},t}(o.ServerTransaction);t.InviteServerTransaction=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(29),s=function(e){function t(t,r,i,n,s){var o=e.call(this,r,i,t.viaBranch,n,s)||this;return o._request=t,o.user=i,o}return i.__extends(t,e),Object.defineProperty(t.prototype,"request",{get:function(){return this._request},enumerable:!0,configurable:!0}),t}(n.Transaction);t.ServerTransaction=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(26),s=r(28),o=r(36),a=function(e){function t(t,r,i){var s=e.call(this,t,r,i,o.TransactionState.Trying,"sip.transaction.nict")||this;return s.F=setTimeout(function(){return s.timer_F()},n.Timers.TIMER_F),s.send(t.toString()).catch(function(e){s.logTransportError(e,"Failed to send initial outgoing request.")}),s}return i.__extends(t,e),t.prototype.dispose=function(){this.F&&(clearTimeout(this.F),this.F=void 0),this.K&&(clearTimeout(this.K),this.K=void 0),e.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"kind",{get:function(){return"nict"},enumerable:!0,configurable:!0}),t.prototype.receiveResponse=function(e){var t=e.statusCode;if(!t||t<100||t>699)throw new Error("Invalid status code "+t);switch(this.state){case o.TransactionState.Trying:if(t>=100&&t<=199)return this.stateTransition(o.TransactionState.Proceeding),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(t>=200&&t<=699)return this.stateTransition(o.TransactionState.Completed),408===t?void this.onRequestTimeout():void(this.user.receiveResponse&&this.user.receiveResponse(e));break;case o.TransactionState.Proceeding:if(t>=100&&t<=199&&this.user.receiveResponse)return this.user.receiveResponse(e);if(t>=200&&t<=699)return this.stateTransition(o.TransactionState.Completed),408===t?void this.onRequestTimeout():void(this.user.receiveResponse&&this.user.receiveResponse(e));case o.TransactionState.Completed:case o.TransactionState.Terminated:return;default:throw new Error("Invalid state "+this.state)}var r="Non-INVITE client transaction received unexpected "+t+" response while in state "+this.state+".";this.logger.warn(r)},t.prototype.onTransportError=function(e){this.user.onTransportError&&this.user.onTransportError(e),this.stateTransition(o.TransactionState.Terminated,!0)},t.prototype.typeToString=function(){return"non-INVITE client transaction"},t.prototype.stateTransition=function(e,t){var r=this;void 0===t&&(t=!1);var i=function(){throw new Error("Invalid state transition from "+r.state+" to "+e)};switch(e){case o.TransactionState.Trying:i();break;case o.TransactionState.Proceeding:this.state!==o.TransactionState.Trying&&i();break;case o.TransactionState.Completed:this.state!==o.TransactionState.Trying&&this.state!==o.TransactionState.Proceeding&&i();break;case o.TransactionState.Terminated:this.state!==o.TransactionState.Trying&&this.state!==o.TransactionState.Proceeding&&this.state!==o.TransactionState.Completed&&(t||i());break;default:i()}e===o.TransactionState.Completed&&(this.F&&(clearTimeout(this.F),this.F=void 0),this.K=setTimeout(function(){return r.timer_K()},n.Timers.TIMER_K)),e===o.TransactionState.Terminated&&this.dispose(),this.setState(e)},t.prototype.timer_F=function(){this.logger.debug("Timer F expired for non-INVITE client transaction "+this.id+"."),this.state!==o.TransactionState.Trying&&this.state!==o.TransactionState.Proceeding||(this.onRequestTimeout(),this.stateTransition(o.TransactionState.Terminated))},t.prototype.timer_K=function(){this.state===o.TransactionState.Completed&&this.stateTransition(o.TransactionState.Terminated)},t}(s.ClientTransaction);t.NonInviteClientTransaction=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(26),s=r(38),o=r(36),a=function(e){function t(t,r,i){return e.call(this,t,r,i,o.TransactionState.Trying,"sip.transaction.nist")||this}return i.__extends(t,e),t.prototype.dispose=function(){this.J&&(clearTimeout(this.J),this.J=void 0),e.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"kind",{get:function(){return"nist"},enumerable:!0,configurable:!0}),t.prototype.receiveRequest=function(e){var t=this;switch(this.state){case o.TransactionState.Trying:break;case o.TransactionState.Proceeding:if(!this.lastResponse)throw new Error("Last response undefined.");this.send(this.lastResponse).catch(function(e){t.logTransportError(e,"Failed to send retransmission of provisional response.")});break;case o.TransactionState.Completed:if(!this.lastResponse)throw new Error("Last response undefined.");this.send(this.lastResponse).catch(function(e){t.logTransportError(e,"Failed to send retransmission of final response.")});break;case o.TransactionState.Terminated:break;default:throw new Error("Invalid state "+this.state)}},t.prototype.receiveResponse=function(e,t){var r=this;if(e<100||e>699)throw new Error("Invalid status code "+e);if(e>100&&e<=199)throw new Error("Provisional response other than 100 not allowed.");switch(this.state){case o.TransactionState.Trying:if(this.lastResponse=t,e>=100&&e<200)return this.stateTransition(o.TransactionState.Proceeding),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send provisional response.")});if(e>=200&&e<=699)return this.stateTransition(o.TransactionState.Completed),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send final response.")});break;case o.TransactionState.Proceeding:if(this.lastResponse=t,e>=200&&e<=699)return this.stateTransition(o.TransactionState.Completed),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send final response.")});break;case o.TransactionState.Completed:return;case o.TransactionState.Terminated:break;default:throw new Error("Invalid state "+this.state)}var i="Non-INVITE server transaction received unexpected "+e+" response from TU while in state "+this.state+".";throw this.logger.error(i),new Error(i)},t.prototype.onTransportError=function(e){this.user.onTransportError&&this.user.onTransportError(e),this.stateTransition(o.TransactionState.Terminated,!0)},t.prototype.typeToString=function(){return"non-INVITE server transaction"},t.prototype.stateTransition=function(e,t){var r=this;void 0===t&&(t=!1);var i=function(){throw new Error("Invalid state transition from "+r.state+" to "+e)};switch(e){case o.TransactionState.Trying:i();break;case o.TransactionState.Proceeding:this.state!==o.TransactionState.Trying&&i();break;case o.TransactionState.Completed:this.state!==o.TransactionState.Trying&&this.state!==o.TransactionState.Proceeding&&i();break;case o.TransactionState.Terminated:this.state!==o.TransactionState.Proceeding&&this.state!==o.TransactionState.Completed&&(t||i());break;default:i()}e===o.TransactionState.Completed&&(this.J=setTimeout(function(){return r.timer_J()},n.Timers.TIMER_J)),e===o.TransactionState.Terminated&&this.dispose(),this.setState(e)},t.prototype.timer_J=function(){this.logger.debug("Timer J expired for NON-INVITE server transaction "+this.id+"."),this.state===o.TransactionState.Completed&&this.stateTransition(o.TransactionState.Terminated)},t}(s.ServerTransaction);t.NonInviteServerTransaction=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(5),s=r(27),o=r(42),a=function(e){function t(t,r,i){var o=this,a=t.createOutgoingRequestMessage(n.C.BYE,i);return o=e.call(this,s.NonInviteClientTransaction,t.userAgentCore,a,r)||this,t.dispose(),o}return i.__extends(t,e),t}(o.UserAgentClient);t.ByeUserAgentClient=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(5),n=r(27),s=function(){function e(e,t,r,i){this.transactionConstructor=e,this.core=t,this.message=r,this.delegate=i,this.challenged=!1,this.stale=!1,this.logger=this.loggerFactory.getLogger("sip.user-agent-client"),this.init()}return e.prototype.dispose=function(){this.transaction.dispose()},Object.defineProperty(e.prototype,"loggerFactory",{get:function(){return this.core.loggerFactory},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transaction",{get:function(){if(!this._transaction)throw new Error("Transaction undefined.");return this._transaction},enumerable:!0,configurable:!0}),e.prototype.cancel=function(t,r){var s=this;if(void 0===r&&(r={}),!this.transaction)throw new Error("Transaction undefined.");if(!this.message.to)throw new Error("To undefined.");if(!this.message.from)throw new Error("From undefined.");var o=this.core.makeOutgoingRequestMessage(i.C.CANCEL,this.message.ruri,this.message.from.uri,this.message.to.uri,{toTag:this.message.toTag,fromTag:this.message.fromTag,callId:this.message.callId,cseq:this.message.cseq},r.extraHeaders);if(o.branch=this.message.branch,this.message.headers.Route&&(o.headers.Route=this.message.headers.Route),t&&o.setHeader("Reason",t),this.transaction.state===n.TransactionState.Proceeding)new e(n.NonInviteClientTransaction,this.core,o);else this.transaction.once("stateChanged",function(){if(s.transaction&&s.transaction.state===n.TransactionState.Proceeding)new e(n.NonInviteClientTransaction,s.core,o)});return o},e.prototype.authenticationGuard=function(e){var t,r,i=e.statusCode;if(!i)throw new Error("Response status code undefined.");if(401!==i&&407!==i)return!0;if(401===i?(t=e.parseHeader("www-authenticate"),r="authorization"):(t=e.parseHeader("proxy-authenticate"),r="proxy-authorization"),!t)return this.logger.warn(i+" with wrong or missing challenge, cannot authenticate"),!0;if(this.challenged&&(this.stale||!0!==t.stale))return this.logger.warn(i+" apparently in authentication loop, cannot authenticate"),!0;if(!this.credentials&&(this.credentials=this.core.configuration.authenticationFactory(),!this.credentials))return this.logger.warn("Unable to obtain credentials, cannot authenticate"),!0;if(!this.credentials.authenticate(this.message,t))return!0;this.challenged=!0,t.stale&&(this.stale=!0);var n=this.message.cseq+=1;return this.message.setHeader("cseq",n+" "+this.message.method),this.message.setHeader(r,this.credentials.toString()),this.init(),!1},e.prototype.receiveResponse=function(e){if(this.authenticationGuard(e)){var t=e.statusCode?e.statusCode.toString():"";if(!t)throw new Error("Response status code undefined.");switch(!0){case/^100$/.test(t):this.delegate&&this.delegate.onTrying&&this.delegate.onTrying({message:e});break;case/^1[0-9]{2}$/.test(t):this.delegate&&this.delegate.onProgress&&this.delegate.onProgress({message:e});break;case/^2[0-9]{2}$/.test(t):this.delegate&&this.delegate.onAccept&&this.delegate.onAccept({message:e});break;case/^3[0-9]{2}$/.test(t):this.delegate&&this.delegate.onRedirect&&this.delegate.onRedirect({message:e});break;case/^[4-6][0-9]{2}$/.test(t):this.delegate&&this.delegate.onReject&&this.delegate.onReject({message:e});break;default:throw new Error("Invalid status code "+t)}}},e.prototype.init=function(){var e=this,t={loggerFactory:this.loggerFactory,onRequestTimeout:function(){return e.onRequestTimeout()},onStateChange:function(t){t===n.TransactionState.Terminated&&(e.core.userAgentClients.delete(i),r===e._transaction&&e.dispose())},onTransportError:function(t){return e.onTransportError(t)},receiveResponse:function(t){return e.receiveResponse(t)}},r=new this.transactionConstructor(this.message,this.core.transport,t);this._transaction=r;var i=r.id+r.request.method;this.core.userAgentClients.set(i,this)},e.prototype.onRequestTimeout=function(){this.logger.warn("User agent client request timed out. Generating internal 408 Request Timeout.");var e=new i.IncomingResponseMessage;e.statusCode=408,e.reasonPhrase="Request Timeout",this.receiveResponse(e)},e.prototype.onTransportError=function(e){this.logger.error(e.message),this.logger.error("User agent client request transport error. Generating internal 503 Service Unavailable.");var t=new i.IncomingResponseMessage;t.statusCode=503,t.reasonPhrase="Service Unavailable",this.receiveResponse(t)},e}();t.UserAgentClient=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(27),s=r(44),o=function(e){function t(t,r,i){return e.call(this,n.NonInviteServerTransaction,t.userAgentCore,r,i)||this}return i.__extends(t,e),t}(s.UserAgentServer);t.ByeUserAgentServer=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(31),n=r(5),s=r(16),o=r(27),a=function(){function e(e,t,r,i){this.transactionConstructor=e,this.core=t,this.message=r,this.delegate=i,this.logger=this.loggerFactory.getLogger("sip.user-agent-server"),this.toTag=r.toTag?r.toTag:s.newTag(),this.init()}return e.prototype.dispose=function(){this.transaction.dispose()},Object.defineProperty(e.prototype,"loggerFactory",{get:function(){return this.core.loggerFactory},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transaction",{get:function(){if(!this._transaction)throw new Error("Transaction undefined.");return this._transaction},enumerable:!0,configurable:!0}),e.prototype.accept=function(e){if(void 0===e&&(e={statusCode:200}),!this.acceptable)throw new i.TransactionStateError(this.message.method+" not acceptable in state "+this.transaction.state+".");var t=e.statusCode;if(t<200||t>299)throw new TypeError("Invalid statusCode: "+t);var r=this.reply(e);return r},e.prototype.progress=function(e){if(void 0===e&&(e={statusCode:180}),!this.progressable)throw new i.TransactionStateError(this.message.method+" not progressable in state "+this.transaction.state+".");var t=e.statusCode;if(t<101||t>199)throw new TypeError("Invalid statusCode: "+t);var r=this.reply(e);return r},e.prototype.redirect=function(e,t){if(void 0===t&&(t={statusCode:302}),!this.redirectable)throw new i.TransactionStateError(this.message.method+" not redirectable in state "+this.transaction.state+".");var r=t.statusCode;if(r<300||r>399)throw new TypeError("Invalid statusCode: "+r);var n=new Array;e.forEach(function(e){return n.push("Contact: "+e.toString())}),t.extraHeaders=(t.extraHeaders||[]).concat(n);var s=this.reply(t);return s},e.prototype.reject=function(e){if(void 0===e&&(e={statusCode:480}),!this.rejectable)throw new i.TransactionStateError(this.message.method+" not rejectable in state "+this.transaction.state+".");var t=e.statusCode;if(t<400||t>699)throw new TypeError("Invalid statusCode: "+t);var r=this.reply(e);return r},e.prototype.trying=function(e){if(!this.tryingable)throw new i.TransactionStateError(this.message.method+" not tryingable in state "+this.transaction.state+".");var t=this.reply({statusCode:100});return t},e.prototype.receiveCancel=function(e){this.delegate&&this.delegate.onCancel&&this.delegate.onCancel(e)},Object.defineProperty(e.prototype,"acceptable",{get:function(){if(this.transaction instanceof o.InviteServerTransaction)return this.transaction.state===o.TransactionState.Proceeding||this.transaction.state===o.TransactionState.Accepted;if(this.transaction instanceof o.NonInviteServerTransaction)return this.transaction.state===o.TransactionState.Trying||this.transaction.state===o.TransactionState.Proceeding;throw new Error("Unknown transaction type.")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"progressable",{get:function(){if(this.transaction instanceof o.InviteServerTransaction)return this.transaction.state===o.TransactionState.Proceeding;if(this.transaction instanceof o.NonInviteServerTransaction)return!1;throw new Error("Unknown transaction type.")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"redirectable",{get:function(){if(this.transaction instanceof o.InviteServerTransaction)return this.transaction.state===o.TransactionState.Proceeding;if(this.transaction instanceof o.NonInviteServerTransaction)return this.transaction.state===o.TransactionState.Trying||this.transaction.state===o.TransactionState.Proceeding;throw new Error("Unknown transaction type.")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rejectable",{get:function(){if(this.transaction instanceof o.InviteServerTransaction)return this.transaction.state===o.TransactionState.Proceeding;if(this.transaction instanceof o.NonInviteServerTransaction)return this.transaction.state===o.TransactionState.Trying||this.transaction.state===o.TransactionState.Proceeding;throw new Error("Unknown transaction type.")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tryingable",{get:function(){if(this.transaction instanceof o.InviteServerTransaction)return this.transaction.state===o.TransactionState.Proceeding;if(this.transaction instanceof o.NonInviteServerTransaction)return this.transaction.state===o.TransactionState.Trying;throw new Error("Unknown transaction type.")},enumerable:!0,configurable:!0}),e.prototype.reply=function(e){e.toTag||100===e.statusCode||(e.toTag=this.toTag),e.userAgent=e.userAgent||this.core.configuration.userAgentHeaderFieldValue,e.supported=e.supported||this.core.configuration.supportedOptionTagsResponse;var t=n.constructOutgoingResponse(this.message,e);return this.transaction.receiveResponse(e.statusCode,t.message),t},e.prototype.init=function(){var e=this,t={loggerFactory:this.loggerFactory,onStateChange:function(t){t===o.TransactionState.Terminated&&(e.core.userAgentServers.delete(i),e.dispose())},onTransportError:function(t){e.logger.error(t.message),e.delegate&&e.delegate.onTransportError?e.delegate.onTransportError(t):e.logger.error("User agent server response transport error.")}},r=new this.transactionConstructor(this.message,this.core.transport,t);this._transaction=r;var i=r.id;this.core.userAgentServers.set(r.id,this)},e}();t.UserAgentServer=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(5),s=r(27),o=r(42),a=function(e){function t(t,r,i){var o=this,a=t.createOutgoingRequestMessage(n.C.INFO,i);return o=e.call(this,s.NonInviteClientTransaction,t.userAgentCore,a,r)||this,o}return i.__extends(t,e),t}(o.UserAgentClient);t.InfoUserAgentClient=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(27),s=r(44),o=function(e){function t(t,r,i){return e.call(this,n.NonInviteServerTransaction,t.userAgentCore,r,i)||this}return i.__extends(t,e),t}(s.UserAgentServer);t.InfoUserAgentServer=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(5),s=r(27),o=r(42),a=function(e){function t(t,r,i){var o=this,a=t.createOutgoingRequestMessage(n.C.NOTIFY,i);return o=e.call(this,s.NonInviteClientTransaction,t.userAgentCore,a,r)||this,o}return i.__extends(t,e),t}(o.UserAgentClient);t.NotifyUserAgentClient=a},function(e,t,r){"use strict";function i(e){return void 0!==e.userAgentCore}Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),s=r(27),o=r(44),a=function(e){function t(t,r,n){var o=this,a=i(t)?t.userAgentCore:t;return o=e.call(this,s.NonInviteServerTransaction,a,r,n)||this,o}return n.__extends(t,e),t}(o.UserAgentServer);t.NotifyUserAgentServer=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(5),s=r(27),o=r(42),a=function(e){function t(t,r,i){var o=this,a=t.createOutgoingRequestMessage(n.C.PRACK,i);return o=e.call(this,s.NonInviteClientTransaction,t.userAgentCore,a,r)||this,t.signalingStateTransition(a),o}return i.__extends(t,e),t}(o.UserAgentClient);t.PrackUserAgentClient=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(27),s=r(44),o=function(e){function t(t,r,i){var s=e.call(this,n.NonInviteServerTransaction,t.userAgentCore,r,i)||this;return t.signalingStateTransition(r),s.dialog=t,s}return i.__extends(t,e),t.prototype.accept=function(t){return void 0===t&&(t={statusCode:200}),t.body&&this.dialog.signalingStateTransition(t.body),e.prototype.accept.call(this,t)},t}(s.UserAgentServer);t.PrackUserAgentServer=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(5),s=r(27),o=r(42),a=function(e){function t(t,r,i){var o=this,a=t.createOutgoingRequestMessage(n.C.INVITE,i);return o=e.call(this,s.InviteClientTransaction,t.userAgentCore,a,r)||this,o.delegate=r,t.signalingStateTransition(a),t.reinviteUserAgentClient=o,o.dialog=t,o}return i.__extends(t,e),t.prototype.receiveResponse=function(e){var t=this,r=e.statusCode?e.statusCode.toString():"";if(!r)throw new Error("Response status code undefined.");switch(!0){case/^100$/.test(r):this.delegate&&this.delegate.onTrying&&this.delegate.onTrying({message:e});break;case/^1[0-9]{2}$/.test(r):this.delegate&&this.delegate.onProgress&&this.delegate.onProgress({message:e,session:this.dialog,prack:function(e){throw new Error("Unimplemented.")}});break;case/^2[0-9]{2}$/.test(r):this.dialog.signalingStateTransition(e),this.delegate&&this.delegate.onAccept&&this.delegate.onAccept({message:e,session:this.dialog,ack:function(e){var r=t.dialog.ack(e);return r}});break;case/^3[0-9]{2}$/.test(r):this.delegate&&this.delegate.onRedirect&&this.delegate.onRedirect({message:e});break;case/^[4-6][0-9]{2}$/.test(r):this.delegate&&this.delegate.onReject&&this.delegate.onReject({message:e});break;default:throw new Error("Invalid status code "+r)}},t}(o.UserAgentClient);t.ReInviteUserAgentClient=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(27),s=r(44),o=function(e){function t(t,r,i){var s=e.call(this,n.InviteServerTransaction,t.userAgentCore,r,i)||this;return t.reinviteUserAgentServer=s,s.dialog=t,s}return i.__extends(t,e),t.prototype.accept=function(t){void 0===t&&(t={statusCode:200}),t.extraHeaders=t.extraHeaders||[],t.extraHeaders=t.extraHeaders.concat(this.dialog.routeSet.map(function(e){return"Record-Route: "+e}));var r=e.prototype.accept.call(this,t),n=this.dialog,s=i.__assign({},r,{session:n});return t.body&&this.dialog.signalingStateTransition(t.body),this.dialog.reConfirm(),s},t.prototype.progress=function(t){void 0===t&&(t={statusCode:180});var r=e.prototype.progress.call(this,t),n=this.dialog,s=i.__assign({},r,{session:n});return t.body&&this.dialog.signalingStateTransition(t.body),s},t}(s.UserAgentServer);t.ReInviteUserAgentServer=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(5),s=r(27),o=r(42),a=function(e){function t(t,r,i){var o=this,a=t.createOutgoingRequestMessage(n.C.REFER,i);return o=e.call(this,s.NonInviteClientTransaction,t.userAgentCore,a,r)||this,o}return i.__extends(t,e),t}(o.UserAgentClient);t.ReferUserAgentClient=a},function(e,t,r){"use strict";function i(e){return void 0!==e.userAgentCore}Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),s=r(27),o=r(44),a=function(e){function t(t,r,n){var o=this,a=i(t)?t.userAgentCore:t;return o=e.call(this,s.NonInviteServerTransaction,a,r,n)||this,o}return n.__extends(t,e),t}(o.UserAgentServer);t.ReferUserAgentServer=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(5),s=r(56),o=r(26),a=r(58),c=r(48),u=r(59),d=r(4),p=function(e){function t(t,r,i,n,s,o){var a=e.call(this,n,s)||this;return a.delegate=o,a._autoRefresh=!1,a._subscriptionEvent=t,a._subscriptionExpires=r,a._subscriptionExpiresInitial=r,a._subscriptionExpiresLastSet=Math.floor(Date.now()/1e3),a._subscriptionRefresh=void 0,a._subscriptionRefreshLastSet=void 0,a._subscriptionState=i,a.logger=n.loggerFactory.getLogger("sip.subscribe-dialog"),a.logger.log("SUBSCRIBE dialog "+a.id+" constructed"),a}return i.__extends(t,e),
t.initialDialogStateForSubscription=function(e,t){var r=!1,i=t.getHeaders("record-route"),s=t.parseHeader("contact");if(!s)throw new Error("Contact undefined.");if(!(s instanceof n.NameAddrHeader))throw new Error("Contact not instance of NameAddrHeader.");var o=s.uri,a=e.cseq,c=void 0,u=e.callId,d=e.fromTag,p=t.fromTag;if(!u)throw new Error("Call id undefined.");if(!d)throw new Error("From tag undefined.");if(!p)throw new Error("To tag undefined.");if(!e.from)throw new Error("From undefined.");if(!e.to)throw new Error("To undefined.");var h=e.from.uri,l=e.to.uri,g=!1,f={id:u+d+p,early:g,callId:u,localTag:d,remoteTag:p,localSequenceNumber:a,remoteSequenceNumber:c,localURI:h,remoteURI:l,remoteTarget:o,routeSet:i,secure:r};return f},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.N&&(clearTimeout(this.N),this.N=void 0),this.refreshTimerClear(),this.logger.log("SUBSCRIBE dialog "+this.id+" destroyed")},Object.defineProperty(t.prototype,"autoRefresh",{get:function(){return this._autoRefresh},set:function(e){this._autoRefresh=!0,this.refreshTimerSet()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subscriptionEvent",{get:function(){return this._subscriptionEvent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subscriptionExpires",{get:function(){var e=Math.floor(Date.now()/1e3)-this._subscriptionExpiresLastSet,t=this._subscriptionExpires-e;return Math.max(t,0)},set:function(e){if(e<0)throw new Error("Expires must be greater than or equal to zero.");if(this._subscriptionExpires=e,this._subscriptionExpiresLastSet=Math.floor(Date.now()/1e3),this.autoRefresh){var t=this.subscriptionRefresh;(void 0===t||t>=e)&&this.refreshTimerSet()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subscriptionExpiresInitial",{get:function(){return this._subscriptionExpiresInitial},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subscriptionRefresh",{get:function(){if(void 0!==this._subscriptionRefresh&&void 0!==this._subscriptionRefreshLastSet){var e=Math.floor(Date.now()/1e3)-this._subscriptionRefreshLastSet,t=this._subscriptionRefresh-e;return Math.max(t,0)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subscriptionState",{get:function(){return this._subscriptionState},enumerable:!0,configurable:!0}),t.prototype.receiveRequest=function(t){if(this.logger.log("SUBSCRIBE dialog "+this.id+" received "+t.method+" request"),this.sequenceGuard(t))switch(e.prototype.receiveRequest.call(this,t),t.method){case n.C.NOTIFY:this.onNotify(t);break;default:this.logger.log("SUBSCRIBE dialog "+this.id+" received unimplemented "+t.method+" request"),this.core.replyStateless(t,{statusCode:501})}else this.logger.log("SUBSCRIBE dialog "+this.id+" rejected out of order "+t.method+" request.")},t.prototype.refresh=function(){var e="Allow: "+a.AllowedMethods.toString(),t={};return t.extraHeaders=(t.extraHeaders||[]).slice(),t.extraHeaders.push(e),t.extraHeaders.push("Event: "+this.subscriptionEvent),t.extraHeaders.push("Expires: "+this.subscriptionExpiresInitial),t.extraHeaders.push("Contact: "+this.core.configuration.contact.toString()),this.subscribe(void 0,t)},t.prototype.subscribe=function(e,t){var r=this;if(void 0===t&&(t={}),this.subscriptionState!==s.SubscriptionState.Pending&&this.subscriptionState!==s.SubscriptionState.Active)throw new Error("Invalid state "+this.subscriptionState+'. May only re-subscribe while in state "pending" or "active".');this.logger.log("SUBSCRIBE dialog "+this.id+" sending SUBSCRIBE request");var i=new u.ReSubscribeUserAgentClient(this,e,t);return this.N=setTimeout(function(){return r.timer_N()},o.Timers.TIMER_N),i},t.prototype.terminate=function(){this.stateTransition(s.SubscriptionState.Terminated),this.onTerminated()},t.prototype.unsubscribe=function(){var e="Allow: "+a.AllowedMethods.toString(),t={};return t.extraHeaders=(t.extraHeaders||[]).slice(),t.extraHeaders.push(e),t.extraHeaders.push("Event: "+this.subscriptionEvent),t.extraHeaders.push("Expires: 0"),t.extraHeaders.push("Contact: "+this.core.configuration.contact.toString()),this.subscribe(void 0,t)},t.prototype.onNotify=function(e){var t=e.parseHeader("Event").event;if(t&&t===this.subscriptionEvent){this.N&&(clearTimeout(this.N),this.N=void 0);var r=e.parseHeader("Subscription-State");if(r&&r.state){var i=r.state,n=r.expires?Math.max(r.expires,0):void 0;switch(i){case"pending":this.stateTransition(s.SubscriptionState.Pending,n);break;case"active":this.stateTransition(s.SubscriptionState.Active,n);break;case"terminated":this.stateTransition(s.SubscriptionState.Terminated,n);break;default:this.logger.warn("Unrecognized subscription state.")}var o=new c.NotifyUserAgentServer(this,e);this.delegate&&this.delegate.onNotify?this.delegate.onNotify(o):o.accept()}else this.core.replyStateless(e,{statusCode:489})}else this.core.replyStateless(e,{statusCode:489})},t.prototype.onRefresh=function(e){this.delegate&&this.delegate.onRefresh&&this.delegate.onRefresh(e)},t.prototype.onTerminated=function(){this.delegate&&this.delegate.onTerminated&&this.delegate.onTerminated()},t.prototype.refreshTimerClear=function(){this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=void 0)},t.prototype.refreshTimerSet=function(){var e=this;if(this.refreshTimerClear(),this.autoRefresh&&this.subscriptionExpires>0){var t=900*this.subscriptionExpires;this._subscriptionRefresh=Math.floor(t/1e3),this._subscriptionRefreshLastSet=Math.floor(Date.now()/1e3),this.refreshTimer=setTimeout(function(){e.refreshTimer=void 0,e._subscriptionRefresh=void 0,e._subscriptionRefreshLastSet=void 0,e.onRefresh(e.refresh())},t)}},t.prototype.stateTransition=function(e,t){var r=this,i=function(){r.logger.warn("Invalid subscription state transition from "+r.subscriptionState+" to "+e)};switch(e){case s.SubscriptionState.Initial:case s.SubscriptionState.NotifyWait:return void i();case s.SubscriptionState.Pending:if(this.subscriptionState!==s.SubscriptionState.NotifyWait&&this.subscriptionState!==s.SubscriptionState.Pending)return void i();break;case s.SubscriptionState.Active:case s.SubscriptionState.Terminated:if(this.subscriptionState!==s.SubscriptionState.NotifyWait&&this.subscriptionState!==s.SubscriptionState.Pending&&this.subscriptionState!==s.SubscriptionState.Active)return void i();break;default:return void i()}e===s.SubscriptionState.Pending&&t&&(this.subscriptionExpires=t),e===s.SubscriptionState.Active&&t&&(this.subscriptionExpires=t),e===s.SubscriptionState.Terminated&&this.dispose(),this._subscriptionState=e},t.prototype.timer_N=function(){this.subscriptionState!==s.SubscriptionState.Terminated&&(this.stateTransition(s.SubscriptionState.Terminated),this.onTerminated())},t}(d.Dialog);t.SubscriptionDialog=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1);i.__exportStar(r(57),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Initial="Initial",e.NotifyWait="NotifyWait",e.Pending="Pending",e.Active="Active",e.Terminated="Terminated"}(t.SubscriptionState||(t.SubscriptionState={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(5);t.AllowedMethods=[i.C.ACK,i.C.BYE,i.C.CANCEL,i.C.INFO,i.C.INVITE,i.C.MESSAGE,i.C.NOTIFY,i.C.OPTIONS,i.C.PRACK,i.C.REFER,i.C.SUBSCRIBE]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(5),s=r(27),o=r(42),a=function(e){function t(t,r,i){var o=this,a=t.createOutgoingRequestMessage(n.C.SUBSCRIBE,i);return o=e.call(this,s.NonInviteClientTransaction,t.userAgentCore,a,r)||this,o.dialog=t,o}return i.__extends(t,e),t.prototype.waitNotifyStop=function(){},t.prototype.receiveResponse=function(t){if(t.statusCode&&t.statusCode>=200&&t.statusCode<300){var r=t.getHeader("Expires");if(r){var i=Number(r);this.dialog.subscriptionExpires>i&&(this.dialog.subscriptionExpires=i)}else this.logger.warn("Expires header missing in a 200-class response to SUBSCRIBE")}if(t.statusCode&&t.statusCode>=400&&t.statusCode<700){var n=[404,405,410,416,480,481,482,483,484,485,489,501,604];n.includes(t.statusCode)&&this.dialog.terminate()}e.prototype.receiveResponse.call(this,t)},t}(o.UserAgentClient);t.ReSubscribeUserAgentClient=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1);i.__exportStar(r(61),t),i.__exportStar(r(62),t),i.__exportStar(r(63),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.error=0]="error",e[e.warn=1]="warn",e[e.log=2]="log",e[e.debug=3]="debug"}(t.Levels||(t.Levels={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(61),n=r(63),s=function(){function e(){this.builtinEnabled=!0,this._level=i.Levels.log,this.loggers={},this.logger=this.getLogger("sip:loggerfactory")}return Object.defineProperty(e.prototype,"level",{get:function(){return this._level},set:function(e){e>=0&&e<=3?this._level=e:e>3?this._level=3:i.Levels.hasOwnProperty(e)?this._level=e:this.logger.error("invalid 'level' parameter value: "+JSON.stringify(e))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connector",{get:function(){return this._connector},set:function(e){e?"function"==typeof e?this._connector=e:this.logger.error("invalid 'connector' parameter value: "+JSON.stringify(e)):this._connector=void 0},enumerable:!0,configurable:!0}),e.prototype.getLogger=function(e,t){if(t&&3===this.level)return new n.Logger(this,e,t);if(this.loggers[e])return this.loggers[e];var r=new n.Logger(this,e);return this.loggers[e]=r,r},e.prototype.genericLog=function(e,t,r,n){this.level>=e&&this.builtinEnabled&&this.print(e,t,r,n),this.connector&&this.connector(i.Levels[e],t,r,n)},e.prototype.print=function(e,t,r,n){if("string"==typeof n){var s=[new Date,t];r&&s.push(r),n=s.concat(n).join(" | ")}switch(e){case i.Levels.error:console.error(n);break;case i.Levels.warn:console.warn(n);break;case i.Levels.log:console.log(n);break;case i.Levels.debug:console.debug(n)}},e}();t.LoggerFactory=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(61),n=function(){function e(e,t,r){this.logger=e,this.category=t,this.label=r}return e.prototype.error=function(e){this.genericLog(i.Levels.error,e)},e.prototype.warn=function(e){this.genericLog(i.Levels.warn,e)},e.prototype.log=function(e){this.genericLog(i.Levels.log,e)},e.prototype.debug=function(e){this.genericLog(i.Levels.debug,e)},e.prototype.genericLog=function(e,t){this.logger.genericLog(e,this.category,this.label,t)},e}();t.Logger=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1);i.__exportStar(r(65),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(5),s=r(27),o=r(66),a=r(58),c=["application/sdp","application/dtmf-relay"],u=function(){function e(e,t){void 0===t&&(t={}),this.userAgentClients=new Map,this.userAgentServers=new Map,this.configuration=e,this.delegate=t,this.dialogs=new Map,this.subscribers=new Map,this.logger=e.loggerFactory.getLogger("sip.user-agent-core")}return e.prototype.dispose=function(){this.reset()},e.prototype.reset=function(){this.dialogs.forEach(function(e){return e.dispose()}),this.dialogs.clear(),this.subscribers.forEach(function(e){return e.dispose()}),this.subscribers.clear(),this.userAgentClients.forEach(function(e){return e.dispose()}),this.userAgentClients.clear(),this.userAgentServers.forEach(function(e){return e.dispose()}),this.userAgentServers.clear()},Object.defineProperty(e.prototype,"loggerFactory",{get:function(){return this.configuration.loggerFactory},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transport",{get:function(){var e=this.configuration.transportAccessor();if(!e)throw new Error("Transport undefined.");return e},enumerable:!0,configurable:!0}),e.prototype.invite=function(e,t){return new o.InviteUserAgentClient(this,e,t)},e.prototype.message=function(e,t){return new o.MessageUserAgentClient(this,e,t)},e.prototype.publish=function(e,t){return new o.PublishUserAgentClient(this,e,t)},e.prototype.register=function(e,t){return new o.RegisterUserAgentClient(this,e,t)},e.prototype.subscribe=function(e,t){return new o.SubscribeUserAgentClient(this,e,t)},e.prototype.request=function(e,t){return new o.UserAgentClient(s.NonInviteClientTransaction,this,e,t)},e.prototype.makeOutgoingRequestMessage=function(e,t,r,s,o,a,c){var u=this.configuration.sipjsId,d=this.configuration.displayName,p=this.configuration.viaForceRport,h=this.configuration.hackViaTcp,l=this.configuration.supportedOptionTags.slice();e===n.C.REGISTER&&l.push("path","gruu"),e===n.C.INVITE&&(this.configuration.contact.pubGruu||this.configuration.contact.tempGruu)&&l.push("gruu");var g=this.configuration.routeSet,f=this.configuration.userAgentHeaderFieldValue,m=this.configuration.viaHost,v={callIdPrefix:u,forceRport:p,fromDisplayName:d,hackViaTcp:h,optionTags:l,routeSet:g,userAgentString:f,viaHost:m},S=i.__assign({},v,o);return new n.OutgoingRequestMessage(e,t,r,s,S,a,c)},e.prototype.receiveIncomingRequestFromTransport=function(e){this.receiveRequestFromTransport(e)},e.prototype.receiveIncomingResponseFromTransport=function(e){this.receiveResponseFromTransport(e)},e.prototype.replyStateless=function(e,t){var r=this.configuration.userAgentHeaderFieldValue,s=this.configuration.supportedOptionTagsResponse;t=i.__assign({},t,{userAgent:r,supported:s});var o=n.constructOutgoingResponse(e,t);return this.transport.send(o.message),o},e.prototype.receiveRequestFromTransport=function(e){var t=e.viaBranch,r=this.userAgentServers.get(t);e.method===n.C.ACK&&r&&r.transaction.state===s.TransactionState.Accepted&&r instanceof o.InviteUserAgentServer?this.logger.warn("Discarding out of dialog ACK after 2xx response sent on transaction "+t+"."):e.method!==n.C.CANCEL?r?r.transaction.receiveRequest(e):this.receiveRequest(e):r?(this.replyStateless(e,{statusCode:200}),r.transaction instanceof s.InviteServerTransaction&&r.transaction.state===s.TransactionState.Proceeding&&r instanceof o.InviteUserAgentServer&&r.receiveCancel(e)):this.replyStateless(e,{statusCode:481})},e.prototype.receiveRequest=function(e){if(a.AllowedMethods.includes(e.method)){if(!e.ruri)throw new Error("Request-URI undefined.");if("sip"===e.ruri.scheme){var t=e.ruri,r=function(e){return!!e&&e.user===t.user};if(!r(this.configuration.aor)&&!(r(this.configuration.contact.uri)||r(this.configuration.contact.pubGruu)||r(this.configuration.contact.tempGruu)))return this.logger.warn("Request-URI does not point to us."),void(e.method!==n.C.ACK&&this.replyStateless(e,{statusCode:404}));if(e.method!==n.C.INVITE||e.hasHeader("Contact")){if(!e.toTag){var i=e.viaBranch;if(!this.userAgentServers.has(i)){var s=Array.from(this.userAgentServers.values()).some(function(t){return t.transaction.request.fromTag===e.fromTag&&t.transaction.request.callId===e.callId&&t.transaction.request.cseq===e.cseq});if(s)return void this.replyStateless(e,{statusCode:482})}}e.toTag?this.receiveInsideDialogRequest(e):this.receiveOutsideDialogRequest(e)}else this.replyStateless(e,{statusCode:400,reasonPhrase:"Missing Contact Header"})}else this.replyStateless(e,{statusCode:416})}else{var o="Allow: "+a.AllowedMethods.toString();this.replyStateless(e,{statusCode:405,extraHeaders:[o]})}},e.prototype.receiveInsideDialogRequest=function(e){if(e.method===n.C.NOTIFY){var t=e.parseHeader("Event");if(!t||!t.event)return void this.replyStateless(e,{statusCode:489});var r=e.callId+e.toTag+t.event,i=this.subscribers.get(r);if(i){var s=new o.NotifyUserAgentServer(this,e);return void i.onNotify(s)}}var u=e.callId+e.toTag+e.fromTag,d=this.dialogs.get(u);if(d){if(e.method===n.C.OPTIONS){var p="Allow: "+a.AllowedMethods.toString(),h="Accept: "+c.toString();return void this.replyStateless(e,{statusCode:200,extraHeaders:[p,h]})}d.receiveRequest(e)}else e.method!==n.C.ACK&&this.replyStateless(e,{statusCode:481})},e.prototype.receiveOutsideDialogRequest=function(e){switch(e.method){case n.C.ACK:break;case n.C.BYE:this.replyStateless(e,{statusCode:481});break;case n.C.CANCEL:throw new Error("Unexpected out of dialog request method "+e.method+".");case n.C.INFO:this.replyStateless(e,{statusCode:405});break;case n.C.INVITE:var t=new o.InviteUserAgentServer(this,e);this.delegate.onInvite?this.delegate.onInvite(t):t.reject();break;case n.C.MESSAGE:t=new o.MessageUserAgentServer(this,e);this.delegate.onMessage?this.delegate.onMessage(t):t.accept();break;case n.C.NOTIFY:t=new o.NotifyUserAgentServer(this,e);this.delegate.onNotify?this.delegate.onNotify(t):this.replyStateless(e,{statusCode:405});break;case n.C.OPTIONS:var r="Allow: "+a.AllowedMethods.toString(),i="Accept: "+c.toString();this.replyStateless(e,{statusCode:200,extraHeaders:[r,i]});break;case n.C.REFER:t=new o.ReferUserAgentServer(this,e);this.delegate.onRefer?this.delegate.onRefer(t):this.replyStateless(e,{statusCode:405});break;case n.C.SUBSCRIBE:t=new o.SubscribeUserAgentServer(this,e);this.delegate.onSubscribe?this.delegate.onSubscribe(t):t.reject();break;default:throw new Error("Unexpected out of dialog request method "+e.method+".")}},e.prototype.receiveResponseFromTransport=function(e){if(e.getHeaders("via").length>1)this.logger.warn("More than one Via header field present in the response, dropping");else{var t=e.viaBranch+e.method,r=this.userAgentClients.get(t);r?r.transaction.receiveResponse(e):this.logger.warn("Discarding unmatched "+e.statusCode+" response to "+e.method+" "+t+".")}},e}();t.UserAgentCore=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1);i.__exportStar(r(41),t),i.__exportStar(r(43),t),i.__exportStar(r(67),t),i.__exportStar(r(45),t),i.__exportStar(r(46),t),i.__exportStar(r(68),t),i.__exportStar(r(69),t),i.__exportStar(r(70),t),i.__exportStar(r(71),t),i.__exportStar(r(47),t),i.__exportStar(r(48),t),i.__exportStar(r(72),t),i.__exportStar(r(49),t),i.__exportStar(r(50),t),i.__exportStar(r(51),t),i.__exportStar(r(52),t),i.__exportStar(r(59),t),i.__exportStar(r(73),t),i.__exportStar(r(53),t),i.__exportStar(r(54),t),i.__exportStar(r(74),t),i.__exportStar(r(75),t),i.__exportStar(r(76),t),i.__exportStar(r(42),t),i.__exportStar(r(44),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(27),s=r(42),o=function(e){function t(t,r,i){return e.call(this,n.NonInviteClientTransaction,t,r,i)||this}return i.__extends(t,e),t}(s.UserAgentClient);t.CancelUserAgentClient=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(3),s=r(24),o=r(27),a=r(42),c=function(e){function t(t,r,i){var n=e.call(this,o.InviteClientTransaction,t,r,i)||this;return n.confirmedDialogAcks=new Map,n.confirmedDialogs=new Map,n.earlyDialogs=new Map,n.delegate=i,n}return i.__extends(t,e),t.prototype.dispose=function(){this.earlyDialogs.forEach(function(e){return e.dispose()}),this.earlyDialogs.clear(),e.prototype.dispose.call(this)},t.prototype.receiveResponse=function(e){var t=this;if(this.authenticationGuard(e)){var r=e.statusCode?e.statusCode.toString():"";if(!r)throw new Error("Response status code undefined.");switch(!0){case/^100$/.test(r):return void(this.delegate&&this.delegate.onTrying&&this.delegate.onTrying({message:e}));case/^1[0-9]{2}$/.test(r):if(!e.toTag)return void this.logger.warn("Non-100 1xx INVITE response received without a to tag, dropping.");var i=n.Dialog.initialDialogStateForUserAgentClient(this.message,e),a=this.earlyDialogs.get(i.id);if(!a){var c=this.transaction;if(!(c instanceof o.InviteClientTransaction))throw new Error("Transaction not instance of InviteClientTransaction.");a=new n.SessionDialog(c,this.core,i),this.earlyDialogs.set(a.id,a)}if(!a.reliableSequenceGuard(e))return void this.logger.warn("1xx INVITE reliable response received out of order, dropping.");a.signalingState!==s.SignalingState.Initial&&a.signalingState!==s.SignalingState.HaveLocalOffer||a.signalingStateTransition(e);var u=a;return void(this.delegate&&this.delegate.onProgress&&this.delegate.onProgress({message:e,session:u,prack:function(e){var t=u.prack(void 0,e);return t}}));case/^2[0-9]{2}$/.test(r):i=n.Dialog.initialDialogStateForUserAgentClient(this.message,e);var d=this.confirmedDialogs.get(i.id);if(d){var p=this.confirmedDialogAcks.get(i.id);if(p){c=this.transaction;if(!(c instanceof o.InviteClientTransaction))throw new Error("Client transaction not instance of InviteClientTransaction.");c.ackResponse(p.message)}return}if(d=this.earlyDialogs.get(i.id),d)d.confirm(),d.recomputeRouteSet(e),this.earlyDialogs.delete(d.id),this.confirmedDialogs.set(d.id,d);else{c=this.transaction;if(!(c instanceof o.InviteClientTransaction))throw new Error("Transaction not instance of InviteClientTransaction.");d=new n.SessionDialog(c,this.core,i),this.confirmedDialogs.set(d.id,d)}d.signalingState!==s.SignalingState.Initial&&d.signalingState!==s.SignalingState.HaveLocalOffer||d.signalingStateTransition(e);var h=d;if(this.delegate&&this.delegate.onAccept)this.delegate.onAccept({message:e,session:h,ack:function(e){var r=h.ack(e);return t.confirmedDialogAcks.set(h.id,r),r}});else{p=h.ack();this.confirmedDialogAcks.set(h.id,p)}return;case/^3[0-9]{2}$/.test(r):return this.earlyDialogs.forEach(function(e){return e.dispose()}),this.earlyDialogs.clear(),void(this.delegate&&this.delegate.onRedirect&&this.delegate.onRedirect({message:e}));case/^[4-6][0-9]{2}$/.test(r):return this.earlyDialogs.forEach(function(e){return e.dispose()}),this.earlyDialogs.clear(),void(this.delegate&&this.delegate.onReject&&this.delegate.onReject({message:e}));default:throw new Error("Invalid status code "+r)}throw new Error("Executing what should be an unreachable code path receiving "+r+" response.")}},t}(a.UserAgentClient);t.InviteUserAgentClient=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(3),s=r(31),o=r(24),a=r(27),c=r(58),u=r(44),d=function(e){function t(t,r,i){var n=e.call(this,a.InviteServerTransaction,t,r,i)||this;return n.core=t,n}return i.__extends(t,e),t.prototype.dispose=function(){this.earlyDialog&&this.earlyDialog.dispose(),e.prototype.dispose.call(this)},t.prototype.accept=function(t){if(void 0===t&&(t={statusCode:200}),!this.acceptable)throw new s.TransactionStateError(this.message.method+" not acceptable in state "+this.transaction.state+".");if(!this.confirmedDialog)if(this.earlyDialog)this.earlyDialog.confirm(),this.confirmedDialog=this.earlyDialog,this.earlyDialog=void 0;else{var r=this.transaction;if(!(r instanceof a.InviteServerTransaction))throw new Error("Transaction not instance of InviteClientTransaction.");var u=n.Dialog.initialDialogStateForUserAgentServer(this.message,this.toTag);this.confirmedDialog=new n.SessionDialog(r,this.core,u)}var d=this.message.getHeaders("record-route").map(function(e){return"Record-Route: "+e}),p="Contact: "+this.core.configuration.contact.toString(),h="Allow: "+c.AllowedMethods.toString();if(!t.body)if(this.confirmedDialog.signalingState===o.SignalingState.Stable)t.body=this.confirmedDialog.answer;else if(this.confirmedDialog.signalingState===o.SignalingState.Initial||this.confirmedDialog.signalingState===o.SignalingState.HaveRemoteOffer)throw new Error("Response must have a body.");t.statusCode=t.statusCode||200,t.extraHeaders=t.extraHeaders||[],t.extraHeaders=t.extraHeaders.concat(d),t.extraHeaders.push(h),t.extraHeaders.push(p);var l=e.prototype.accept.call(this,t),g=this.confirmedDialog,f=i.__assign({},l,{session:g});return t.body&&this.confirmedDialog.signalingState!==o.SignalingState.Stable&&this.confirmedDialog.signalingStateTransition(t.body),f},t.prototype.progress=function(t){if(void 0===t&&(t={statusCode:180}),!this.progressable)throw new s.TransactionStateError(this.message.method+" not progressable in state "+this.transaction.state+".");if(!this.earlyDialog){var r=this.transaction;if(!(r instanceof a.InviteServerTransaction))throw new Error("Transaction not instance of InviteClientTransaction.");var c=n.Dialog.initialDialogStateForUserAgentServer(this.message,this.toTag,!0);this.earlyDialog=new n.SessionDialog(r,this.core,c)}var u=this.message.getHeaders("record-route").map(function(e){return"Record-Route: "+e}),d="Contact: "+this.core.configuration.contact;t.extraHeaders=t.extraHeaders||[],t.extraHeaders=t.extraHeaders.concat(u),t.extraHeaders.push(d);var p=e.prototype.progress.call(this,t),h=this.earlyDialog,l=i.__assign({},p,{session:h});return t.body&&this.earlyDialog.signalingState!==o.SignalingState.Stable&&this.earlyDialog.signalingStateTransition(t.body),l},t.prototype.redirect=function(t,r){return void 0===r&&(r={statusCode:302}),e.prototype.redirect.call(this,t,r)},t.prototype.reject=function(t){return void 0===t&&(t={statusCode:486}),e.prototype.reject.call(this,t)},t}(u.UserAgentServer);t.InviteUserAgentServer=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(27),s=r(42),o=function(e){function t(t,r,i){return e.call(this,n.NonInviteClientTransaction,t,r,i)||this}return i.__extends(t,e),t}(s.UserAgentClient);t.MessageUserAgentClient=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(27),s=r(44),o=function(e){function t(t,r,i){var s=e.call(this,n.NonInviteServerTransaction,t,r,i)||this;return s.core=t,s}return i.__extends(t,e),t}(s.UserAgentServer);t.MessageUserAgentServer=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(27),s=r(42),o=function(e){function t(t,r,i){return e.call(this,n.NonInviteClientTransaction,t,r,i)||this}return i.__extends(t,e),t}(s.UserAgentClient);t.PublishUserAgentClient=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(27),s=r(44),o=function(e){function t(t,r,i){return e.call(this,n.NonInviteServerTransaction,t.userAgentCore,r,i)||this}return i.__extends(t,e),t}(s.UserAgentServer);t.ReSubscribeUserAgentServer=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(27),s=r(42),o=function(e){function t(t,r,i){return e.call(this,n.NonInviteClientTransaction,t,r,i)||this}return i.__extends(t,e),t}(s.UserAgentClient);t.RegisterUserAgentClient=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(55),s=r(56),o=r(26),a=r(27),c=r(42),u=function(e){function t(t,r,i){var n=this,o=r.getHeader("Event");if(!o)throw new Error("Event undefined");var c=r.getHeader("Expires");if(!c)throw new Error("Expires undefined");return n=e.call(this,a.NonInviteClientTransaction,t,r,i)||this,n.delegate=i,n.subscriberId=r.callId+r.fromTag+o,n.subscriptionExpiresRequested=n.subscriptionExpires=Number(c),n.subscriptionEvent=o,n.subscriptionState=s.SubscriptionState.NotifyWait,n.waitNotifyStart(),n}return i.__extends(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this)},t.prototype.onNotify=function(e){var t=e.message.parseHeader("Event").event;if(!t||t!==this.subscriptionEvent)return this.logger.warn("Failed to parse event."),void e.reject({statusCode:489});var r=e.message.parseHeader("Subscription-State");if(!r||!r.state)return this.logger.warn("Failed to parse subscription state."),void e.reject({statusCode:489});var i=r.state;switch(i){case"pending":case"active":case"terminated":break;default:return this.logger.warn("Invalid subscription state "+i),void e.reject({statusCode:489})}if("terminated"!==i){var o=e.message.parseHeader("contact");if(!o)return this.logger.warn("Failed to parse contact."),void e.reject({statusCode:489})}if(this.dialog)throw new Error("Dialog already created. This implementation only supports install of single subscriptions.");switch(this.waitNotifyStop(),this.subscriptionExpires=r.expires?Math.min(this.subscriptionExpires,Math.max(r.expires,0)):this.subscriptionExpires,i){case"pending":this.subscriptionState=s.SubscriptionState.Pending;break;case"active":this.subscriptionState=s.SubscriptionState.Active;break;case"terminated":this.subscriptionState=s.SubscriptionState.Terminated;break;default:throw new Error("Unrecognized state "+i+".")}if(this.subscriptionState!==s.SubscriptionState.Terminated){var a=n.SubscriptionDialog.initialDialogStateForSubscription(this.message,e.message);this.dialog=new n.SubscriptionDialog(this.subscriptionEvent,this.subscriptionExpires,this.subscriptionState,this.core,a)}if(this.delegate&&this.delegate.onNotify){var c=e,u=this.dialog;this.delegate.onNotify({request:c,subscription:u})}else e.accept()},t.prototype.waitNotifyStart=function(){var e=this;this.N||(this.core.subscribers.set(this.subscriberId,this),this.N=setTimeout(function(){return e.timer_N()},o.Timers.TIMER_N))},t.prototype.waitNotifyStop=function(){this.N&&(this.core.subscribers.delete(this.subscriberId),clearTimeout(this.N),this.N=void 0)},t.prototype.receiveResponse=function(t){if(this.authenticationGuard(t)){if(t.statusCode&&t.statusCode>=200&&t.statusCode<300){var r=t.getHeader("Expires");if(r){var i=Number(r);i>this.subscriptionExpiresRequested&&this.logger.warn("Expires header in a 200-class response to SUBSCRIBE with a higher value than the one in the request"),i<this.subscriptionExpires&&(this.subscriptionExpires=i)}else this.logger.warn("Expires header missing in a 200-class response to SUBSCRIBE");this.dialog&&this.dialog.subscriptionExpires>this.subscriptionExpires&&(this.dialog.subscriptionExpires=this.subscriptionExpires)}t.statusCode&&t.statusCode>=300&&t.statusCode<700&&this.waitNotifyStop(),e.prototype.receiveResponse.call(this,t)}},t.prototype.timer_N=function(){this.logger.warn("Timer N expired for SUBSCRIBE user agent client. Timed out waiting for NOTIFY."),this.waitNotifyStop(),this.delegate&&this.delegate.onNotifyTimeout&&this.delegate.onNotifyTimeout()},t}(c.UserAgentClient);t.SubscribeUserAgentClient=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(27),s=r(44),o=function(e){function t(t,r,i){var s=e.call(this,n.NonInviteServerTransaction,t,r,i)||this;return s.core=t,s}return i.__extends(t,e),t}(s.UserAgentServer);t.SubscribeUserAgentServer=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(30),s=function(e){function t(t,r){var i=e.call(this)||this;return i.logger=t,i}return i.__extends(t,e),t.prototype.connect=function(e){var t=this;return void 0===e&&(e={}),this.connectPromise(e).then(function(e){e.overrideEvent||t.emit("connected")})},t.prototype.send=function(e,t){var r=this;return void 0===t&&(t={}),this.sendPromise(e).then(function(e){e.overrideEvent||r.emit("messageSent",e.msg)})},t.prototype.disconnect=function(e){var t=this;return void 0===e&&(e={}),this.disconnectPromise(e).then(function(e){e.overrideEvent||t.emit("disconnected")})},t.prototype.afterConnected=function(e){this.isConnected()?e():this.once("connected",e)},t.prototype.waitForConnected=function(){var e=this;return console.warn("DEPRECATION WARNING Transport.waitForConnected(): use afterConnected() instead"),new Promise(function(t){e.afterConnected(t)})},t}(n.EventEmitter);t.Transport=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(30),s=r(79),o=r(2),a=r(80),c=r(81),u=function(e){function t(r,i,n,s){var o=e.call(this)||this;return o.data={},t.initializer(o,r,i,n,s),o}return i.__extends(t,e),t.initializer=function(e,t,r,i,n){if(e.type=a.TypeStrings.ClientContext,void 0===i)throw new TypeError("Not enough arguments");e.ua=t,e.logger=t.getLogger("sip.clientcontext"),e.method=r;var s=t.normalizeTarget(i);if(!s)throw new TypeError("Invalid target: "+i);var u=t.userAgentCore.configuration.aor;if(n&&n.params&&n.params.fromUri&&(u="string"==typeof n.params.fromUri?o.Grammar.URIParse(n.params.fromUri):n.params.fromUri,!u))throw new TypeError("Invalid from URI: "+n.params.fromUri);var d=s
;if(n&&n.params&&n.params.toUri&&(d="string"==typeof n.params.toUri?o.Grammar.URIParse(n.params.toUri):n.params.toUri,!d))throw new TypeError("Invalid to URI: "+n.params.toUri);n=Object.create(n||Object.prototype),n=n||{};var p,h,l=(n.extraHeaders||[]).slice(),g=n.params||{};n.body&&(p={body:n.body,contentType:n.contentType?n.contentType:"application/sdp"},e.body=p),p&&(h=c.Utils.fromBodyObj(p)),e.request=t.userAgentCore.makeOutgoingRequestMessage(r,s,u,d,g,l,h),e.request.from&&(e.localIdentity=e.request.from),e.request.to&&(e.remoteIdentity=e.request.to)},t.prototype.send=function(){var e=this;return this.ua.userAgentCore.request(this.request,{onAccept:function(t){return e.receiveResponse(t.message)},onProgress:function(t){return e.receiveResponse(t.message)},onRedirect:function(t){return e.receiveResponse(t.message)},onReject:function(t){return e.receiveResponse(t.message)},onTrying:function(t){return e.receiveResponse(t.message)}}),this},t.prototype.receiveResponse=function(e){var t=e.statusCode||0,r=c.Utils.getReasonPhrase(t);switch(!0){case/^1[0-9]{2}$/.test(t.toString()):this.emit("progress",e,r);break;case/^2[0-9]{2}$/.test(t.toString()):this.ua.applicants[this.toString()]&&delete this.ua.applicants[this.toString()],this.emit("accepted",e,r);break;default:this.ua.applicants[this.toString()]&&delete this.ua.applicants[this.toString()],this.emit("rejected",e,r),this.emit("failed",e,r)}},t.prototype.onRequestTimeout=function(){this.emit("failed",void 0,s.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",void 0,s.C.causes.CONNECTION_ERROR)},t}(n.EventEmitter);t.ClientContext=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="0.15.0";(function(e){e.version=i,e.USER_AGENT="SIP.js/"+i,e.SIP="sip",e.SIPS="sips",function(e){e.CONNECTION_ERROR="Connection Error",e.INTERNAL_ERROR="Internal Error",e.REQUEST_TIMEOUT="Request Timeout",e.SIP_FAILURE_CODE="SIP Failure Code",e.ADDRESS_INCOMPLETE="Address Incomplete",e.AUTHENTICATION_ERROR="Authentication Error",e.BUSY="Busy",e.DIALOG_ERROR="Dialog Error",e.INCOMPATIBLE_SDP="Incompatible SDP",e.NOT_FOUND="Not Found",e.REDIRECTED="Redirected",e.REJECTED="Rejected",e.UNAVAILABLE="Unavailable",e.BAD_MEDIA_DESCRIPTION="Bad Media Description",e.CANCELED="Canceled",e.EXPIRES="Expires",e.NO_ACK="No ACK",e.NO_ANSWER="No Answer",e.NO_PRACK="No PRACK",e.RTP_TIMEOUT="RTP Timeout",e.USER_DENIED_MEDIA_ACCESS="User Denied Media Access",e.WEBRTC_ERROR="WebRTC Error",e.WEBRTC_NOT_SUPPORTED="WebRTC Not Supported"}(e.causes||(e.causes={})),function(e){e.REQUIRED="required",e.SUPPORTED="supported",e.UNSUPPORTED="none"}(e.supported||(e.supported={})),e.SIP_ERROR_CAUSES={ADDRESS_INCOMPLETE:[484],AUTHENTICATION_ERROR:[401,407],BUSY:[486,600],INCOMPATIBLE_SDP:[488,606],NOT_FOUND:[404,604],REDIRECTED:[300,301,302,305,380],REJECTED:[403,603],UNAVAILABLE:[480,410,408,430]},e.ACK="ACK",e.BYE="BYE",e.CANCEL="CANCEL",e.INFO="INFO",e.INVITE="INVITE",e.MESSAGE="MESSAGE",e.NOTIFY="NOTIFY",e.OPTIONS="OPTIONS",e.REGISTER="REGISTER",e.UPDATE="UPDATE",e.SUBSCRIBE="SUBSCRIBE",e.PUBLISH="PUBLISH",e.REFER="REFER",e.PRACK="PRACK",e.REASON_PHRASE={100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},e.OPTION_TAGS={"100rel":!0,199:!0,answermode:!0,"early-session":!0,eventlist:!0,explicitsub:!0,"from-change":!0,"geolocation-http":!0,"geolocation-sip":!0,gin:!0,gruu:!0,histinfo:!0,ice:!0,join:!0,"multiple-refer":!0,norefersub:!0,nosub:!0,outbound:!0,path:!0,policy:!0,precondition:!0,pref:!0,privacy:!0,"recipient-list-invite":!0,"recipient-list-message":!0,"recipient-list-subscribe":!0,replaces:!0,"resource-priority":!0,"sdp-anat":!0,"sec-agree":!0,tdialog:!0,timer:!0,uui:!0},function(e){e.INFO="info",e.RTP="rtp"}(e.dtmfType||(e.dtmfType={}))})(t.C||(t.C={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.STATUS_EARLY=1]="STATUS_EARLY",e[e.STATUS_CONFIRMED=2]="STATUS_CONFIRMED"}(t.DialogStatus||(t.DialogStatus={})),function(e){e[e.STATUS_NULL=0]="STATUS_NULL",e[e.STATUS_INVITE_SENT=1]="STATUS_INVITE_SENT",e[e.STATUS_1XX_RECEIVED=2]="STATUS_1XX_RECEIVED",e[e.STATUS_INVITE_RECEIVED=3]="STATUS_INVITE_RECEIVED",e[e.STATUS_WAITING_FOR_ANSWER=4]="STATUS_WAITING_FOR_ANSWER",e[e.STATUS_ANSWERED=5]="STATUS_ANSWERED",e[e.STATUS_WAITING_FOR_PRACK=6]="STATUS_WAITING_FOR_PRACK",e[e.STATUS_WAITING_FOR_ACK=7]="STATUS_WAITING_FOR_ACK",e[e.STATUS_CANCELED=8]="STATUS_CANCELED",e[e.STATUS_TERMINATED=9]="STATUS_TERMINATED",e[e.STATUS_ANSWERED_WAITING_FOR_PRACK=10]="STATUS_ANSWERED_WAITING_FOR_PRACK",e[e.STATUS_EARLY_MEDIA=11]="STATUS_EARLY_MEDIA",e[e.STATUS_CONFIRMED=12]="STATUS_CONFIRMED"}(t.SessionStatus||(t.SessionStatus={})),function(e){e[e.ClientContext=0]="ClientContext",e[e.ConfigurationError=1]="ConfigurationError",e[e.Dialog=2]="Dialog",e[e.DigestAuthentication=3]="DigestAuthentication",e[e.DTMF=4]="DTMF",e[e.IncomingMessage=5]="IncomingMessage",e[e.IncomingRequest=6]="IncomingRequest",e[e.IncomingResponse=7]="IncomingResponse",e[e.InvalidStateError=8]="InvalidStateError",e[e.InviteClientContext=9]="InviteClientContext",e[e.InviteServerContext=10]="InviteServerContext",e[e.Logger=11]="Logger",e[e.LoggerFactory=12]="LoggerFactory",e[e.MethodParameterError=13]="MethodParameterError",e[e.NameAddrHeader=14]="NameAddrHeader",e[e.NotSupportedError=15]="NotSupportedError",e[e.OutgoingRequest=16]="OutgoingRequest",e[e.Parameters=17]="Parameters",e[e.PublishContext=18]="PublishContext",e[e.ReferClientContext=19]="ReferClientContext",e[e.ReferServerContext=20]="ReferServerContext",e[e.RegisterContext=21]="RegisterContext",e[e.RenegotiationError=22]="RenegotiationError",e[e.RequestSender=23]="RequestSender",e[e.ServerContext=24]="ServerContext",e[e.Session=25]="Session",e[e.SessionDescriptionHandler=26]="SessionDescriptionHandler",e[e.SessionDescriptionHandlerError=27]="SessionDescriptionHandlerError",e[e.SessionDescriptionHandlerObserver=28]="SessionDescriptionHandlerObserver",e[e.Subscription=29]="Subscription",e[e.Transport=30]="Transport",e[e.UA=31]="UA",e[e.URI=32]="URI"}(t.TypeStrings||(t.TypeStrings={})),function(e){e[e.STATUS_INIT=0]="STATUS_INIT",e[e.STATUS_STARTING=1]="STATUS_STARTING",e[e.STATUS_READY=2]="STATUS_READY",e[e.STATUS_USER_CLOSED=3]="STATUS_USER_CLOSED",e[e.STATUS_NOT_READY=4]="STATUS_NOT_READY"}(t.UAStatus||(t.UAStatus={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(79),n=r(11),s=r(15);(function(e){function t(){var e={};return e.promise=new Promise(function(t,r){e.resolve=t,e.reject=r}),e}function r(e,t){return e.reduce(function(e,t){return e=e.then(t),e},Promise.resolve(t))}function o(e){return encodeURIComponent(e).replace(/%[A-F\d]{2}/g,"U").length}function a(e){if(e){var t=e.indexOf("o="),r=e.indexOf("\r\n",t);return"v=0\r\n"+e.slice(t,r)+"\r\ns=-\r\nt=0 0\r\nc=IN IP4 0.0.0.0"}}function c(e){var t=parseInt(e,10);return!isNaN(t)&&parseFloat(e)===t}function u(e,t){void 0===t&&(t=32);for(var r="",i=0;i<e;i++){var n=Math.floor(Math.random()*t);r+=n.toString(t)}return r}function d(){return e.createRandomToken(10)}function p(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.floor(16*Math.random()),r="x"===e?t:t%4+8;return r.toString(16)});return e}function h(t,r){if(t){if(t instanceof s.URI)return t;if("string"==typeof t){var o=t.split("@"),a=void 0,c=void 0;switch(o.length){case 1:if(!r)return;a=t,c=r;break;case 2:a=o[0],c=o[1];break;default:a=o.slice(0,o.length-1).join("@"),c=o[o.length-1]}return a=a.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(a)&&(a=a.replace(/[\-\.\(\)]/g,"")),t=i.C.SIP+":"+e.escapeUser(a)+"@"+c,n.Grammar.URIParse(t)}}else;}function l(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")}function g(e){for(var t={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},r=e.toLowerCase().replace(/_/g,"-").split("-"),i=r.length,n="",s=0;s<i;s++)0!==s&&(n+="-"),n+=r[s].charAt(0).toUpperCase()+r[s].substring(1);return t[n]&&(n=t[n]),n}function f(e){for(var t in i.C.SIP_ERROR_CAUSES)if(-1!==i.C.SIP_ERROR_CAUSES[t].indexOf(e))return i.C.causes[t];return i.C.causes.SIP_FAILURE_CODE}function m(e,t){return t||i.C.REASON_PHRASE[e]||""}function v(t,r){return r=e.getReasonPhrase(t,r),"SIP;cause="+t+';text="'+r+'"'}function S(t,r){if(t&&t<200||t>699)throw new TypeError("Invalid statusCode: "+t);if(t)return e.getReasonHeaderValue(t,r)}function T(t,r){if(!t||t<100||t>699)throw new TypeError("Invalid statusCode: "+t);if(r&&"string"!=typeof r&&!(r instanceof String))throw new TypeError("Invalid reason: "+r);return r=e.getReasonPhrase(t,r),"SIP/2.0 "+t+" "+r+"\r\n"}function y(e){var t=e.body,r=e.contentType,i=b(r),n={contentDisposition:i,contentType:r,content:t};return n}function E(e){var t={body:e.content,contentType:e.contentType};return t}function b(e){return"application/sdp"===e?"session":"render"}e.defer=t,e.reducePromises=r,e.str_utf8_length=o,e.generateFakeSDP=a,e.isDecimal=c,e.createRandomToken=u,e.newTag=d,e.newUUID=p,e.normalizeTarget=h,e.escapeUser=l,e.headerize=g,e.sipErrorCause=f,e.getReasonPhrase=m,e.getReasonHeaderValue=v,e.getCancelReason=S,e.buildStatusLine=T,e.fromBodyObj=y,e.toBodyObj=E})(t.Utils||(t.Utils={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(2),s=r(80);(function(e){var t=function(e){function t(){return e.call(this,"The session description handler has closed.")||this}return i.__extends(t,e),t}(n.Exception);e.ClosedSessionDescriptionHandlerError=t;var r=function(e){function t(){return e.call(this,"The session has terminated.")||this}return i.__extends(t,e),t}(n.Exception);e.TerminatedSessionError=r;var s=function(e){function t(t){return e.call(this,t||"Unsupported session description content type.")||this}return i.__extends(t,e),t}(n.Exception);e.UnsupportedSessionDescriptionContentTypeError=s})(t.Exceptions||(t.Exceptions={}));var o=function(e){function t(t,r,i){var n=e.call(this,i)||this;return n.code=t,n.name=r,n.message=i,n}return i.__extends(t,e),t}(n.Exception);(function(e){var t=function(e){function t(t,r){var i=e.call(this,1,"CONFIGURATION_ERROR",r?"Invalid value "+JSON.stringify(r)+" for parameter '"+t+"'":"Missing parameter: "+t)||this;return i.type=s.TypeStrings.ConfigurationError,i.parameter=t,i.value=r,i}return i.__extends(t,e),t}(o);e.ConfigurationError=t;var r=function(e){function t(t){var r=e.call(this,2,"INVALID_STATE_ERROR","Invalid status: "+t)||this;return r.type=s.TypeStrings.InvalidStateError,r.status=t,r}return i.__extends(t,e),t}(o);e.InvalidStateError=r;var n=function(e){function t(t){var r=e.call(this,3,"NOT_SUPPORTED_ERROR",t)||this;return r.type=s.TypeStrings.NotSupportedError,r}return i.__extends(t,e),t}(o);e.NotSupportedError=n;var a=function(e){function t(t){var r=e.call(this,5,"RENEGOTIATION_ERROR",t)||this;return r.type=s.TypeStrings.RenegotiationError,r}return i.__extends(t,e),t}(o);e.RenegotiationError=a;var c=function(e){function t(t,r,i){var n=e.call(this,6,"METHOD_PARAMETER_ERROR",i?"Invalid value "+JSON.stringify(i)+" for parameter '"+r+"'":"Missing parameter: "+r)||this;return n.type=s.TypeStrings.MethodParameterError,n.method=t,n.parameter=r,n.value=i,n}return i.__extends(t,e),t}(o);e.MethodParameterError=c;var u=function(e){function t(t,r,i){var n=e.call(this,8,"SESSION_DESCRIPTION_HANDLER_ERROR",i||"Error with Session Description Handler")||this;return n.type=s.TypeStrings.SessionDescriptionHandlerError,n.method=t,n.error=r,n}return i.__extends(t,e),t}(o);e.SessionDescriptionHandlerError=u})(t.Exceptions||(t.Exceptions={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(2);(function(e){function t(e,t){var r=t,i=0,n=0;if(e.substring(r,r+2).match(/(^\r\n)/))return-2;for(;0===i;){if(n=e.indexOf("\r\n",r),-1===n)return n;!e.substring(n+2,n+4).match(/(^\r\n)/)&&e.charAt(n+2).match(/(^\s+)/)?r=n+2:i=n}return i}function r(e,t,r,n){var s,o=t.indexOf(":",r),a=t.substring(r,o).trim(),c=t.substring(o+1,n).trim();switch(a.toLowerCase()){case"via":case"v":e.addHeader("via",c),1===e.getHeaders("via").length?(s=e.parseHeader("Via"),s&&(e.via=s,e.viaBranch=s.branch)):s=0;break;case"from":case"f":e.setHeader("from",c),s=e.parseHeader("from"),s&&(e.from=s,e.fromTag=s.getParam("tag"));break;case"to":case"t":e.setHeader("to",c),s=e.parseHeader("to"),s&&(e.to=s,e.toTag=s.getParam("tag"));break;case"record-route":if(s=i.Grammar.parse(c,"Record_Route"),-1===s){s=void 0;break}for(var u in s)s[u]&&(e.addHeader("record-route",c.substring(s[u].position,s[u].offset)),e.headers["Record-Route"][e.getHeaders("record-route").length-1].parsed=s[u].parsed);break;case"call-id":case"i":e.setHeader("call-id",c),s=e.parseHeader("call-id"),s&&(e.callId=c);break;case"contact":case"m":if(s=i.Grammar.parse(c,"Contact"),-1===s){s=void 0;break}if(!(s instanceof Array)){s=void 0;break}s.forEach(function(t){e.addHeader("contact",c.substring(t.position,t.offset)),e.headers.Contact[e.getHeaders("contact").length-1].parsed=t.parsed});break;case"content-length":case"l":e.setHeader("content-length",c),s=e.parseHeader("content-length");break;case"content-type":case"c":e.setHeader("content-type",c),s=e.parseHeader("content-type");break;case"cseq":e.setHeader("cseq",c),s=e.parseHeader("cseq"),s&&(e.cseq=s.value),e instanceof i.IncomingResponseMessage&&(e.method=s.method);break;case"max-forwards":e.setHeader("max-forwards",c),s=e.parseHeader("max-forwards");break;case"www-authenticate":e.setHeader("www-authenticate",c),s=e.parseHeader("www-authenticate");break;case"proxy-authenticate":e.setHeader("proxy-authenticate",c),s=e.parseHeader("proxy-authenticate");break;case"refer-to":case"r":e.setHeader("refer-to",c),s=e.parseHeader("refer-to"),s&&(e.referTo=s);break;default:e.addHeader(a.toLowerCase(),c),s=0}return void 0!==s||{error:"error parsing header '"+a+"'"}}function n(e,n){var s=0,o=e.indexOf("\r\n");if(-1!==o){var a,c=e.substring(0,o),u=i.Grammar.parse(c,"Request_Response");if(-1!==u){var d;for(u.status_code?(a=new i.IncomingResponseMessage,a.statusCode=u.status_code,a.reasonPhrase=u.reason_phrase):(a=new i.IncomingRequestMessage,a.method=u.method,a.ruri=u.uri),a.data=e,s=o+2;;){if(o=t(e,s),-2===o){d=s+2;break}if(-1===o)return void n.error("malformed message");var p=r(a,e,s,o);if(!0!==p)return void n.error(u.error);s=o+2}return a.hasHeader("content-length")?a.body=e.substr(d,Number(a.getHeader("content-length"))):a.body=e.substring(d),a}n.warn('error parsing first line of SIP message: "'+c+'"')}else n.warn("no CRLF found, not a SIP message, discarded")}e.getHeader=t,e.parseHeader=r,e.parseMessage=n})(t.Parser||(t.Parser={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(78),s=r(79),o=r(2),a=r(80),c=r(82),u=r(81),d=function(e){function t(t,r,i,n){void 0===n&&(n={});var o=this;if(n.extraHeaders=(n.extraHeaders||[]).slice(),n.contentType=n.contentType||"text/plain","number"!=typeof n.expires||n.expires%1!=0?n.expires=3600:n.expires=Number(n.expires),"boolean"!=typeof n.unpublishOnClose&&(n.unpublishOnClose=!0),null==r||""===r)throw new c.Exceptions.MethodParameterError("Publish","Target",r);if(r=t.normalizeTarget(r),void 0===r)throw new c.Exceptions.MethodParameterError("Publish","Target",r);if(o=e.call(this,t,s.C.PUBLISH,r,n)||this,o.type=a.TypeStrings.PublishContext,o.options=n,o.target=r,null==i||""===i)throw new c.Exceptions.MethodParameterError("Publish","Event",i);return o.event=i,o.logger=t.getLogger("sip.publish"),o.pubRequestExpires=o.options.expires,o}return i.__extends(t,e),t.prototype.publish=function(e){this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.options.body=e,this.pubRequestBody=this.options.body,0===this.pubRequestExpires&&(this.pubRequestExpires=this.options.expires,this.pubRequestEtag=void 0),this.ua.publishers[this.target.toString()+":"+this.event]||(this.ua.publishers[this.target.toString()+":"+this.event]=this),this.sendPublishRequest()},t.prototype.unpublish=function(){this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.pubRequestBody=void 0,this.pubRequestExpires=0,void 0!==this.pubRequestEtag&&this.sendPublishRequest()},t.prototype.close=function(){this.options.unpublishOnClose?this.unpublish():(this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.pubRequestBody=void 0,this.pubRequestExpires=0,this.pubRequestEtag=void 0),this.ua.publishers[this.target.toString()+":"+this.event]&&delete this.ua.publishers[this.target.toString()+":"+this.event]},t.prototype.onRequestTimeout=function(){e.prototype.onRequestTimeout.call(this),this.emit("unpublished",void 0,s.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){e.prototype.onTransportError.call(this),this.emit("unpublished",void 0,s.C.causes.CONNECTION_ERROR)},t.prototype.receiveResponse=function(e){var t=this,r=e.statusCode||0,i=u.Utils.getReasonPhrase(r);switch(!0){case/^1[0-9]{2}$/.test(r.toString()):this.emit("progress",e,i);break;case/^2[0-9]{2}$/.test(r.toString()):if(e.hasHeader("SIP-ETag")?this.pubRequestEtag=e.getHeader("SIP-ETag"):this.logger.warn("SIP-ETag header missing in a 200-class response to PUBLISH"),e.hasHeader("Expires")){var n=Number(e.getHeader("Expires"));"number"==typeof n&&n>=0&&n<=this.pubRequestExpires?this.pubRequestExpires=n:this.logger.warn("Bad Expires header in a 200-class response to PUBLISH")}else this.logger.warn("Expires header missing in a 200-class response to PUBLISH");0!==this.pubRequestExpires?(this.publishRefreshTimer=setTimeout(function(){return t.refreshRequest()},900*this.pubRequestExpires),this.emit("published",e,i)):this.emit("unpublished",e,i);break;case/^412$/.test(r.toString()):void 0!==this.pubRequestEtag&&0!==this.pubRequestExpires?(this.logger.warn("412 response to PUBLISH, recovering"),this.pubRequestEtag=void 0,this.emit("progress",e,i),this.publish(this.options.body)):(this.logger.warn("412 response to PUBLISH, recovery failed"),this.pubRequestExpires=0,this.emit("failed",e,i),this.emit("unpublished",e,i));break;case/^423$/.test(r.toString()):if(0!==this.pubRequestExpires&&e.hasHeader("Min-Expires")){var s=Number(e.getHeader("Min-Expires"));"number"==typeof s||s>this.pubRequestExpires?(this.logger.warn("423 code in response to PUBLISH, adjusting the Expires value and trying to recover"),this.pubRequestExpires=s,this.emit("progress",e,i),this.publish(this.options.body)):(this.logger.warn("Bad 423 response Min-Expires header received for PUBLISH"),this.pubRequestExpires=0,this.emit("failed",e,i),this.emit("unpublished",e,i))}else this.logger.warn("423 response to PUBLISH, recovery failed"),this.pubRequestExpires=0,this.emit("failed",e,i),this.emit("unpublished",e,i);break;default:this.pubRequestExpires=0,this.emit("failed",e,i),this.emit("unpublished",e,i)}0===this.pubRequestExpires&&(this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.pubRequestBody=void 0,this.pubRequestEtag=void 0)},t.prototype.send=function(){var e=this;return this.ua.userAgentCore.publish(this.request,{onAccept:function(t){return e.receiveResponse(t.message)},onProgress:function(t){return e.receiveResponse(t.message)},onRedirect:function(t){return e.receiveResponse(t.message)},onReject:function(t){return e.receiveResponse(t.message)},onTrying:function(t){return e.receiveResponse(t.message)}}),this},t.prototype.refreshRequest=function(){if(this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.pubRequestBody=void 0,void 0===this.pubRequestEtag)throw new c.Exceptions.MethodParameterError("Publish","Body",void 0);if(0===this.pubRequestExpires)throw new c.Exceptions.MethodParameterError("Publish","Expire",this.pubRequestExpires);this.sendPublishRequest()},t.prototype.sendPublishRequest=function(){var e=Object.create(this.options||Object.prototype);e.extraHeaders=(this.options.extraHeaders||[]).slice(),e.extraHeaders.push("Event: "+this.event),e.extraHeaders.push("Expires: "+this.pubRequestExpires),void 0!==this.pubRequestEtag&&e.extraHeaders.push("SIP-If-Match: "+this.pubRequestEtag);var t=this.target instanceof o.URI?this.target:this.ua.normalizeTarget(this.target);if(!t)throw new Error("ruri undefined.");var r,i,n=this.options.params||{};void 0!==this.pubRequestBody&&(r={body:this.pubRequestBody,contentType:this.options.contentType}),r&&(i=u.Utils.fromBodyObj(r)),this.request=this.ua.userAgentCore.makeOutgoingRequestMessage(s.C.PUBLISH,t,n.fromUri?n.fromUri:this.ua.userAgentCore.configuration.aor,n.toUri?n.toUri:this.target,n,e.extraHeaders,i),this.send()},t}(n.ClientContext);t.PublishContext=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(78),s=r(79),o=r(2),a=r(80),c=r(82),u=r(86),d=function(e){function t(t,r,i,n){void 0===n&&(n={});var o=this;if(void 0===t||void 0===r||void 0===i)throw new TypeError("Not enough arguments");return o=e.call(this,t,s.C.REFER,r.remoteIdentity.uri.toString(),n)||this,o.type=a.TypeStrings.ReferClientContext,o.options=n,o.extraHeaders=(o.options.extraHeaders||[]).slice(),o.applicant=r,o.target=o.initReferTo(i),o.ua&&o.extraHeaders.push("Referred-By: <"+o.ua.configuration.uri+">"),o.extraHeaders.push("Contact: "+r.contact),o.extraHeaders.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),o.extraHeaders.push("Refer-To: "+o.target),o.errorListener=o.onTransportError.bind(o),t.transport&&t.transport.on("transportError",o.errorListener),o}return i.__extends(t,e),t.prototype.refer=function(e){var t=this;void 0===e&&(e={});var r=(this.extraHeaders||[]).slice();return e.extraHeaders&&r.concat(e.extraHeaders),this.applicant.sendRequest(s.C.REFER,{extraHeaders:this.extraHeaders,receiveResponse:function(r){var i=r&&r.statusCode?r.statusCode.toString():"";/^1[0-9]{2}$/.test(i)?t.emit("referRequestProgress",t):/^2[0-9]{2}$/.test(i)?t.emit("referRequestAccepted",t):/^[4-6][0-9]{2}$/.test(i)&&t.emit("referRequestRejected",t),e.receiveResponse&&e.receiveResponse(r)}}),this},t.prototype.receiveNotify=function(e){var t=e.message.hasHeader("Content-Type")?e.message.getHeader("Content-Type"):void 0;if(t&&-1!==t.search(/^message\/sipfrag/)){var r=o.Grammar.parse(e.message.body,"sipfrag");if(-1===r)return void e.reject({statusCode:489,reasonPhrase:"Bad Event"});switch(!0){case/^1[0-9]{2}$/.test(r.status_code):this.emit("referProgress",this);break;case/^2[0-9]{2}$/.test(r.status_code):this.emit("referAccepted",this),!this.options.activeAfterTransfer&&this.applicant.terminate&&this.applicant.terminate();break;default:this.emit("referRejected",this)}return e.accept(),void this.emit("notify",e.message)}e.reject({statusCode:489,reasonPhrase:"Bad Event"})},t.prototype.initReferTo=function(e){var t;if("string"==typeof e){var r=o.Grammar.parse(e,"Refer_To");t=r&&r.uri?r.uri:e;var i=this.ua.normalizeTarget(e);if(!i)throw new TypeError("Invalid target: "+e);t=i}else{if(!e.session)throw new Error("Session undefined.");var n=e.remoteIdentity.friendlyName,s=e.session.remoteTarget.toString(),a=e.session.callId,c=e.session.remoteTag,u=e.session.localTag,d=encodeURIComponent(a+";to-tag="+c+";from-tag="+u);t='"'+n+'" <'+s+"?Replaces="+d+">"}return t},t}(n.ClientContext);t.ReferClientContext=d;var p=function(e){function t(t,r,i){var n=e.call(this,t,r)||this;return n.session=i,n.type=a.TypeStrings.ReferServerContext,n.ua=t,n.status=a.SessionStatus.STATUS_INVITE_RECEIVED,n.fromTag=n.request.fromTag,n.id=n.request.callId+n.fromTag,n.contact=n.ua.contact.toString(),n.logger=t.getLogger("sip.referservercontext",n.id),n.cseq=Math.floor(1e4*Math.random()),n.callId=n.request.callId,n.fromUri=n.request.to.uri,n.fromTag=n.request.to.parameters.tag,n.remoteTarget=n.request.headers.Contact[0].parsed.uri,n.toUri=n.request.from.uri,n.toTag=n.request.fromTag,n.routeSet=n.request.getHeaders("record-route"),n.request.hasHeader("refer-to")?(n.referTo=n.request.parseHeader("refer-to"),n.referredSession=n.ua.findSession(n.request),n.request.hasHeader("referred-by")&&(n.referredBy=n.request.getHeader("referred-by")),n.referTo.uri.hasHeader("replaces")&&(n.replaces=n.referTo.uri.getHeader("replaces")),n.errorListener=n.onTransportError.bind(n),t.transport&&t.transport.on("transportError",n.errorListener),n.status=a.SessionStatus.STATUS_WAITING_FOR_ANSWER,n):(n.logger.warn("Invalid REFER packet. A refer-to header is required. Rejecting refer."),n.reject(),n)}return i.__extends(t,e),t.prototype.progress=function(){if(this.status!==a.SessionStatus.STATUS_WAITING_FOR_ANSWER)throw new c.Exceptions.InvalidStateError(this.status);this.incomingRequest.trying()},t.prototype.reject=function(t){if(void 0===t&&(t={}),this.status===a.SessionStatus.STATUS_TERMINATED)throw new c.Exceptions.InvalidStateError(this.status);this.logger.log("Rejecting refer"),this.status=a.SessionStatus.STATUS_TERMINATED,e.prototype.reject.call(this,t),this.emit("referRequestRejected",this)},t.prototype.accept=function(e,t){var r=this;if(void 0===e&&(e={}),this.status!==a.SessionStatus.STATUS_WAITING_FOR_ANSWER)throw new c.Exceptions.InvalidStateError(this.status);if(this.status=a.SessionStatus.STATUS_ANSWERED,this.incomingRequest.accept({statusCode:202,reasonPhrase:"Accepted"}),this.emit("referRequestAccepted",this),e.followRefer){this.logger.log("Accepted refer, attempting to automatically follow it");var i=this.referTo.uri;if(!i.scheme||!i.scheme.match("^sips?$"))return this.logger.error("SIP.js can only automatically follow SIP refer target"),void this.reject();var n=e.inviteOptions||{},s=(n.extraHeaders||[]).slice();if(this.replaces&&s.push("Replaces: "+decodeURIComponent(this.replaces)),this.referredBy&&s.push("Referred-By: "+this.referredBy),n.extraHeaders=s,i.clearHeaders(),this.targetSession=this.ua.invite(i.toString(),n,t),this.emit("referInviteSent",this),this.targetSession){this.targetSession.once("progress",function(e){var t=e.statusCode||100,i=e.reasonPhrase;r.sendNotify(("SIP/2.0 "+t+" "+i).trim()),r.emit("referProgress",r),r.referredSession&&r.referredSession.emit("referProgress",r)}),this.targetSession.once("accepted",function(){r.logger.log("Successfully followed the refer"),r.sendNotify("SIP/2.0 200 OK"),r.emit("referAccepted",r),r.referredSession&&r.referredSession.emit("referAccepted",r)});var o=function(e){if(r.status!==a.SessionStatus.STATUS_TERMINATED){if(r.logger.log("Refer was not successful. Resuming session"),e&&429===e.statusCode)return r.logger.log("Alerting referrer that identity is required."),void r.sendNotify("SIP/2.0 429 Provide Referrer Identity");r.sendNotify("SIP/2.0 603 Declined"),r.status=a.SessionStatus.STATUS_TERMINATED,r.emit("referRejected",r),r.referredSession&&r.referredSession.emit("referRejected")}};this.targetSession.once("rejected",o),this.targetSession.once("failed",o)}}else this.logger.log("Accepted refer, but did not automatically follow it"),this.sendNotify("SIP/2.0 200 OK"),this.emit("referAccepted",this),this.referredSession&&this.referredSession.emit("referAccepted",this)},t.prototype.sendNotify=function(e){if(this.status!==a.SessionStatus.STATUS_ANSWERED)throw new c.Exceptions.InvalidStateError(this.status);if(-1===o.Grammar.parse(e,"sipfrag"))throw new Error("sipfrag body is required to send notify for refer");var t={contentDisposition:"render",contentType:"message/sipfrag",content:e};if(this.session)this.session.notify(void 0,{extraHeaders:["Event: refer","Subscription-State: terminated"],body:t});else{var r=this.ua.userAgentCore.makeOutgoingRequestMessage(s.C.NOTIFY,this.remoteTarget,this.fromUri,this.toUri,{cseq:this.cseq+=1,callId:this.callId,fromTag:this.fromTag,toTag:this.toTag,routeSet:this.routeSet},["Event: refer","Subscription-State: terminated","Content-Type: message/sipfrag"],t),i=this.ua.transport;if(!i)throw new Error("Transport undefined.");var n={loggerFactory:this.ua.getLoggerFactory()};new o.NonInviteClientTransaction(r,i,n)}},t.prototype.on=function(t,r){return e.prototype.on.call(this,t,r)},t}(u.ServerContext);t.ReferServerContext=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(30),s=r(79),o=r(2),a=r(80),c=r(81),u=function(e){function t(r,i){var n=e.call(this)||this;return n.incomingRequest=i,n.data={},t.initializer(n,r,i),n}return i.__extends(t,e),t.initializer=function(e,t,r){var i=r.message;e.type=a.TypeStrings.ServerContext,e.ua=t,e.logger=t.getLogger("sip.servercontext"),e.request=i,i.body&&(e.body=i.body),i.hasHeader("Content-Type")&&(e.contentType=i.getHeader("Content-Type")),e.method=i.method,e.localIdentity=i.to,e.remoteIdentity=i.from;var n=i.hasHeader("P-Asserted-Identity");if(n){var s=i.getHeader("P-Asserted-Identity");s&&(e.assertedIdentity=o.Grammar.nameAddrHeaderParse(s))}},t.prototype.progress=function(e){return void 0===e&&(e={}),e.statusCode=e.statusCode||180,e.minCode=100,e.maxCode=199,e.events=["progress"],this.reply(e)},t.prototype.accept=function(e){return void 0===e&&(e={}),e.statusCode=e.statusCode||200,e.minCode=200,e.maxCode=299,e.events=["accepted"],this.reply(e)},t.prototype.reject=function(e){return void 0===e&&(e={}),e.statusCode=e.statusCode||480,e.minCode=300,e.maxCode=699,e.events=["rejected","failed"],this.reply(e)},t.prototype.reply=function(e){var t=this;void 0===e&&(e={});var r=e.statusCode||100,i=e.minCode||100,n=e.maxCode||699,s=c.Utils.getReasonPhrase(r,e.reasonPhrase),a=e.extraHeaders||[],u=e.body?o.fromBodyLegacy(e.body):void 0,d=e.events||[];if(r<i||r>n)throw new TypeError("Invalid statusCode: "+r);var p,h={statusCode:r,reasonPhrase:s,extraHeaders:a,body:u},l=r.toString();switch(!0){case/^100$/.test(l):p=this.incomingRequest.trying(h).message;break;case/^1[0-9]{2}$/.test(l):p=this.incomingRequest.progress(h).message;break;case/^2[0-9]{2}$/.test(l):p=this.incomingRequest.accept(h).message;break;case/^3[0-9]{2}$/.test(l):p=this.incomingRequest.redirect([],h).message;break;case/^[4-6][0-9]{2}$/.test(l):p=this.incomingRequest.reject(h).message;break;default:throw new Error("Invalid status code "+r)}return d.forEach(function(e){t.emit(e,p,s)}),this},t.prototype.onRequestTimeout=function(){
this.emit("failed",void 0,s.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",void 0,s.C.causes.CONNECTION_ERROR)},t}(n.EventEmitter);t.ServerContext=u},function(e,t,r){"use strict";function i(e){var t={expires:600,extraContactHeaderParams:[],instanceId:void 0,params:{},regId:void 0,registrar:void 0},r=n();for(var i in r.mandatory){if(!e.hasOwnProperty(i))throw new d.Exceptions.ConfigurationError(i);var s=e[i],o=r.mandatory[i](s);if(void 0===o)throw new d.Exceptions.ConfigurationError(i,s);t[i]=o}for(var i in r.optional)if(e.hasOwnProperty(i)){s=e[i];if(s instanceof Array&&0===s.length)continue;if(null===s||""===s||void 0===s||"number"==typeof s&&isNaN(s))continue;o=r.optional[i](s);if(void 0===o)throw new d.Exceptions.ConfigurationError(i,s);t[i]=o}return t}function n(){return{mandatory:{},optional:{expires:function(e){if(p.Utils.isDecimal(e)){var t=Number(e);if(t>=0)return t}},extraContactHeaderParams:function(e){if(e instanceof Array)return e.filter(function(e){return"string"==typeof e})},instanceId:function(e){if("string"==typeof e)return/^uuid:/i.test(e)&&(e=e.substr(5)),-1===c.Grammar.parse(e,"uuid")?void 0:e},params:function(e){if("object"==typeof e)return e},regId:function(e){if(p.Utils.isDecimal(e)){var t=Number(e);if(t>=0)return t}},registrar:function(e){if("string"==typeof e){/^sip:/i.test(e)||(e=a.C.SIP+":"+e);var t=c.Grammar.URIParse(e);return t?t.user?void 0:t:void 0}}}}}Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),o=r(78),a=r(79),c=r(2),u=r(80),d=r(82),p=r(81),h=function(e){function t(t,r){void 0===r&&(r={});var n=this,s=i(r);if(s.regId&&!s.instanceId?s.instanceId=p.Utils.newUUID():!s.regId&&s.instanceId&&(s.regId=1),s.params.toUri=s.params.toUri||t.configuration.uri,s.params.toDisplayName=s.params.toDisplayName||t.configuration.displayName,s.params.callId=s.params.callId||p.Utils.createRandomToken(22),s.params.cseq=s.params.cseq||Math.floor(1e4*Math.random()),!s.registrar){var o={};"object"==typeof t.configuration.uri?(o=t.configuration.uri.clone(),o.user=void 0):o=t.configuration.uri,s.registrar=o}for(var c in n=e.call(this,t,a.C.REGISTER,s.registrar,s)||this,n.type=u.TypeStrings.RegisterContext,n.options=s,n.logger=t.getLogger("sip.registercontext"),n.logger.log("configuration parameters for RegisterContext after validation:"),s)s.hasOwnProperty(c)&&n.logger.log("¬∑ "+c+": "+JSON.stringify(s[c]));return n.expires=s.expires,n.contact=t.contact.toString(),n.registered=!1,t.transport.on("disconnected",function(){return n.onTransportDisconnected()}),n}return s.__extends(t,e),t.prototype.register=function(e){var t=this;void 0===e&&(e={}),this.options=s.__assign({},this.options,e);var r=(this.options.extraHeaders||[]).slice();r.push("Contact: "+this.generateContactHeader(this.expires)),r.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),this.closeHeaders=this.options.closeWithHeaders?(this.options.extraHeaders||[]).slice():[],this.receiveResponse=function(e){if(e.cseq===t.request.cseq){void 0!==t.registrationTimer&&(clearTimeout(t.registrationTimer),t.registrationTimer=void 0);var r=(e.statusCode||0).toString();switch(!0){case/^1[0-9]{2}$/.test(r):t.emit("progress",e);break;case/^2[0-9]{2}$/.test(r):t.emit("accepted",e);var i=void 0;e.hasHeader("expires")&&(i=Number(e.getHeader("expires"))),void 0!==t.registrationExpiredTimer&&(clearTimeout(t.registrationExpiredTimer),t.registrationExpiredTimer=void 0);var n=e.getHeaders("contact").length;if(!n){t.logger.warn("no Contact header in response to REGISTER, response ignored");break}for(var s=void 0;n--;){if(s=e.parseHeader("contact",n),s.uri.user===t.ua.contact.uri.user){i=s.getParam("expires");break}s=void 0}if(!s){t.logger.warn("no Contact header pointing to us, response ignored");break}void 0===i&&(i=t.expires),t.registrationTimer=setTimeout(function(){t.registrationTimer=void 0,t.register(t.options)},1e3*i-3e3),t.registrationExpiredTimer=setTimeout(function(){t.logger.warn("registration expired"),t.registered&&t.unregistered(void 0,a.C.causes.EXPIRES)},1e3*i),s.hasParam("temp-gruu")&&(t.ua.contact.tempGruu=c.Grammar.URIParse(s.getParam("temp-gruu").replace(/"/g,""))),s.hasParam("pub-gruu")&&(t.ua.contact.pubGruu=c.Grammar.URIParse(s.getParam("pub-gruu").replace(/"/g,""))),t.registered=!0,t.emit("registered",e||void 0);break;case/^423$/.test(r):e.hasHeader("min-expires")?(t.expires=Number(e.getHeader("min-expires")),t.register(t.options)):(t.logger.warn("423 response received for REGISTER without Min-Expires"),t.registrationFailure(e,a.C.causes.SIP_FAILURE_CODE));break;default:t.registrationFailure(e,p.Utils.sipErrorCause(e.statusCode||0))}}},this.onRequestTimeout=function(){t.registrationFailure(void 0,a.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){t.registrationFailure(void 0,a.C.causes.CONNECTION_ERROR)},this.request.cseq++,this.request.setHeader("cseq",this.request.cseq+" REGISTER"),this.request.extraHeaders=r,this.send()},t.prototype.close=function(){var e={all:!1,extraHeaders:this.closeHeaders};this.registeredBefore=this.registered,this.registered&&this.unregister(e)},t.prototype.unregister=function(e){var t=this;void 0===e&&(e={}),this.registered||e.all||this.logger.warn("Already unregistered, but sending an unregister anyways.");var r=(e.extraHeaders||[]).slice();this.registered=!1,void 0!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=void 0),e.all?(r.push("Contact: *"),r.push("Expires: 0")):r.push("Contact: "+this.generateContactHeader(0)),this.receiveResponse=function(e){var r=e&&e.statusCode?e.statusCode.toString():"";switch(!0){case/^1[0-9]{2}$/.test(r):t.emit("progress",e);break;case/^2[0-9]{2}$/.test(r):t.emit("accepted",e),void 0!==t.registrationExpiredTimer&&(clearTimeout(t.registrationExpiredTimer),t.registrationExpiredTimer=void 0),t.unregistered(e);break;default:t.unregistered(e,p.Utils.sipErrorCause(e.statusCode||0))}},this.onRequestTimeout=function(){},this.request.cseq++,this.request.setHeader("cseq",this.request.cseq+" REGISTER"),this.request.extraHeaders=r,this.send()},t.prototype.unregistered=function(e,t){this.registered=!1,this.emit("unregistered",e||void 0,t||void 0)},t.prototype.send=function(){var e=this;return this.ua.userAgentCore.register(this.request,{onAccept:function(t){return e.receiveResponse(t.message)},onProgress:function(t){return e.receiveResponse(t.message)},onRedirect:function(t){return e.receiveResponse(t.message)},onReject:function(t){return e.receiveResponse(t.message)},onTrying:function(t){return e.receiveResponse(t.message)}}),this},t.prototype.registrationFailure=function(e,t){this.emit("failed",e||void 0,t||void 0)},t.prototype.onTransportDisconnected=function(){this.registeredBefore=this.registered,void 0!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=void 0),void 0!==this.registrationExpiredTimer&&(clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=void 0),this.registered&&this.unregistered(void 0,a.C.causes.CONNECTION_ERROR)},t.prototype.generateContactHeader=function(e){void 0===e&&(e=0);var t=this.contact;return this.options.regId&&this.options.instanceId&&(t+=";reg-id="+this.options.regId,t+=';+sip.instance="<urn:uuid:'+this.options.instanceId+'>"'),this.options.extraContactHeaderParams&&this.options.extraContactHeaderParams.forEach(function(e){t+=";"+e}),t+=";expires="+e,t},t}(o.ClientContext);t.RegisterContext=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(30),s=r(78),o=r(79),a=r(2),c=r(80),u=r(82),d=r(85),p=r(86),h=r(89),l=r(81),g=function(e){function t(r){var i=e.call(this)||this;if(i.data={},i.type=c.TypeStrings.Session,!r)throw new u.Exceptions.SessionDescriptionHandlerError("A session description handler is required for the session to function");return i.status=t.C.STATUS_NULL,i.pendingReinvite=!1,i.sessionDescriptionHandlerFactory=r,i.hasOffer=!1,i.hasAnswer=!1,i.timers={ackTimer:void 0,expiresTimer:void 0,invite2xxTimer:void 0,userNoAnswerTimer:void 0,rel1xxTimer:void 0,prackTimer:void 0},i.startTime=void 0,i.endTime=void 0,i.tones=void 0,i.localHold=!1,i.earlySdp=void 0,i.rel100=o.C.supported.UNSUPPORTED,i}return i.__extends(t,e),t.prototype.dtmf=function(e,t){var r=this;if(void 0===t&&(t={}),this.status!==c.SessionStatus.STATUS_CONFIRMED&&this.status!==c.SessionStatus.STATUS_WAITING_FOR_ACK)throw new u.Exceptions.InvalidStateError(this.status);if(!e||!e.toString().match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+e);var i=function(){if(r.status!==c.SessionStatus.STATUS_TERMINATED&&r.tones&&0!==r.tones.length){var e,n=r.tones.shift();","===n.tone?e=2e3:(n.on("failed",function(){r.tones=void 0}),n.send(t),e=n.duration+n.interToneGap),setTimeout(i,e)}else r.tones=void 0};e=e.toString();var n=this.ua.configuration.dtmfType;if(this.sessionDescriptionHandler&&n===o.C.dtmfType.RTP){var s=this.sessionDescriptionHandler.sendDtmf(e,t);s||(this.logger.warn("Attempt to use dtmfType 'RTP' has failed, falling back to INFO packet method"),n=o.C.dtmfType.INFO)}if(n===o.C.dtmfType.INFO){for(var a=[],d=e.split("");d.length>0;)a.push(new h.DTMF(this,d.shift(),t));if(this.tones)return this.tones=this.tones.concat(a),this;this.tones=a,i()}return this},t.prototype.bye=function(e){if(void 0===e&&(e={}),this.status===c.SessionStatus.STATUS_TERMINATED)return this.logger.error("Error: Attempted to send BYE in a terminated session."),this;this.logger.log("terminating Session");var t=e.statusCode;if(t&&(t<200||t>=700))throw new TypeError("Invalid statusCode: "+t);return e.receiveResponse=function(){},this.sendRequest(o.C.BYE,e).terminated()},t.prototype.refer=function(e,t){if(void 0===t&&(t={}),this.status!==c.SessionStatus.STATUS_CONFIRMED)throw new u.Exceptions.InvalidStateError(this.status);return this.referContext=new d.ReferClientContext(this.ua,this,e,t),this.emit("referRequested",this.referContext),this.referContext.refer(t),this.referContext},t.prototype.sendRequest=function(e,t){if(void 0===t&&(t={}),!this.session)throw new Error("Session undefined.");var r;t.body&&(t.body=l.Utils.fromBodyObj(t.body));var i,n=t.receiveResponse;n&&(r={onAccept:function(e){return n(e.message)},onProgress:function(e){return n(e.message)},onRedirect:function(e){return n(e.message)},onReject:function(e){return n(e.message)},onTrying:function(e){return n(e.message)}});var s=t;switch(e){case o.C.BYE:i=this.session.bye(r,s);break;case o.C.INVITE:i=this.session.invite(r,s);break;case o.C.REFER:i=this.session.refer(r,s);break;default:throw new Error("Unexpected "+e+". Method not implemented by user agent core.")}return this.emit(e.toLowerCase(),i.message),this},t.prototype.close=function(){if(this.status===c.SessionStatus.STATUS_TERMINATED)return this;for(var e in this.logger.log("closing INVITE session "+this.id),this.sessionDescriptionHandler&&this.sessionDescriptionHandler.close(),this.timers)this.timers[e]&&clearTimeout(this.timers[e]);return this.status=c.SessionStatus.STATUS_TERMINATED,this.ua.transport&&this.ua.transport.removeListener("transportError",this.errorListener),delete this.ua.sessions[this.id],this},t.prototype.hold=function(e,t){if(void 0===e&&(e={}),void 0===t&&(t=[]),this.status!==c.SessionStatus.STATUS_WAITING_FOR_ACK&&this.status!==c.SessionStatus.STATUS_CONFIRMED)throw new u.Exceptions.InvalidStateError(this.status);this.localHold?this.logger.log("Session is already on hold, cannot put it on hold again"):(e.modifiers=t,this.sessionDescriptionHandler&&e.modifiers.push(this.sessionDescriptionHandler.holdModifier),this.localHold=!0,this.sendReinvite(e))},t.prototype.unhold=function(e,t){if(void 0===e&&(e={}),void 0===t&&(t=[]),this.status!==c.SessionStatus.STATUS_WAITING_FOR_ACK&&this.status!==c.SessionStatus.STATUS_CONFIRMED)throw new u.Exceptions.InvalidStateError(this.status);this.localHold?(e.modifiers=t,this.localHold=!1,this.sendReinvite(e)):this.logger.log("Session is not on hold, cannot unhold it")},t.prototype.reinvite=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=[]),e.modifiers=t,this.sendReinvite(e)},t.prototype.terminate=function(e){return this},t.prototype.onTransportError=function(){this.status!==c.SessionStatus.STATUS_CONFIRMED&&this.status!==c.SessionStatus.STATUS_TERMINATED&&this.failed(void 0,o.C.causes.CONNECTION_ERROR)},t.prototype.onRequestTimeout=function(){this.status===c.SessionStatus.STATUS_CONFIRMED?this.terminated(void 0,o.C.causes.REQUEST_TIMEOUT):this.status!==c.SessionStatus.STATUS_TERMINATED&&(this.failed(void 0,o.C.causes.REQUEST_TIMEOUT),this.terminated(void 0,o.C.causes.REQUEST_TIMEOUT))},t.prototype.onDialogError=function(e){this.status===c.SessionStatus.STATUS_CONFIRMED?this.terminated(e,o.C.causes.DIALOG_ERROR):this.status!==c.SessionStatus.STATUS_TERMINATED&&(this.failed(e,o.C.causes.DIALOG_ERROR),this.terminated(e,o.C.causes.DIALOG_ERROR))},t.prototype.on=function(t,r){return e.prototype.on.call(this,t,r)},t.prototype.onAck=function(e){var t=this,r=function(){clearTimeout(t.timers.ackTimer),clearTimeout(t.timers.invite2xxTimer),t.status=c.SessionStatus.STATUS_CONFIRMED;var r=e.message.getHeader("Content-Disposition");r&&"render"===r.type&&(t.renderbody=e.message.body,t.rendertype=e.message.getHeader("Content-Type")),t.emit("confirmed",e.message)};this.status===c.SessionStatus.STATUS_WAITING_FOR_ACK&&(this.sessionDescriptionHandler&&this.sessionDescriptionHandler.hasDescription(e.message.getHeader("Content-Type")||"")?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(e.message.body,this.sessionDescriptionHandlerOptions,this.modifiers).catch(function(r){throw t.logger.warn(r),t.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),t.failed(e.message,o.C.causes.BAD_MEDIA_DESCRIPTION),t.terminated(e.message,o.C.causes.BAD_MEDIA_DESCRIPTION),r}).then(function(){return r()})):r())},t.prototype.receiveRequest=function(e){switch(e.message.method){case o.C.BYE:e.accept(),this.status===c.SessionStatus.STATUS_CONFIRMED&&(this.emit("bye",e.message),this.terminated(e.message,o.C.BYE));break;case o.C.INVITE:this.status===c.SessionStatus.STATUS_CONFIRMED&&(this.logger.log("re-INVITE received"),this.receiveReinvite(e));break;case o.C.INFO:if(this.status===c.SessionStatus.STATUS_CONFIRMED||this.status===c.SessionStatus.STATUS_WAITING_FOR_ACK){if(this.onInfo)return this.onInfo(e.message);var t=e.message.getHeader("content-type");if(t)if(t.match(/^application\/dtmf-relay/i)){if(e.message.body){var r=e.message.body.split("\r\n",2);if(2===r.length){var i=void 0,n=void 0,s=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/;s.test(r[0])&&(i=r[0].replace(s,"$2"));var a=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;a.test(r[1])&&(n=parseInt(r[1].replace(a,"$2"),10)),i&&n&&new h.DTMF(this,i,{duration:n}).init_incoming(e)}}}else e.reject({statusCode:415,extraHeaders:["Accept: application/dtmf-relay"]})}break;case o.C.REFER:if(this.status===c.SessionStatus.STATUS_CONFIRMED)if(this.logger.log("REFER received"),this.referContext=new d.ReferServerContext(this.ua,e,this.session),this.listeners("referRequested").length)this.emit("referRequested",this.referContext);else{this.logger.log("No referRequested listeners, automatically accepting and following the refer");var u={followRefer:!0};this.passedOptions&&(u.inviteOptions=this.passedOptions),this.referContext.accept(u,this.modifiers)}break;case o.C.NOTIFY:if(this.referContext&&this.referContext.type===c.TypeStrings.ReferClientContext&&e.message.hasHeader("event")&&/^refer(;.*)?$/.test(e.message.getHeader("event")))return void this.referContext.receiveNotify(e);e.accept(),this.emit("notify",e.message)}},t.prototype.receiveReinvite=function(e){var t,r=this;if(this.emit("reinvite",this,e.message),e.message.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=a.Grammar.nameAddrHeaderParse(e.message.getHeader("P-Asserted-Identity"))),this.sessionDescriptionHandler){if("0"!==e.message.getHeader("Content-Length")||e.message.getHeader("Content-Type")){if(!this.sessionDescriptionHandler.hasDescription(e.message.getHeader("Content-Type")||""))return e.reject({statusCode:415}),void this.emit("reinviteFailed",this);t=this.sessionDescriptionHandler.setDescription(e.message.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(this.sessionDescriptionHandler.getDescription.bind(this.sessionDescriptionHandler,this.sessionDescriptionHandlerOptions,this.modifiers))}else t=this.sessionDescriptionHandler.getDescription(this.sessionDescriptionHandlerOptions,this.modifiers);t.catch(function(t){var i;throw t.type===c.TypeStrings.SessionDescriptionHandlerError?i=500:t.type===c.TypeStrings.RenegotiationError?(r.emit("renegotiationError",t),r.logger.warn(t.toString()),i=488):(r.logger.error(t),i=488),e.reject({statusCode:i}),r.emit("reinviteFailed",r),t}).then(function(t){var i=["Contact: "+r.contact];e.accept({statusCode:200,extraHeaders:i,body:l.Utils.fromBodyObj(t)}),r.status=c.SessionStatus.STATUS_WAITING_FOR_ACK,r.emit("reinviteAccepted",r)})}else this.logger.warn("No SessionDescriptionHandler to reinvite")},t.prototype.sendReinvite=function(e){var t=this;if(void 0===e&&(e={}),this.pendingReinvite)this.logger.warn("Reinvite in progress. Please wait until complete, then try again.");else if(this.sessionDescriptionHandler){this.pendingReinvite=!0,e.modifiers=e.modifiers||[];var r=(e.extraHeaders||[]).slice();r.push("Contact: "+this.contact),r.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),this.sessionDescriptionHandler.getDescription(e.sessionDescriptionHandlerOptions,e.modifiers).then(function(e){if(!t.session)throw new Error("Session undefined.");var i={onAccept:function(e){if(t.status!==c.SessionStatus.STATUS_TERMINATED)if(t.pendingReinvite){if(t.status=c.SessionStatus.STATUS_CONFIRMED,t.emit("ack",e.ack()),t.pendingReinvite=!1,clearTimeout(t.timers.invite2xxTimer),!t.sessionDescriptionHandler||!t.sessionDescriptionHandler.hasDescription(e.message.getHeader("Content-Type")||""))return t.logger.error("2XX response received to re-invite but did not have a description"),t.emit("reinviteFailed",t),void t.emit("renegotiationError",new u.Exceptions.RenegotiationError("2XX response received to re-invite but did not have a description"));t.sessionDescriptionHandler.setDescription(e.message.body,t.sessionDescriptionHandlerOptions,t.modifiers).catch(function(e){throw t.logger.error("Could not set the description in 2XX response"),t.logger.error(e),t.emit("reinviteFailed",t),t.emit("renegotiationError",e),t.sendRequest(o.C.BYE,{extraHeaders:["Reason: "+l.Utils.getReasonHeaderValue(488,"Not Acceptable Here")]}),t.terminated(void 0,o.C.causes.INCOMPATIBLE_SDP),e}).then(function(){t.emit("reinviteAccepted",t)})}else t.logger.error("Received reinvite response, but have no pending reinvite");else t.logger.error("Received reinvite response, but in STATUS_TERMINATED")},onProgress:function(e){},onRedirect:function(e){t.pendingReinvite=!1,t.logger.log("Received a non 1XX or 2XX response to a re-invite"),t.emit("reinviteFailed",t),t.emit("renegotiationError",new u.Exceptions.RenegotiationError("Invalid response to a re-invite"))},onReject:function(e){t.pendingReinvite=!1,t.logger.log("Received a non 1XX or 2XX response to a re-invite"),t.emit("reinviteFailed",t),t.emit("renegotiationError",new u.Exceptions.RenegotiationError("Invalid response to a re-invite"))},onTrying:function(e){}},n={extraHeaders:r,body:l.Utils.fromBodyObj(e)};t.session.invite(i,n)}).catch(function(e){if(e.type===c.TypeStrings.RenegotiationError)throw t.pendingReinvite=!1,t.emit("renegotiationError",e),t.logger.warn("Renegotiation Error"),t.logger.warn(e.toString()),e;throw t.logger.error("sessionDescriptionHandler error"),t.logger.error(e),e})}else this.logger.warn("No SessionDescriptionHandler, can't reinvite..")},t.prototype.failed=function(e,t){return this.status===c.SessionStatus.STATUS_TERMINATED?this:(this.emit("failed",e,t),this)},t.prototype.rejected=function(e,t){return this.emit("rejected",e,t),this},t.prototype.canceled=function(){return this.sessionDescriptionHandler&&this.sessionDescriptionHandler.close(),this.emit("cancel"),this},t.prototype.accepted=function(e,t){return e instanceof String||(t=l.Utils.getReasonPhrase(e&&e.statusCode||0,t)),this.startTime=new Date,this.replacee&&(this.replacee.emit("replaced",this),this.replacee.terminate()),this.emit("accepted",e,t),this},t.prototype.terminated=function(e,t){return this.status===c.SessionStatus.STATUS_TERMINATED?this:(this.endTime=new Date,this.close(),this.emit("terminated",e,t),this)},t.prototype.connecting=function(e){return this.emit("connecting",{request:e}),this},t.C=c.SessionStatus,t}(n.EventEmitter);t.Session=g;var f=function(e){function t(t,r){var i=this;if(!t.configuration.sessionDescriptionHandlerFactory)throw t.logger.warn("Can't build ISC without SDH Factory"),new Error("ISC Constructor Failed");i=e.call(this,t.configuration.sessionDescriptionHandlerFactory)||this,i._canceled=!1,i.rseq=Math.floor(1e4*Math.random()),i.incomingRequest=r;var n=r.message;p.ServerContext.initializer(i,t,r),i.type=c.TypeStrings.InviteServerContext;var s=n.parseHeader("Content-Disposition");s&&"render"===s.type&&(i.renderbody=n.body,i.rendertype=n.getHeader("Content-Type")),i.status=c.SessionStatus.STATUS_INVITE_RECEIVED,i.fromTag=n.fromTag,i.id=n.callId+i.fromTag,i.request=n,i.contact=i.ua.contact.toString(),i.logger=t.getLogger("sip.inviteservercontext",i.id),i.ua.sessions[i.id]=i;var a=function(e,t){n.hasHeader(e)&&n.getHeader(e).toLowerCase().indexOf("100rel")>=0&&(i.rel100=t)};if(a("require",o.C.supported.REQUIRED),a("supported",o.C.supported.SUPPORTED),i.request.toTag=r.toTag,i.status=c.SessionStatus.STATUS_WAITING_FOR_ANSWER,i.timers.userNoAnswerTimer=setTimeout(function(){r.reject({statusCode:408}),i.failed(n,o.C.causes.NO_ANSWER),i.terminated(n,o.C.causes.NO_ANSWER)},i.ua.configuration.noAnswerTimeout||60),n.hasHeader("expires")){var u=1e3*Number(n.getHeader("expires")||0);i.timers.expiresTimer=setTimeout(function(){i.status===c.SessionStatus.STATUS_WAITING_FOR_ANSWER&&(r.reject({statusCode:487}),i.failed(n,o.C.causes.EXPIRES),i.terminated(n,o.C.causes.EXPIRES))},u)}return i.errorListener=i.onTransportError.bind(i),t.transport&&t.transport.on("transportError",i.errorListener),i}return i.__extends(t,e),Object.defineProperty(t.prototype,"autoSendAnInitialProvisionalResponse",{get:function(){return this.rel100!==o.C.supported.REQUIRED},enumerable:!0,configurable:!0}),t.prototype.reply=function(e){return void 0===e&&(e={}),this},t.prototype.reject=function(e){var t=this;if(void 0===e&&(e={}),this.status===c.SessionStatus.STATUS_TERMINATED)throw new u.Exceptions.InvalidStateError(this.status);this.logger.log("rejecting RTCSession");var r=e.statusCode||480,i=l.Utils.getReasonPhrase(r,e.reasonPhrase),n=e.extraHeaders||[];if(r<300||r>699)throw new TypeError("Invalid statusCode: "+r);var s=e.body?a.fromBodyLegacy(e.body):void 0,o=r<400?this.incomingRequest.redirect([],{statusCode:r,reasonPhrase:i,extraHeaders:n,body:s}):this.incomingRequest.reject({statusCode:r,reasonPhrase:i,extraHeaders:n,body:s});return["rejected","failed"].forEach(function(e){t.emit(e,o.message,i)}),this.terminated()},t.prototype.accept=function(e){var t=this;return void 0===e&&(e={}),this._accept(e).then(function(e){var r=e.message,i=e.session;i.delegate={onAck:function(e){return t.onAck(e)},onAckTimeout:function(){return t.onAckTimeout()},onBye:function(e){return t.receiveRequest(e)},onInfo:function(e){return t.receiveRequest(e)},onInvite:function(e){return t.receiveRequest(e)},onNotify:function(e){return t.receiveRequest(e)},onPrack:function(e){return t.receiveRequest(e)},onRefer:function(e){return t.receiveRequest(e)}},t.session=i,t.status=c.SessionStatus.STATUS_WAITING_FOR_ACK,t.accepted(r,l.Utils.getReasonPhrase(200))}).catch(function(e){if(t.onContextError(e),!t._canceled)throw e}),this},t.prototype.progress=function(e){var t=this;void 0===e&&(e={});var r=e.statusCode||180;if(r<100||r>199)throw new TypeError("Invalid statusCode: "+r);if(this.status===c.SessionStatus.STATUS_TERMINATED)return this.logger.warn("Unexpected call for progress while terminated, ignoring"),this;if(this.status===c.SessionStatus.STATUS_ANSWERED)return this.logger.warn("Unexpected call for progress while answered, ignoring"),this;if(this.status===c.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK)return this.logger.warn("Unexpected call for progress while answered (waiting for prack), ignoring"),this;if(this.status===c.SessionStatus.STATUS_WAITING_FOR_PRACK)return this.logger.warn("Unexpected call for progress while waiting for prack, ignoring"),this;if(100===e.statusCode){try{this.incomingRequest.trying()}catch(e){if(this.onContextError(e),!this._canceled)throw e}return this}return this.rel100===o.C.supported.REQUIRED||this.rel100===o.C.supported.SUPPORTED&&e.rel100||this.rel100===o.C.supported.SUPPORTED&&this.ua.configuration.rel100===o.C.supported.REQUIRED?(this._reliableProgressWaitForPrack(e).catch(function(e){if(t.onContextError(e),!t._canceled)throw e}),this):(this._progress(e).catch(function(e){if(t.onContextError(e),!t._canceled)throw e}),this)},t.prototype.terminate=function(e){var t=this;if(void 0===e&&(e={}),!this.session)return this.reject(e),this;switch(this.session.sessionState){case a.SessionState.Initial:case a.SessionState.Early:return this.reject(e),this;case a.SessionState.AckWait:return this.session.delegate={onAck:function(){t.sendRequest(o.C.BYE,e)},onAckTimeout:function(){t.sendRequest(o.C.BYE,e)}},this.emit("bye",this.request),this.terminated(),this;case a.SessionState.Confirmed:return this.bye(e),this;case a.SessionState.Terminated:default:return this}},t.prototype.onCancel=function(e){this.status!==c.SessionStatus.STATUS_WAITING_FOR_ANSWER&&this.status!==c.SessionStatus.STATUS_WAITING_FOR_PRACK&&this.status!==c.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK&&this.status!==c.SessionStatus.STATUS_EARLY_MEDIA&&this.status!==c.SessionStatus.STATUS_ANSWERED||(this.status=c.SessionStatus.STATUS_CANCELED,this.incomingRequest.reject({statusCode:487}),this.canceled(),this.rejected(e,o.C.causes.CANCELED),this.failed(e,o.C.causes.CANCELED),this.terminated(e,o.C.causes.CANCELED))},t.prototype.receiveRequest=function(t){var r=this;switch(t.message.method){case o.C.PRACK:this.status===c.SessionStatus.STATUS_WAITING_FOR_PRACK||this.status===c.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK?this.hasAnswer?(clearTimeout(this.timers.rel1xxTimer),clearTimeout(this.timers.prackTimer),t.accept(),this.status===c.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=c.SessionStatus.STATUS_EARLY_MEDIA,this.accept()),this.status=c.SessionStatus.STATUS_EARLY_MEDIA):(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.hasDescription(t.message.getHeader("Content-Type")||"")?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(t.message.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){clearTimeout(r.timers.rel1xxTimer),clearTimeout(r.timers.prackTimer),t.accept(),r.status===c.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK&&(r.status=c.SessionStatus.STATUS_EARLY_MEDIA,r.accept()),r.status=c.SessionStatus.STATUS_EARLY_MEDIA},function(e){r.logger.warn(e),r.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),r.failed(t.message,o.C.causes.BAD_MEDIA_DESCRIPTION),r.terminated(t.message,o.C.causes.BAD_MEDIA_DESCRIPTION)})):(this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(t.message,o.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(t.message,o.C.causes.BAD_MEDIA_DESCRIPTION))):this.status===c.SessionStatus.STATUS_EARLY_MEDIA&&t.accept();break;default:e.prototype.receiveRequest.call(this,t)}},t.prototype.setupSessionDescriptionHandler=function(){return this.sessionDescriptionHandler?this.sessionDescriptionHandler:this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions)},t.prototype.generateResponseOfferAnswer=function(e){if(!this.session){var t=a.getBody(this.incomingRequest.message);return t&&"session"===t.contentDisposition?this.setOfferAndGetAnswer(t,e):this.getOffer(e)}switch(this.session.signalingState){case a.SignalingState.Initial:return this.getOffer(e);case a.SignalingState.Stable:case a.SignalingState.HaveLocalOffer:return Promise.resolve(void 0);case a.SignalingState.HaveRemoteOffer:if(!this.session.offer)throw new Error("Session offer undefined");return this.setOfferAndGetAnswer(this.session.offer,e);case a.SignalingState.Closed:default:throw new Error("Invalid signaling state "+this.session.signalingState+".")}},t.prototype.handlePrackOfferAnswer=function(e,t){if(!this.session)throw new Error("Session undefined.");var r=a.getBody(e.message);if(!r||"session"!==r.contentDisposition)return Promise.resolve(void 0);switch(this.session.signalingState){case a.SignalingState.Initial:throw new Error("Invalid signaling state "+this.session.signalingState+".");case a.SignalingState.Stable:return this.setAnswer(r,t).then(function(){});case a.SignalingState.HaveLocalOffer:throw new Error("Invalid signaling state "+this.session.signalingState+".");case a.SignalingState.HaveRemoteOffer:return this.setOfferAndGetAnswer(r,t);case a.SignalingState.Closed:default:throw new Error("Invalid signaling state "+this.session.signalingState+".")}},t.prototype.canceled=function(){return this._canceled=!0,e.prototype.canceled.call(this)},t.prototype.terminated=function(t,r){return this.prackNeverArrived(),e.prototype.terminated.call(this,t,r)},t.prototype._accept=function(e){var t=this;return void 0===e&&(e={}),this.onInfo=e.onInfo,this.status===c.SessionStatus.STATUS_WAITING_FOR_PRACK?(this.status=c.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK,this.waitForArrivalOfPrack().then(function(){t.status=c.SessionStatus.STATUS_ANSWERED,clearTimeout(t.timers.userNoAnswerTimer)}).then(function(){return t.generateResponseOfferAnswer(e)}).then(function(e){return t.incomingRequest.accept({statusCode:200,body:e})})):this.status!==c.SessionStatus.STATUS_WAITING_FOR_ANSWER?Promise.reject(new u.Exceptions.InvalidStateError(this.status)):(this.status=c.SessionStatus.STATUS_ANSWERED,this.status=c.SessionStatus.STATUS_ANSWERED,clearTimeout(this.timers.userNoAnswerTimer),this.generateResponseOfferAnswer(e).then(function(e){return t.incomingRequest.accept({statusCode:200,body:e})}))},t.prototype._progress=function(e){void 0===e&&(e={});var t=e.statusCode||180,r=e.reasonPhrase,i=(e.extraHeaders||[]).slice(),n=e.body?a.fromBodyLegacy(e.body):void 0;if(183===t&&!n)return this._progressWithSDP(e);try{var s=this.incomingRequest.progress({statusCode:t,reasonPhrase:r,extraHeaders:i,body:n});return this.emit("progress",s.message,r),this.session=s.session,Promise.resolve(s)}catch(e){return Promise.reject(e)}},t.prototype._progressWithSDP=function(e){var t=this;void 0===e&&(e={});var r=e.statusCode||183,i=e.reasonPhrase,n=(e.extraHeaders||[]).slice();return this.generateResponseOfferAnswer(e).then(function(e){return t.incomingRequest.progress({statusCode:r,reasonPhrase:i,extraHeaders:n,body:e})}).then(function(e){return t.emit("progress",e.message,i),t.session=e.session,e})},t.prototype._reliableProgress=function(e){var t=this;void 0===e&&(e={});var r=e.statusCode||183,i=e.reasonPhrase,n=(e.extraHeaders||[]).slice();return n.push("Require: 100rel"),n.push("RSeq: "+Math.floor(1e4*Math.random())),this.generateResponseOfferAnswer(e).then(function(e){return t.incomingRequest.progress({statusCode:r,reasonPhrase:i,extraHeaders:n,body:e})}).then(function(e){return t.emit("progress",e.message,i),t.session=e.session,e})},t.prototype._reliableProgressWaitForPrack=function(e){var t=this;void 0===e&&(e={});var r,i=e.statusCode||183,n=e.reasonPhrase,s=(e.extraHeaders||[]).slice();return s.push("Require: 100rel"),
s.push("RSeq: "+this.rseq++),this.status=c.SessionStatus.STATUS_WAITING_FOR_PRACK,new Promise(function(d,p){var h=!0;return t.generateResponseOfferAnswer(e).then(function(e){return r=e,t.incomingRequest.progress({statusCode:i,reasonPhrase:n,extraHeaders:s,body:r})}).then(function(l){var g,f;t.emit("progress",l.message,n),t.session=l.session,l.session.delegate={onPrack:function(r){g=r,clearTimeout(v),clearTimeout(y),h&&(h=!1,t.handlePrackOfferAnswer(g,e).then(function(e){try{f=g.accept({statusCode:200,body:e}),t.status===c.SessionStatus.STATUS_WAITING_FOR_PRACK&&(t.status=c.SessionStatus.STATUS_WAITING_FOR_ANSWER),t.prackArrived(),d({prackRequest:g,prackResponse:f,progressResponse:l})}catch(e){p(e)}}))}};var m=function(){if(h){h=!1,t.logger.warn("No PRACK received, rejecting INVITE."),clearTimeout(y);try{t.incomingRequest.reject({statusCode:504}),t.terminated(void 0,o.C.causes.NO_PRACK),p(new u.Exceptions.TerminatedSessionError)}catch(e){p(e)}}},v=setTimeout(m,64*a.Timers.T1),S=function(){try{t.incomingRequest.progress({statusCode:i,reasonPhrase:n,extraHeaders:s,body:r})}catch(e){return h=!1,void p(e)}y=setTimeout(S,T*=2)},T=a.Timers.T1,y=setTimeout(S,T)})})},t.prototype.onAckTimeout=function(){if(this.status===c.SessionStatus.STATUS_WAITING_FOR_ACK){if(this.logger.log("no ACK received for an extended period of time, terminating the call"),!this.session)throw new Error("Session undefined.");this.session.bye(),this.terminated(void 0,o.C.causes.NO_ACK)}},t.prototype.onContextError=function(e){var t=480;e instanceof a.Exception?e instanceof u.Exceptions.SessionDescriptionHandlerError?(this.logger.error(e.message),e.error&&this.logger.error(e.error)):e instanceof u.Exceptions.TerminatedSessionError?this.logger.warn("Incoming session terminated while waiting for PRACK."):e instanceof u.Exceptions.UnsupportedSessionDescriptionContentTypeError?t=415:e instanceof a.Exception&&this.logger.error(e.message):e instanceof Error?this.logger.error(e.message):(this.logger.error("An error occurred in the session description handler."),this.logger.error(e));try{this.incomingRequest.reject({statusCode:t}),this.failed(this.incomingRequest.message,e.message),this.terminated(this.incomingRequest.message,e.message)}catch(e){return}},t.prototype.prackArrived=function(){this.waitingForPrackResolve&&this.waitingForPrackResolve(),this.waitingForPrackPromise=void 0,this.waitingForPrackResolve=void 0,this.waitingForPrackReject=void 0},t.prototype.prackNeverArrived=function(){this.waitingForPrackReject&&this.waitingForPrackReject(new u.Exceptions.TerminatedSessionError),this.waitingForPrackPromise=void 0,this.waitingForPrackResolve=void 0,this.waitingForPrackReject=void 0},t.prototype.waitForArrivalOfPrack=function(){var e=this;if(this.waitingForPrackPromise)throw new Error("Already waiting for PRACK");return this.waitingForPrackPromise=new Promise(function(t,r){e.waitingForPrackResolve=t,e.waitingForPrackReject=r}),this.waitingForPrackPromise},t.prototype.getOffer=function(e){this.hasOffer=!0;var t=this.getSessionDescriptionHandler();return t.getDescription(e.sessionDescriptionHandlerOptions,e.modifiers).then(function(e){return l.Utils.fromBodyObj(e)})},t.prototype.setAnswer=function(e,t){this.hasAnswer=!0;var r=this.getSessionDescriptionHandler();return r.hasDescription(e.contentType)?r.setDescription(e.content,t.sessionDescriptionHandlerOptions,t.modifiers):Promise.reject(new u.Exceptions.UnsupportedSessionDescriptionContentTypeError)},t.prototype.setOfferAndGetAnswer=function(e,t){this.hasOffer=!0,this.hasAnswer=!0;var r=this.getSessionDescriptionHandler();return r.hasDescription(e.contentType)?r.setDescription(e.content,t.sessionDescriptionHandlerOptions,t.modifiers).then(function(){return r.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers)}).then(function(e){return l.Utils.fromBodyObj(e)}):Promise.reject(new u.Exceptions.UnsupportedSessionDescriptionContentTypeError)},t.prototype.getSessionDescriptionHandler=function(){var e=this.sessionDescriptionHandler=this.setupSessionDescriptionHandler();return this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),e},t}(g);t.InviteServerContext=f;var m=function(e){function t(t,r,i,n){void 0===i&&(i={}),void 0===n&&(n=[]);var a=this;if(!t.configuration.sessionDescriptionHandlerFactory)throw t.logger.warn("Can't build ISC without SDH Factory"),new Error("ICC Constructor Failed");i.params=i.params||{};var d=i.anonymous||!1,p=l.Utils.newTag();i.params.fromTag=p;var h=t.contact.toString({anonymous:d,outbound:d?!t.contact.tempGruu:!t.contact.pubGruu}),g=(i.extraHeaders||[]).slice();if(d&&t.configuration.uri&&(i.params.fromDisplayName="Anonymous",i.params.fromUri="sip:anonymous@anonymous.invalid",g.push("P-Preferred-Identity: "+t.configuration.uri.toString()),g.push("Privacy: id")),g.push("Contact: "+h),g.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),t.configuration.rel100===o.C.supported.REQUIRED&&g.push("Require: 100rel"),t.configuration.replaces===o.C.supported.REQUIRED&&g.push("Require: replaces"),i.extraHeaders=g,a=e.call(this,t.configuration.sessionDescriptionHandlerFactory)||this,s.ClientContext.initializer(a,t,o.C.INVITE,r,i),a.earlyMediaSessionDescriptionHandlers=new Map,a.type=c.TypeStrings.InviteClientContext,a.passedOptions=i,a.sessionDescriptionHandlerOptions=i.sessionDescriptionHandlerOptions||{},a.modifiers=n,a.inviteWithoutSdp=i.inviteWithoutSdp||!1,a.anonymous=i.anonymous||!1,a.renderbody=i.renderbody||void 0,a.rendertype=i.rendertype||"text/plain",a.fromTag=p,a.contact=h,a.status!==c.SessionStatus.STATUS_NULL)throw new u.Exceptions.InvalidStateError(a.status);return a.isCanceled=!1,a.received100=!1,a.method=o.C.INVITE,a.logger=t.getLogger("sip.inviteclientcontext"),t.applicants[a.toString()]=a,a.id=a.request.callId+a.fromTag,a.onInfo=i.onInfo,a.errorListener=a.onTransportError.bind(a),t.transport&&t.transport.on("transportError",a.errorListener),a}return i.__extends(t,e),t.prototype.receiveResponse=function(e){throw new Error("Unimplemented.")},t.prototype.send=function(){return this.sendInvite(),this},t.prototype.invite=function(){var e=this;return this.ua.sessions[this.id]=this,Promise.resolve().then(function(){e.isCanceled||e.status===c.SessionStatus.STATUS_TERMINATED||(e.inviteWithoutSdp?(e.renderbody&&e.rendertype&&(e.request.body={body:e.renderbody,contentType:e.rendertype}),e.status=c.SessionStatus.STATUS_INVITE_SENT,e.send()):(e.sessionDescriptionHandler=e.sessionDescriptionHandlerFactory(e,e.ua.configuration.sessionDescriptionHandlerFactoryOptions||{}),e.emit("SessionDescriptionHandler-created",e.sessionDescriptionHandler),e.sessionDescriptionHandler.getDescription(e.sessionDescriptionHandlerOptions,e.modifiers).then(function(t){e.isCanceled||e.status===c.SessionStatus.STATUS_TERMINATED||(e.hasOffer=!0,e.request.body=t,e.status=c.SessionStatus.STATUS_INVITE_SENT,e.send())},function(t){t.type===c.TypeStrings.SessionDescriptionHandlerError&&(e.logger.log(t.message),t.error&&e.logger.log(t.error)),e.status!==c.SessionStatus.STATUS_TERMINATED&&(e.failed(void 0,o.C.causes.WEBRTC_ERROR),e.terminated(void 0,o.C.causes.WEBRTC_ERROR))})))}),this},t.prototype.cancel=function(e){if(void 0===e&&(e={}),this.status===c.SessionStatus.STATUS_TERMINATED||this.status===c.SessionStatus.STATUS_CONFIRMED)throw new u.Exceptions.InvalidStateError(this.status);if(this.isCanceled)throw new u.Exceptions.InvalidStateError(c.SessionStatus.STATUS_CANCELED);this.isCanceled=!0,this.logger.log("Canceling session");var t=l.Utils.getCancelReason(e.statusCode,e.reasonPhrase);return e.extraHeaders=(e.extraHeaders||[]).slice(),this.outgoingInviteRequest&&(this.logger.warn("Canceling session before it was created"),this.outgoingInviteRequest.cancel(t,e)),this.canceled()},t.prototype.terminate=function(e){return this.status===c.SessionStatus.STATUS_TERMINATED?this:(this.status===c.SessionStatus.STATUS_WAITING_FOR_ACK||this.status===c.SessionStatus.STATUS_CONFIRMED?this.bye(e):this.cancel(e),this)},t.prototype.sendInvite=function(){var e=this;this.outgoingInviteRequest=this.ua.userAgentCore.invite(this.request,{onAccept:function(t){return e.onAccept(t)},onProgress:function(t){return e.onProgress(t)},onRedirect:function(t){return e.onRedirect(t)},onReject:function(t){return e.onReject(t)},onTrying:function(t){return e.onTrying(t)}})},t.prototype.ackAndBye=function(e,t,r,i){if(!this.ua.userAgentCore)throw new Error("Method requires user agent core.");var n=[];r&&n.push("Reason: "+l.Utils.getReasonHeaderValue(r,i));var s=e.ack();this.emit("ack",s.message);var o=t.bye(void 0,{extraHeaders:n});this.emit("bye",o.message)},t.prototype.disposeEarlyMedia=function(){if(!this.earlyMediaSessionDescriptionHandlers)throw new Error("Early media session description handlers undefined.");this.earlyMediaSessionDescriptionHandlers.forEach(function(e){e.close()})},t.prototype.onAccept=function(e){var t=this;if(!this.earlyMediaSessionDescriptionHandlers)throw new Error("Early media session description handlers undefined.");var r=e.message,i=e.session;if(this.session)this.ackAndBye(e,i);else{if(this.isCanceled)return this.ackAndBye(e,i),void this.emit("bye",this.request);switch(r.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=a.Grammar.nameAddrHeaderParse(r.getHeader("P-Asserted-Identity"))),this.session=i,this.session.delegate={onAck:function(e){return t.onAck(e)},onBye:function(e){return t.receiveRequest(e)},onInfo:function(e){return t.receiveRequest(e)},onInvite:function(e){return t.receiveRequest(e)},onNotify:function(e){return t.receiveRequest(e)},onPrack:function(e){return t.receiveRequest(e)},onRefer:function(e){return t.receiveRequest(e)}},i.signalingState){case a.SignalingState.Initial:case a.SignalingState.HaveLocalOffer:this.ackAndBye(e,i,400,"Missing session description"),this.failed(r,o.C.causes.BAD_MEDIA_DESCRIPTION);break;case a.SignalingState.HaveRemoteOffer:var n=this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions||{});if(this.sessionDescriptionHandler=n,this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),!n.hasDescription(r.getHeader("Content-Type")||"")){this.ackAndBye(e,i,400,"Missing session description"),this.failed(r,o.C.causes.BAD_MEDIA_DESCRIPTION);break}this.hasOffer=!0,n.setDescription(r.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){return n.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers)}).then(function(i){if(!t.isCanceled&&t.status!==c.SessionStatus.STATUS_TERMINATED){t.status=c.SessionStatus.STATUS_CONFIRMED,t.hasAnswer=!0;var n={contentDisposition:"session",contentType:i.contentType,content:i.body},s=e.ack({body:n});t.emit("ack",s.message),t.accepted(r)}}).catch(function(n){if(n.type!==c.TypeStrings.SessionDescriptionHandlerError)throw n;t.logger.warn("invalid description"),t.logger.warn(n.toString()),t.ackAndBye(e,i,488,"Invalid session description"),t.failed(r,o.C.causes.BAD_MEDIA_DESCRIPTION)});break;case a.SignalingState.Stable:var s;if(this.renderbody&&this.rendertype&&(s={body:{contentDisposition:"render",contentType:this.rendertype,content:this.renderbody}}),this.hasOffer&&!this.hasAnswer){if(!this.sessionDescriptionHandler)throw new Error("Session description handler undefined.");var u=i.answer;if(!u)throw new Error("Answer is undefined.");this.sessionDescriptionHandler.setDescription(u.content,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){t.hasAnswer=!0,t.status=c.SessionStatus.STATUS_CONFIRMED;var i=e.ack(s);t.emit("ack",i.message),t.accepted(r)}).catch(function(n){t.logger.error(n),t.ackAndBye(e,i,488,"Not Acceptable Here"),t.failed(r,o.C.causes.BAD_MEDIA_DESCRIPTION)})}else{if(this.sessionDescriptionHandler=this.earlyMediaSessionDescriptionHandlers.get(i.id),!this.sessionDescriptionHandler)throw new Error("Session description handler undefined.");this.earlyMediaSessionDescriptionHandlers.delete(i.id),this.hasOffer=!0,this.hasAnswer=!0,this.status=c.SessionStatus.STATUS_CONFIRMED;var d=e.ack();this.emit("ack",d.message),this.accepted(r)}break;case a.SignalingState.Closed:break;default:throw new Error("Unknown session signaling state.")}this.disposeEarlyMedia()}},t.prototype.onProgress=function(e){var t=this;if(!this.isCanceled){if(!this.outgoingInviteRequest)throw new Error("Outgoing INVITE request undefined.");if(!this.earlyMediaSessionDescriptionHandlers)throw new Error("Early media session description handlers undefined.");var r=e.message,i=e.session;if(this.status=c.SessionStatus.STATUS_1XX_RECEIVED,r.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=a.Grammar.nameAddrHeaderParse(r.getHeader("P-Asserted-Identity"))),!i)throw new Error("Session undefined.");var n=r.getHeader("require"),s=r.getHeader("rseq"),u=n&&n.includes("100rel")&&s?Number(s):void 0,d=!!u,p=[];if(d&&p.push("RAck: "+r.getHeader("rseq")+" "+r.getHeader("cseq")),i.signalingState===a.SignalingState.Initial)return d&&(this.logger.warn("First reliable provisional response received MUST contain an offer when INVITE does not contain an offer."),e.prack({extraHeaders:p})),void this.emit("progress",r);if(i.signalingState===a.SignalingState.HaveLocalOffer)return d&&e.prack({extraHeaders:p}),void this.emit("progress",r);if(i.signalingState===a.SignalingState.HaveRemoteOffer){if(!d)return void this.logger.warn("Non-reliable provisional response MUST NOT contain an initial offer, discarding response.");var h=this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions||{});return this.emit("SessionDescriptionHandler-created",h),this.earlyMediaSessionDescriptionHandlers.set(i.id,h),void h.setDescription(r.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){return h.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers)}).then(function(i){var n={contentDisposition:"session",contentType:i.contentType,content:i.body};e.prack({extraHeaders:p,body:n}),t.status=c.SessionStatus.STATUS_EARLY_MEDIA,t.emit("progress",r)}).catch(function(e){t.status!==c.SessionStatus.STATUS_TERMINATED&&(t.failed(void 0,o.C.causes.WEBRTC_ERROR),t.terminated(void 0,o.C.causes.WEBRTC_ERROR))})}return i.signalingState===a.SignalingState.Stable?(d&&e.prack({extraHeaders:p}),void this.emit("progress",r)):void 0}},t.prototype.onRedirect=function(e){this.disposeEarlyMedia();var t=e.message,r=t.statusCode,i=l.Utils.sipErrorCause(r||0);this.rejected(t,i),this.failed(t,i),this.terminated(t,i)},t.prototype.onReject=function(e){this.disposeEarlyMedia();var t=e.message,r=t.statusCode,i=l.Utils.sipErrorCause(r||0);this.rejected(t,i),this.failed(t,i),this.terminated(t,i)},t.prototype.onTrying=function(e){this.received100=!0,this.emit("progress",e.message)},t}(g);t.InviteClientContext=m},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(30),s=r(79),o=r(80),a=r(82),c=r(81),u=function(e){function t(t,r,i){void 0===i&&(i={});var n=e.call(this)||this;if(n.C={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500},n.type=o.TypeStrings.DTMF,void 0===r)throw new TypeError("Not enough arguments");if(n.logger=t.ua.getLogger("sip.invitecontext.dtmf",t.id),n.owner=t,"string"==typeof r)r=r.toUpperCase();else{if("number"!=typeof r)throw new TypeError("Invalid tone: "+r);r=r.toString()}if(!r.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+r);n.tone=r;var s=i.duration,a=i.interToneGap;if(s&&!c.Utils.isDecimal(s))throw new TypeError("Invalid tone duration: "+s);if(s?s<n.C.MIN_DURATION?(n.logger.warn("'duration' value is lower than the minimum allowed, setting it to "+n.C.MIN_DURATION+" milliseconds"),s=n.C.MIN_DURATION):s>n.C.MAX_DURATION?(n.logger.warn("'duration' value is greater than the maximum allowed, setting it to "+n.C.MAX_DURATION+" milliseconds"),s=n.C.MAX_DURATION):s=Math.abs(s):s=n.C.DEFAULT_DURATION,n.duration=s,a&&!c.Utils.isDecimal(a))throw new TypeError("Invalid interToneGap: "+a);return a?a<n.C.MIN_INTER_TONE_GAP?(n.logger.warn("'interToneGap' value is lower than the minimum allowed, setting it to "+n.C.MIN_INTER_TONE_GAP+" milliseconds"),a=n.C.MIN_INTER_TONE_GAP):a=Math.abs(a):a=n.C.DEFAULT_INTER_TONE_GAP,n.interToneGap=a,n}return i.__extends(t,e),t.prototype.send=function(e){if(void 0===e&&(e={}),this.owner.status!==o.SessionStatus.STATUS_CONFIRMED&&this.owner.status!==o.SessionStatus.STATUS_WAITING_FOR_ACK)throw new a.Exceptions.InvalidStateError(this.owner.status);var t=e.extraHeaders?e.extraHeaders.slice():[],r={contentType:"application/dtmf-relay",body:"Signal= "+this.tone+"\r\nDuration= "+this.duration};if(this.owner.session){var i=this.owner.session.info(void 0,{extraHeaders:t,body:c.Utils.fromBodyObj(r)});this.owner.emit("dtmf",i.message,this)}else;},t.prototype.init_incoming=function(e){e.accept(),this.tone&&this.duration?this.owner.emit("dtmf",e.message,this):this.logger.warn("invalid INFO DTMF received, discarded")},t.prototype.receiveResponse=function(e){var t=e&&e.statusCode?e.statusCode:0;switch(!0){case/^1[0-9]{2}$/.test(t.toString()):break;case/^2[0-9]{2}$/.test(t.toString()):this.emit("succeeded",{originator:"remote",response:e});break;default:var r=c.Utils.sipErrorCause(t);this.emit("failed",e,r)}},t.prototype.onRequestTimeout=function(){this.emit("failed",void 0,s.C.causes.REQUEST_TIMEOUT),this.owner.onRequestTimeout()},t.prototype.onTransportError=function(){this.emit("failed",void 0,s.C.causes.CONNECTION_ERROR),this.owner.onTransportError()},t.prototype.onDialogError=function(e){this.emit("failed",e,s.C.causes.DIALOG_ERROR),this.owner.onDialogError(e)},t}(n.EventEmitter);t.DTMF=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(30),s=r(79),o=r(2),a=r(58),c=r(80),u=r(81),d=function(e){function t(t,r,i,n){void 0===n&&(n={});var o=e.call(this)||this;o.data={},o.method=s.C.SUBSCRIBE,o.body=void 0,o.type=c.TypeStrings.Subscription,o.ua=t,o.logger=t.getLogger("sip.subscription"),n.body&&(o.body={body:n.body,contentType:n.contentType?n.contentType:"application/sdp"});var a=t.normalizeTarget(r);if(!a)throw new TypeError("Invalid target: "+r);if(o.uri=a,o.event=i,void 0===n.expires?o.expires=3600:"number"!=typeof n.expires?(t.logger.warn('Option "expires" must be a number. Using default of 3600.'),o.expires=3600):o.expires=n.expires,o.extraHeaders=(n.extraHeaders||[]).slice(),o.context=o.initContext(),o.disposed=!1,o.request=o.context.message,!o.request.from)throw new Error("From undefined.");if(!o.request.to)throw new Error("From undefined.");return o.localIdentity=o.request.from,o.remoteIdentity=o.request.to,o.id=o.request.callId+o.request.from.parameters.tag+o.event,o.ua.subscriptions[o.id]=o,o}return i.__extends(t,e),t.prototype.dispose=function(){this.disposed||(this.retryAfterTimer&&(clearTimeout(this.retryAfterTimer),this.retryAfterTimer=void 0),this.context.dispose(),this.disposed=!0,delete this.ua.subscriptions[this.id])},t.prototype.on=function(t,r){return e.prototype.on.call(this,t,r)},t.prototype.emit=function(t){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];return e.prototype.emit.apply(this,[t].concat(r))},t.prototype.close=function(){if(!this.disposed)switch(this.dispose(),this.context.state){case o.SubscriptionState.Initial:case o.SubscriptionState.NotifyWait:this.onTerminated();break;case o.SubscriptionState.Pending:case o.SubscriptionState.Active:this.unsubscribe();break;case o.SubscriptionState.Terminated:this.onTerminated()}},t.prototype.refresh=function(){var e=this;switch(this.context.state){case o.SubscriptionState.Initial:case o.SubscriptionState.NotifyWait:case o.SubscriptionState.Pending:break;case o.SubscriptionState.Active:if(this.subscription){var t=this.subscription.refresh();t.delegate={onAccept:function(t){return e.onAccepted(t)},onRedirect:function(t){return e.onFailed(t)},onReject:function(t){return e.onFailed(t)}}}break;case o.SubscriptionState.Terminated:}},t.prototype.subscribe=function(){var e=this;switch(this.context.state){case o.SubscriptionState.Initial:this.context.subscribe().then(function(t){t.success?(t.success.subscription&&(e.subscription=t.success.subscription,e.subscription.delegate={onNotify:function(t){return e.onNotify(t)},onRefresh:function(t){return e.onRefresh(t)},onTerminated:function(){return e.close()}}),e.onNotify(t.success.request)):t.failure&&e.onFailed(t.failure.response)});break;case o.SubscriptionState.NotifyWait:case o.SubscriptionState.Pending:break;case o.SubscriptionState.Active:this.refresh();break;case o.SubscriptionState.Terminated:}return this},t.prototype.unsubscribe=function(){switch(this.dispose(),this.context.state){case o.SubscriptionState.Initial:case o.SubscriptionState.NotifyWait:break;case o.SubscriptionState.Pending:case o.SubscriptionState.Active:this.subscription&&this.subscription.unsubscribe();break;case o.SubscriptionState.Terminated:}this.onTerminated()},t.prototype.onAccepted=function(e){var t=e.message.statusCode?e.message.statusCode:0,r=u.Utils.getReasonPhrase(t);this.emit("accepted",e.message,r)},t.prototype.onFailed=function(e){if(this.close(),e){var t=e.message.statusCode?e.message.statusCode:0,r=u.Utils.getReasonPhrase(t);this.emit("failed",e.message,r),this.emit("rejected",e.message,r)}},t.prototype.onNotify=function(e){var t=this;if(e.accept(),this.emit("notify",{request:e.message}),!this.disposed){var r=e.message.parseHeader("Subscription-State");if(r&&r.state)switch(r.state){case"terminated":if(r.reason)switch(this.logger.log("Terminated subscription with reason "+r.reason),r.reason){case"deactivated":case"timeout":return this.initContext(),void this.subscribe();case"probation":case"giveup":return this.initContext(),void(r.params&&r.params["retry-after"]?this.retryAfterTimer=setTimeout(function(){return t.subscribe()},r.params["retry-after"]):this.subscribe())}this.close()}}},t.prototype.onRefresh=function(e){var t=this;e.delegate={onAccept:function(e){return t.onAccepted(e)}}},t.prototype.onTerminated=function(){this.emit("terminated")},t.prototype.initContext=function(){var e=this,t={extraHeaders:this.extraHeaders,body:this.body?u.Utils.fromBodyObj(this.body):void 0};return this.context=new p(this.ua.userAgentCore,this.uri,this.event,this.expires,t),this.context.delegate={onAccept:function(t){return e.onAccepted(t)}},this.context},t}(n.EventEmitter);t.Subscription=d;var p=function(){function e(e,t,r,i,n,o){this.core=e,this.target=t,this.event=r,this.expires=i,this.subscribed=!1,this.logger=e.loggerFactory.getLogger("sip.subscription"),this.delegate=o;var c="Allow: "+a.AllowedMethods.toString(),u=(n&&n.extraHeaders||[]).slice();u.push(c),u.push("Event: "+this.event),u.push("Expires: "+this.expires),u.push("Contact: "+this.core.configuration.contact.toString());var d=n&&n.body;this.message=e.makeOutgoingRequestMessage(s.C.SUBSCRIBE,this.target,this.core.configuration.aor,this.target,{},u,d)}return e.prototype.dispose=function(){this.subscription&&this.subscription.dispose(),this.request&&(this.request.waitNotifyStop(),this.request.dispose())},Object.defineProperty(e.prototype,"state",{get:function(){return this.subscription?this.subscription.subscriptionState:this.subscribed?o.SubscriptionState.NotifyWait:o.SubscriptionState.Initial},enumerable:!0,configurable:!0}),e.prototype.subscribe=function(){var e=this;return this.subscribed?Promise.reject(new Error("Not in initial state. Did you call subscribe more than once?")):(this.subscribed=!0,new Promise(function(t,r){if(!e.message)throw new Error("Message undefined.");e.request=e.core.subscribe(e.message,{onAccept:function(t){e.delegate&&e.delegate.onAccept&&e.delegate.onAccept(t)},onNotify:function(r){e.subscription=r.subscription,e.subscription&&(e.subscription.autoRefresh=!0),t({success:r})},onNotifyTimeout:function(){t({failure:{}})},onRedirect:function(e){t({failure:{response:e}})},onReject:function(e){t({failure:{response:e}})}})}))},e}()},function(e,t,r){"use strict";function i(e){if(!(e.configuration.uri instanceof c.URI))throw new Error("Configuration URI not instance of URI.");var t=e.configuration.uri,r=e.contact,i=e.configuration.displayName?e.configuration.displayName:"",n=!!e.configuration.hackViaTcp,s=e.configuration.usePreloadedRoute&&e.transport.server&&e.transport.server.sipUri?[e.transport.server.sipUri]:[],o=e.configuration.sipjsId||S.Utils.createRandomToken(5),u=[];u.push("outbound"),e.configuration.rel100===a.C.supported.SUPPORTED&&u.push("100rel"),e.configuration.replaces===a.C.supported.SUPPORTED&&u.push("replaces"),e.configuration.extraSupported&&u.push.apply(u,e.configuration.extraSupported),e.configuration.hackAllowUnregisteredOptionTags||(u=u.filter(function(e){return a.C.OPTION_TAGS[e]})),u=Array.from(new Set(u));var d=e.getSupportedResponseOptions(),p=e.configuration.userAgentString||"sipjs";if(!e.configuration.viaHost)throw new Error("Configuration via host undefined");var h=!!e.configuration.forceRport,l=e.configuration.viaHost,g={aor:t,contact:r,displayName:i,hackViaTcp:n,loggerFactory:e.getLoggerFactory(),routeSet:s,sipjsId:o,supportedOptionTags:u,supportedOptionTagsResponse:d,userAgentHeaderFieldValue:p,viaForceRport:h,viaHost:l,authenticationFactory:function(){if(e.configuration.authenticationFactory)return e.configuration.authenticationFactory(e)},transportAccessor:function(){return e.transport}};return g}Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),s=r(30),o=r(78),a=r(79),c=r(2),u=r(80),d=r(82),p=r(83),h=r(84),l=r(85),g=r(87),f=r(86),m=r(88),v=r(90),S=r(81),T=r(92),y=r(101),E=function(e){function t(r){var n=e.call(this)||this;if(n.unloadListener=function(){n.stop()},n.type=u.TypeStrings.UA,n.log=new c.LoggerFactory,n.logger=n.getLogger("sip.ua"),n.configuration={},n.applicants={},n.data={},n.sessions={},n.subscriptions={},n.publishers={},n.status=u.UAStatus.STATUS_INIT,void 0===r?r={}:("string"==typeof r||r instanceof String)&&(r={uri:r}),r.log&&(n.log.builtinEnabled=r.log.builtinEnabled,r.log.hasOwnProperty("connector")&&(n.log.connector=r.log.connector),r.log.hasOwnProperty("level"))){var s=r.log.level,o=void 0;if("string"==typeof s)switch(s){case"error":o=c.Levels.error;break;case"warn":o=c.Levels.warn;break;case"log":o=c.Levels.log;break;case"debug":o=c.Levels.debug}else switch(s){case 0:o=c.Levels.error;break;case 1:o=c.Levels.warn;break;case 2:o=c.Levels.log;break;case 3:o=c.Levels.debug}void 0===o?n.logger.error('Invalid "level" parameter value: '+JSON.stringify(s)):n.log.level=o}var d="The UA class has been deprecated and will no longer be available starting with SIP.js release 0.16.0. The UA has been replaced by the UserAgent class. Please update accordingly.";n.logger.warn(d);try{n.loadConfig(r)}catch(e){throw n.status=u.UAStatus.STATUS_NOT_READY,n.error=t.C.CONFIGURATION_ERROR,e}if(!n.configuration.transportConstructor)throw new c.TransportError("Transport constructor not set");n.transport=new n.configuration.transportConstructor(n.getLogger("sip.transport"),n.configuration.transportOptions);var p=i(n),h=function(e,t){if(n.configuration.replaces!==a.C.supported.UNSUPPORTED){var r=t.parseHeader("replaces");if(r){var i=n.sessions[r.call_id+r.replaces_from_tag]||n.sessions[r.call_id+r.replaces_to_tag]||void 0;if(!i)return void n.userAgentCore.replyStateless(t,{statusCode:481});if(i.status===u.SessionStatus.STATUS_TERMINATED)return void n.userAgentCore.replyStateless(t,{statusCode:603});var s=r.call_id+r.replaces_to_tag+r.replaces_from_tag,o=n.userAgentCore.dialogs.get(s);if(!o)return void n.userAgentCore.replyStateless(t,{statusCode:481});if(!o.early&&r.early_only)return void n.userAgentCore.replyStateless(t,{statusCode:486});e.replacee=i}}},v={onInvite:function(e){e.trying(),e.delegate={onCancel:function(e){t.onCancel(e)},onTransportError:function(e){t.onTransportError()}};var t=new m.InviteServerContext(n,e);h(t,e.message),t.autoSendAnInitialProvisionalResponse&&t.progress(),n.emit("invite",t)},onMessage:function(e){var t=new f.ServerContext(n,e);t.body=e.message.body,t.contentType=e.message.getHeader("Content-Type")||"text/plain",e.accept(),n.emit("message",t)},onNotify:function(e){n.configuration.allowLegacyNotifications&&n.listeners("notify").length>0?(e.accept(),n.emit("notify",{request:e.message})):e.reject({statusCode:481})},onRefer:function(e){n.logger.log("Received an out of dialog refer"),n.configuration.allowOutOfDialogRefers||e.reject({statusCode:405}),n.logger.log("Allow out of dialog refers is enabled on the UA");var t=new l.ReferServerContext(n,e);n.listeners("outOfDialogReferRequested").length?n.emit("outOfDialogReferRequested",t):(n.logger.log("No outOfDialogReferRequest listeners, automatically accepting and following the out of dialog refer"),t.accept({followRefer:!0}))},onSubscribe:function(e){n.emit("subscribe",e)}};return n.userAgentCore=new c.UserAgentCore(p,v),n.registerContext=new g.RegisterContext(n,r.registerOptions),n.registerContext.on("failed",n.emit.bind(n,"registrationFailed")),n.registerContext.on("registered",n.emit.bind(n,"registered")),n.registerContext.on("unregistered",n.emit.bind(n,"unregistered")),n.configuration.autostart&&n.start(),n}return n.__extends(t,e),t.prototype.register=function(e){return void 0===e&&(e={}),e.register&&(this.configuration.register=!0),this.registerContext.register(e),this},t.prototype.unregister=function(e){var t=this;return this.configuration.register=!1,this.transport.afterConnected(function(){t.registerContext.unregister(e)}),this},t.prototype.isRegistered=function(){return this.registerContext.registered},t.prototype.invite=function(e,t,r){var i=this,n=new m.InviteClientContext(this,e,t,r);return this.transport.afterConnected(function(){n.invite(),i.emit("inviteSent",n)}),n},t.prototype.subscribe=function(e,t,r){var i=new v.Subscription(this,e,t,r);return this.transport.afterConnected(function(){return i.subscribe()}),i},t.prototype.publish=function(e,t,r,i){var n=new h.PublishContext(this,e,t,i);return this.transport.afterConnected(function(){n.publish(r)}),n},t.prototype.message=function(e,t,r){if(void 0===r&&(r={}),void 0===t)throw new TypeError("Not enough arguments");return r.contentType=r.contentType||"text/plain",r.body=t,this.request(a.C.MESSAGE,e,r)},t.prototype.request=function(e,t,r){var i=new o.ClientContext(this,e,t,r);return this.transport.afterConnected(function(){return i.send()}),i},t.prototype.stop=function(){if(this.logger.log("user requested closure..."),this.status===u.UAStatus.STATUS_USER_CLOSED)return this.logger.warn("UA already closed"),this;for(var e in this.logger.log("closing registerContext"),this.registerContext.close(),this.sessions)this.sessions[e]&&(this.logger.log("closing session "+e),this.sessions[e].terminate());for(var t in this.subscriptions)this.subscriptions[t]&&(this.logger.log("unsubscribe "+t),this.subscriptions[t].unsubscribe());for(var r in this.publishers)this.publishers[r]&&(this.logger.log("unpublish "+r),this.publishers[r].close());for(var i in this.applicants)this.applicants[i]&&this.applicants[i].close();if(this.status=u.UAStatus.STATUS_USER_CLOSED,this.transport.disconnect(),this.userAgentCore.reset(),this.configuration.autostop){var n=!("undefined"==typeof chrome||!chrome.app||!chrome.app.runtime);"undefined"==typeof window||n||window.removeEventListener("unload",this.unloadListener)}return this},t.prototype.start=function(){if(this.logger.log("user requested startup..."),this.status===u.UAStatus.STATUS_INIT?(this.status=u.UAStatus.STATUS_STARTING,this.setTransportListeners(),this.emit("transportCreated",this.transport),this.transport.connect()):this.status===u.UAStatus.STATUS_USER_CLOSED?(this.logger.log("resuming"),this.status=u.UAStatus.STATUS_READY,
this.transport.connect()):this.status===u.UAStatus.STATUS_STARTING?this.logger.log("UA is in STARTING status, not opening new connection"):this.status===u.UAStatus.STATUS_READY?this.logger.log("UA is in READY status, not resuming"):this.logger.error("Connection is down. Auto-Recovery system is trying to connect"),this.configuration.autostop){var e=!("undefined"==typeof chrome||!chrome.app||!chrome.app.runtime);"undefined"==typeof window||e||window.addEventListener("unload",this.unloadListener)}return this},t.prototype.normalizeTarget=function(e){return S.Utils.normalizeTarget(e,this.configuration.hostportParams)},t.prototype.getLogger=function(e,t){return this.log.getLogger(e,t)},t.prototype.getLoggerFactory=function(){return this.log},t.prototype.getSupportedResponseOptions=function(){var e=[];(this.contact.pubGruu||this.contact.tempGruu)&&e.push("gruu"),this.configuration.rel100===a.C.supported.SUPPORTED&&e.push("100rel"),this.configuration.replaces===a.C.supported.SUPPORTED&&e.push("replaces"),e.push("outbound"),e=e.concat(this.configuration.extraSupported||[]);var t=this.configuration.hackAllowUnregisteredOptionTags||!1,r={};return e=e.filter(function(e){var i=a.C.OPTION_TAGS[e],n=!r[e];return r[e]=!0,(i||t)&&n}),e},t.prototype.findSession=function(e){return this.sessions[e.callId+e.fromTag]||this.sessions[e.callId+e.toTag]||void 0},t.prototype.on=function(t,r){return e.prototype.on.call(this,t,r)},t.prototype.onTransportError=function(){this.status!==u.UAStatus.STATUS_USER_CLOSED&&(this.error&&this.error===t.C.NETWORK_ERROR||(this.status=u.UAStatus.STATUS_NOT_READY,this.error=t.C.NETWORK_ERROR))},t.prototype.setTransportListeners=function(){var e=this;this.transport.on("connected",function(){return e.onTransportConnected()}),this.transport.on("message",function(t){return e.onTransportReceiveMsg(t)}),this.transport.on("transportError",function(){return e.onTransportError()})},t.prototype.onTransportConnected=function(){var e=this;this.configuration.register&&Promise.resolve().then(function(){return e.registerContext.register()})},t.prototype.onTransportReceiveMsg=function(e){var t=this,r=p.Parser.parseMessage(e,this.getLogger("sip.parser"));if(r)if(this.status===u.UAStatus.STATUS_USER_CLOSED&&r instanceof c.IncomingRequestMessage)this.logger.warn("UA received message when status = USER_CLOSED - aborting");else{var i=function(){for(var e=["from","to","call_id","cseq","via"],i=0,n=e;i<n.length;i++){var s=n[i];if(!r.hasHeader(s))return t.logger.warn("Missing mandatory header field : "+s+"."),!1}return!0};if(r instanceof c.IncomingRequestMessage){if(!i())return void this.logger.warn("Request missing mandatory header field. Dropping.");if(!r.toTag&&r.callId.substr(0,5)===this.configuration.sipjsId)return void this.userAgentCore.replyStateless(r,{statusCode:482});var n=S.Utils.str_utf8_length(r.body),s=r.getHeader("content-length");if(s&&n<Number(s))return void this.userAgentCore.replyStateless(r,{statusCode:400})}if(r instanceof c.IncomingResponseMessage){if(!i())return void this.logger.warn("Response missing mandatory header field. Dropping.");if(r.getHeaders("via").length>1)return void this.logger.warn("More than one Via header field present in the response. Dropping.");if(r.via.host!==this.configuration.viaHost||void 0!==r.via.port)return void this.logger.warn("Via sent-by in the response does not match UA Via host value. Dropping.");n=S.Utils.str_utf8_length(r.body),s=r.getHeader("content-length");if(s&&n<Number(s))return void this.logger.warn("Message body length is lower than the value in Content-Length header field. Dropping.")}if(r instanceof c.IncomingRequestMessage)this.userAgentCore.receiveIncomingRequestFromTransport(r);else{if(!(r instanceof c.IncomingResponseMessage))throw new Error("Invalid message type.");this.userAgentCore.receiveIncomingResponseFromTransport(r)}}else this.logger.warn("UA failed to parse incoming SIP message - discarding.")},t.prototype.checkAuthenticationFactory=function(e){if(e instanceof Function)return e.initialize||(e.initialize=function(){return Promise.resolve()}),e},t.prototype.loadConfig=function(e){var t=this,r={viaHost:S.Utils.createRandomToken(12)+".invalid",uri:new c.URI("sip","anonymous."+S.Utils.createRandomToken(6),"anonymous.invalid",void 0,void 0),custom:{},displayName:"",password:void 0,register:!0,registerOptions:{},transportConstructor:y.Transport,transportOptions:{},usePreloadedRoute:!1,userAgentString:a.C.USER_AGENT,noAnswerTimeout:60,hackViaTcp:!1,hackIpInContact:!1,hackWssInTransport:!1,hackAllowUnregisteredOptionTags:!1,sessionDescriptionHandlerFactoryOptions:{constraints:{},peerConnectionOptions:{}},extraSupported:[],contactName:S.Utils.createRandomToken(8),contactTransport:"ws",forceRport:!1,autostart:!0,autostop:!0,rel100:a.C.supported.UNSUPPORTED,dtmfType:a.C.dtmfType.INFO,replaces:a.C.supported.UNSUPPORTED,sessionDescriptionHandlerFactory:T.SessionDescriptionHandler.defaultFactory,authenticationFactory:this.checkAuthenticationFactory(function(e){return new c.DigestAuthentication(e.getLoggerFactory(),t.configuration.authorizationUser,t.configuration.password)}),allowLegacyNotifications:!1,allowOutOfDialogRefers:!1,experimentalFeatures:!1},i=this.getConfigurationCheck();for(var n in i.mandatory){if(!e.hasOwnProperty(n))throw new d.Exceptions.ConfigurationError(n);var s=e[n],o=i.mandatory[n](s);if(void 0===o)throw new d.Exceptions.ConfigurationError(n,s);r[n]=o}for(var n in i.optional)if(e.hasOwnProperty(n)){s=e[n];if(s instanceof Array&&0===s.length||null===s||""===s||void 0===s||"number"==typeof s&&isNaN(s))continue;o=i.optional[n](s);if(void 0===o)throw new d.Exceptions.ConfigurationError(n,s);r[n]=o}0===r.displayName&&(r.displayName="0"),r.sipjsId=S.Utils.createRandomToken(5);var u=r.uri.clone();if(u.user=void 0,r.hostportParams=u.toRaw().replace(/^sip:/i,""),r.authorizationUser||(r.authorizationUser=r.uri.user),r.noAnswerTimeout=1e3*r.noAnswerTimeout,r.hackIpInContact)if("boolean"==typeof r.hackIpInContact){var p=1,h=254,l=Math.floor(Math.random()*(h-p+1)+p);r.viaHost="192.0.2."+l}else"string"==typeof r.hackIpInContact&&(r.viaHost=r.hackIpInContact);r.hackWssInTransport&&(r.contactTransport="wss"),this.contact={pubGruu:void 0,tempGruu:void 0,uri:new c.URI("sip",r.contactName,r.viaHost,void 0,{transport:r.contactTransport}),toString:function(e){void 0===e&&(e={});var i=e.anonymous||!1,n=e.outbound||!1,s="<";return s+=i?(t.contact.tempGruu||"sip:anonymous@anonymous.invalid;transport="+r.contactTransport).toString():(t.contact.pubGruu||t.contact.uri).toString(),n&&(s+=";ob"),s+=">",s}};var g={};for(var n in r)r.hasOwnProperty(n)&&(g[n]=r[n]);for(var n in Object.assign(this.configuration,g),this.logger.log("configuration parameters after validation:"),r)if(r.hasOwnProperty(n))switch(n){case"uri":case"sessionDescriptionHandlerFactory":this.logger.log("¬∑ "+n+": "+r[n]);break;case"password":this.logger.log("¬∑ "+n+": NOT SHOWN");break;case"transportConstructor":this.logger.log("¬∑ "+n+": "+r[n].name);break;default:this.logger.log("¬∑ "+n+": "+JSON.stringify(r[n]))}},t.prototype.getConfigurationCheck=function(){return{mandatory:{},optional:{uri:function(e){/^sip:/i.test(e)||(e=a.C.SIP+":"+e);var t=c.Grammar.URIParse(e);return t&&t.user?t:void 0},transportConstructor:function(e){if(e instanceof Function)return e},transportOptions:function(e){if("object"==typeof e)return e},authorizationUser:function(e){return-1===c.Grammar.parse('"'+e+'"',"quoted_string")?void 0:e},displayName:function(e){return-1===c.Grammar.parse('"'+e+'"',"displayName")?void 0:e},dtmfType:function(e){switch(e){case a.C.dtmfType.RTP:return a.C.dtmfType.RTP;case a.C.dtmfType.INFO:default:return a.C.dtmfType.INFO}},hackViaTcp:function(e){if("boolean"==typeof e)return e},hackIpInContact:function(e){return"boolean"==typeof e?e:"string"==typeof e&&-1!==c.Grammar.parse(e,"host")?e:void 0},hackWssInTransport:function(e){if("boolean"==typeof e)return e},hackAllowUnregisteredOptionTags:function(e){if("boolean"==typeof e)return e},contactTransport:function(e){if("string"==typeof e)return e},extraSupported:function(e){if(e instanceof Array){for(var t=0,r=e;t<r.length;t++){var i=r[t];if("string"!=typeof i)return}return e}},forceRport:function(e){if("boolean"==typeof e)return e},noAnswerTimeout:function(e){if(S.Utils.isDecimal(e)){var t=Number(e);if(t>0)return t}},password:function(e){return String(e)},rel100:function(e){return e===a.C.supported.REQUIRED?a.C.supported.REQUIRED:e===a.C.supported.SUPPORTED?a.C.supported.SUPPORTED:a.C.supported.UNSUPPORTED},replaces:function(e){return e===a.C.supported.REQUIRED?a.C.supported.REQUIRED:e===a.C.supported.SUPPORTED?a.C.supported.SUPPORTED:a.C.supported.UNSUPPORTED},register:function(e){if("boolean"==typeof e)return e},registerOptions:function(e){if("object"==typeof e)return e},usePreloadedRoute:function(e){if("boolean"==typeof e)return e},userAgentString:function(e){if("string"==typeof e)return e},autostart:function(e){if("boolean"==typeof e)return e},autostop:function(e){if("boolean"==typeof e)return e},sessionDescriptionHandlerFactory:function(e){if(e instanceof Function)return e},sessionDescriptionHandlerFactoryOptions:function(e){if("object"==typeof e)return e},authenticationFactory:this.checkAuthenticationFactory,allowLegacyNotifications:function(e){if("boolean"==typeof e)return e},custom:function(e){if("object"==typeof e)return e},contactName:function(e){if("string"==typeof e)return e},experimentalFeatures:function(e){if("boolean"==typeof e)return e}}}},t.C={STATUS_INIT:0,STATUS_STARTING:1,STATUS_READY:2,STATUS_USER_CLOSED:3,STATUS_NOT_READY:4,CONFIGURATION_ERROR:1,NETWORK_ERROR:2,ALLOWED_METHODS:["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"],ACCEPTED_BODY_TYPES:["application/sdp","application/dtmf-relay"],MAX_FORWARDS:70,TAG_LENGTH:10},t}(s.EventEmitter);t.UA=E,function(e){(function(e){e.RTP="rtp",e.INFO="info"})(e.DtmfType||(e.DtmfType={}))}(E=t.UA||(t.UA={})),t.UA=E,t.makeUserAgentCoreConfigurationFromUA=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(30),s=r(93),o=r(80),a=r(82),c=r(81),u=i.__importStar(r(99)),d=r(100),p=function(e){function t(t,r,i){var n=e.call(this)||this;return n.type=o.TypeStrings.SessionDescriptionHandler,n.options=i||{},n.logger=t,n.observer=r,n.dtmfSender=void 0,n.shouldAcquireMedia=!0,n.CONTENT_TYPE="application/sdp",n.C={DIRECTION:{NULL:null,SENDRECV:"sendrecv",SENDONLY:"sendonly",RECVONLY:"recvonly",INACTIVE:"inactive"}},n.logger.log("SessionDescriptionHandlerOptions: "+JSON.stringify(n.options)),n.direction=n.C.DIRECTION.NULL,n.modifiers=n.options.modifiers||[],Array.isArray(n.modifiers)||(n.modifiers=[n.modifiers]),n.iceGatheringTimeout=!1,n.initPeerConnection(n.options.peerConnectionOptions),n.constraints=n.checkAndDefaultConstraints(n.options.constraints),n}return i.__extends(t,e),t.defaultFactory=function(e,r){var i=e instanceof s.Session?e.userAgent.getLogger("sip.sessionDescriptionHandler",e.id):e.ua.getLogger("sip.invitecontext.sessionDescriptionHandler",e.id),n=new d.SessionDescriptionHandlerObserver(e,r);return new t(i,n,r)},t.prototype.close=function(){this.logger.log("closing PeerConnection"),this.peerConnection&&"closed"!==this.peerConnection.signalingState&&(this.peerConnection.getSenders?this.peerConnection.getSenders().forEach(function(e){e.track&&e.track.stop()}):(this.logger.warn("Using getLocalStreams which is deprecated"),this.peerConnection.getLocalStreams().forEach(function(e){e.getTracks().forEach(function(e){e.stop()})})),this.peerConnection.getReceivers?this.peerConnection.getReceivers().forEach(function(e){e.track&&e.track.stop()}):(this.logger.warn("Using getRemoteStreams which is deprecated"),this.peerConnection.getRemoteStreams().forEach(function(e){e.getTracks().forEach(function(e){e.stop()})})),this.resetIceGatheringComplete(),this.peerConnection.close())},t.prototype.getDescription=function(e,t){var r=this;void 0===e&&(e={}),void 0===t&&(t=[]),e.peerConnectionOptions&&this.initPeerConnection(e.peerConnectionOptions);var i=Object.assign({},this.constraints,e.constraints);return i=this.checkAndDefaultConstraints(i),JSON.stringify(i)!==JSON.stringify(this.constraints)&&(this.constraints=i,this.shouldAcquireMedia=!0),Array.isArray(t)||(t=[t]),t=t.concat(this.modifiers),Promise.resolve().then(function(){if(r.shouldAcquireMedia)return r.acquire(r.constraints).then(function(){r.shouldAcquireMedia=!1})}).then(function(){return r.createOfferOrAnswer(e.RTCOfferOptions,t)}).then(function(e){if(void 0===e.sdp)throw new a.Exceptions.SessionDescriptionHandlerError("getDescription",void 0,"SDP undefined");return r.emit("getDescription",e),{body:e.sdp,contentType:r.CONTENT_TYPE}})},t.prototype.hasDescription=function(e){return e===this.CONTENT_TYPE},t.prototype.holdModifier=function(e){return e.sdp?(/a=(sendrecv|sendonly|recvonly|inactive)/.test(e.sdp)?(e.sdp=e.sdp.replace(/a=sendrecv\r\n/g,"a=sendonly\r\n"),e.sdp=e.sdp.replace(/a=recvonly\r\n/g,"a=inactive\r\n")):e.sdp=e.sdp.replace(/(m=[^\r]*\r\n)/g,"$1a=sendonly\r\n"),Promise.resolve(e)):Promise.resolve(e)},t.prototype.setDescription=function(e,t,r){var i=this;void 0===t&&(t={}),void 0===r&&(r=[]),t.peerConnectionOptions&&this.initPeerConnection(t.peerConnectionOptions),Array.isArray(r)||(r=[r]),r=r.concat(this.modifiers);var n={type:this.hasOffer("local")?"answer":"offer",sdp:e};return Promise.resolve().then(function(){if(i.shouldAcquireMedia&&i.options.alwaysAcquireMediaFirst)return i.acquire(i.constraints).then(function(){i.shouldAcquireMedia=!1})}).then(function(){return c.Utils.reducePromises(r,n)}).catch(function(e){if(e.type===o.TypeStrings.SessionDescriptionHandlerError)throw e;var t=new a.Exceptions.SessionDescriptionHandlerError("setDescription",e,"The modifiers did not resolve successfully");throw i.logger.error(t.message),i.emit("peerConnection-setRemoteDescriptionFailed",t),t}).then(function(e){return i.emit("setDescription",e),i.peerConnection.setRemoteDescription(e)}).catch(function(n){if(n.type===o.TypeStrings.SessionDescriptionHandlerError)throw n;if(/^m=video.+$/gm.test(e)&&!t.disableAudioFallback)return t.disableAudioFallback=!0,i.setDescription(e,t,[u.stripVideo].concat(r));var s=new a.Exceptions.SessionDescriptionHandlerError("setDescription",n);throw s.error&&i.logger.error(s.error),i.emit("peerConnection-setRemoteDescriptionFailed",s),s}).then(function(){i.peerConnection.getReceivers?i.emit("setRemoteDescription",i.peerConnection.getReceivers()):i.emit("setRemoteDescription",i.peerConnection.getRemoteStreams()),i.emit("confirmed",i)})},t.prototype.sendDtmf=function(e,t){if(void 0===t&&(t={}),!this.dtmfSender&&this.hasBrowserGetSenderSupport()){var r=this.peerConnection.getSenders();r.length>0&&(this.dtmfSender=r[0].dtmf)}if(!this.dtmfSender&&this.hasBrowserTrackSupport()){var i=this.peerConnection.getLocalStreams();if(i.length>0){var n=i[0].getAudioTracks();n.length>0&&(this.dtmfSender=this.peerConnection.createDTMFSender(n[0]))}}if(!this.dtmfSender)return!1;try{this.dtmfSender.insertDTMF(e,t.duration,t.interToneGap)}catch(e){if("InvalidStateError"===e.type||"InvalidCharacterError"===e.type)return this.logger.error(e),!1;throw e}return this.logger.log("DTMF sent via RTP: "+e.toString()),!0},t.prototype.getDirection=function(){return this.direction},t.prototype.on=function(t,r){return e.prototype.on.call(this,t,r)},t.prototype.getMediaStream=function(e){return navigator.mediaDevices.getUserMedia(e)},t.prototype.createOfferOrAnswer=function(e,t){var r=this;void 0===e&&(e={}),void 0===t&&(t=[]);var i=this.hasOffer("remote")?"createAnswer":"createOffer",n=this.peerConnection;this.logger.log(i);var s=this.hasOffer("remote")?n.createAnswer:n.createOffer;return s.apply(n,e).catch(function(e){if(e.type===o.TypeStrings.SessionDescriptionHandlerError)throw e;var t=new a.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",e,"peerConnection-"+i+"Failed");throw r.emit("peerConnection-"+i+"Failed",t),t}).then(function(e){return c.Utils.reducePromises(t,r.createRTCSessionDescriptionInit(e))}).then(function(e){return r.resetIceGatheringComplete(),r.logger.log("Setting local sdp."),r.logger.log("sdp is "+e.sdp||!1),n.setLocalDescription(e)}).catch(function(e){if(e.type===o.TypeStrings.SessionDescriptionHandlerError)throw e;var t=new a.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",e,"peerConnection-SetLocalDescriptionFailed");throw r.emit("peerConnection-SetLocalDescriptionFailed",t),t}).then(function(){return r.waitForIceGatheringComplete()}).then(function(){if(!r.peerConnection.localDescription)throw new a.Exceptions.SessionDescriptionHandlerError("Missing local description");var e=r.createRTCSessionDescriptionInit(r.peerConnection.localDescription);return c.Utils.reducePromises(t,e)}).then(function(e){return r.setDirection(e.sdp||""),e}).catch(function(e){if(e.type===o.TypeStrings.SessionDescriptionHandlerError)throw e;var t=new a.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",e);throw r.logger.error(t.toString()),t})},t.prototype.createRTCSessionDescriptionInit=function(e){return{type:e.type,sdp:e.sdp}},t.prototype.addDefaultIceCheckingTimeout=function(e){return void 0===e.iceCheckingTimeout&&(e.iceCheckingTimeout=500),e},t.prototype.addDefaultIceServers=function(e){return e.iceServers||(e.iceServers=[{urls:"stun:118.31.58.79:3478"}]),e},t.prototype.checkAndDefaultConstraints=function(e){var t={audio:!0,video:!this.options.alwaysAcquireMediaFirst};return e=e||t,0===Object.keys(e).length&&e.constructor===Object?t:e},t.prototype.hasBrowserTrackSupport=function(){return Boolean(this.peerConnection.addTrack)},t.prototype.hasBrowserGetSenderSupport=function(){return Boolean(this.peerConnection.getSenders)},t.prototype.initPeerConnection=function(e){var t=this;void 0===e&&(e={}),e=this.addDefaultIceCheckingTimeout(e),e.rtcConfiguration=e.rtcConfiguration||{},e.rtcConfiguration=this.addDefaultIceServers(e.rtcConfiguration),this.logger.log("initPeerConnection"),this.peerConnection&&(this.logger.log("Already have a peer connection for this session. Tearing down."),this.resetIceGatheringComplete(),this.peerConnection.close()),this.peerConnection=new RTCPeerConnection(e.rtcConfiguration),this.logger.log("New peer connection created"),"ontrack"in this.peerConnection?this.peerConnection.addEventListener("track",function(e){t.logger.log("track added"),t.observer.trackAdded(),t.emit("addTrack",e)}):(this.logger.warn("Using onaddstream which is deprecated"),this.peerConnection.onaddstream=function(e){t.logger.log("stream added"),t.emit("addStream",e)}),this.peerConnection.onicecandidate=function(e){t.emit("iceCandidate",e),e.candidate?t.logger.log("ICE candidate received: "+(null===e.candidate.candidate?null:e.candidate.candidate.trim())):null===e.candidate&&(t.logger.log("ICE candidate gathering complete"),t.triggerIceGatheringComplete())},this.peerConnection.onicegatheringstatechange=function(){switch(t.logger.log("RTCIceGatheringState changed: "+t.peerConnection.iceGatheringState),t.peerConnection.iceGatheringState){case"gathering":t.emit("iceGathering",t),!t.iceGatheringTimer&&e.iceCheckingTimeout&&(t.iceGatheringTimeout=!1,t.iceGatheringTimer=setTimeout(function(){t.logger.log("RTCIceChecking Timeout Triggered after "+e.iceCheckingTimeout+" milliseconds"),t.iceGatheringTimeout=!0,t.triggerIceGatheringComplete()},e.iceCheckingTimeout));break;case"complete":t.triggerIceGatheringComplete()}},this.peerConnection.oniceconnectionstatechange=function(){var e;switch(t.peerConnection.iceConnectionState){case"new":e="iceConnection";break;case"checking":e="iceConnectionChecking";break;case"connected":e="iceConnectionConnected";break;case"completed":e="iceConnectionCompleted";break;case"failed":e="iceConnectionFailed";break;case"disconnected":e="iceConnectionDisconnected";break;case"closed":e="iceConnectionClosed";break;default:return void t.logger.warn("Unknown iceConnection state: "+t.peerConnection.iceConnectionState)}t.logger.log("ICE Connection State changed to "+e),t.emit(e,t)}},t.prototype.acquire=function(e){var t=this;return e=this.checkAndDefaultConstraints(e),new Promise(function(r,i){t.logger.log("acquiring local media"),t.emit("userMediaRequest",e),e.audio||e.video?t.getMediaStream(e).then(function(e){t.observer.trackAdded(),t.emit("userMedia",e),r(e)}).catch(function(e){t.emit("userMediaFailed",e),i(e)}):r([])}).catch(function(e){if(e.type===o.TypeStrings.SessionDescriptionHandlerError)throw e;var r=new a.Exceptions.SessionDescriptionHandlerError("acquire",e,"unable to acquire streams");throw t.logger.error(r.message),r.error&&t.logger.error(r.error),r}).then(function(e){return t.logger.log("acquired local media streams"),t.peerConnection.removeTrack&&t.peerConnection.getSenders().forEach(function(e){t.peerConnection.removeTrack(e)}),e}).catch(function(e){if(e.type===o.TypeStrings.SessionDescriptionHandlerError)throw e;var r=new a.Exceptions.SessionDescriptionHandlerError("acquire",e,"error removing streams");throw t.logger.error(r.message),r.error&&t.logger.error(r.error),r}).then(function(e){var r=[].concat(e);return r.forEach(function(e){t.peerConnection.addTrack?e.getTracks().forEach(function(r){t.peerConnection.addTrack(r,e)}):t.peerConnection.addStream(e)}),Promise.resolve()}).catch(function(e){if(e.type===o.TypeStrings.SessionDescriptionHandlerError)throw e;var r=new a.Exceptions.SessionDescriptionHandlerError("acquire",e,"error adding stream");throw t.logger.error(r.message),r.error&&t.logger.error(r.error),r})},t.prototype.hasOffer=function(e){var t="have-"+e+"-offer";return this.peerConnection.signalingState===t},t.prototype.isIceGatheringComplete=function(){return"complete"===this.peerConnection.iceGatheringState||this.iceGatheringTimeout},t.prototype.resetIceGatheringComplete=function(){this.iceGatheringTimeout=!1,this.logger.log("resetIceGatheringComplete"),this.iceGatheringTimer&&(clearTimeout(this.iceGatheringTimer),this.iceGatheringTimer=void 0),this.iceGatheringDeferred&&(this.iceGatheringDeferred.reject(),this.iceGatheringDeferred=void 0)},t.prototype.setDirection=function(e){var t=e.match(/a=(sendrecv|sendonly|recvonly|inactive)/);if(null===t)return this.direction=this.C.DIRECTION.NULL,void this.observer.directionChanged();var r=t[1];switch(r){case this.C.DIRECTION.SENDRECV:case this.C.DIRECTION.SENDONLY:case this.C.DIRECTION.RECVONLY:case this.C.DIRECTION.INACTIVE:this.direction=r;break;default:this.direction=this.C.DIRECTION.NULL}this.observer.directionChanged()},t.prototype.triggerIceGatheringComplete=function(){this.isIceGatheringComplete()&&(this.emit("iceGatheringComplete",this),this.iceGatheringTimer&&(clearTimeout(this.iceGatheringTimer),this.iceGatheringTimer=void 0),this.iceGatheringDeferred&&(this.iceGatheringDeferred.resolve(),this.iceGatheringDeferred=void 0))},t.prototype.waitForIceGatheringComplete=function(){return this.logger.log("waitForIceGatheringComplete"),this.isIceGatheringComplete()?(this.logger.log("ICE is already complete. Return resolved."),Promise.resolve()):(this.iceGatheringDeferred||(this.iceGatheringDeferred=c.Utils.defer()),this.logger.log("ICE is not complete. Returning promise"),this.iceGatheringDeferred?this.iceGatheringDeferred.promise:Promise.resolve())},t}(n.EventEmitter);t.SessionDescriptionHandler=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(30),s=r(79),o=r(2),a=r(58),c=r(80),u=r(82),d=r(81),p=r(94),h=r(95),l=r(96),g=r(97),f=r(98),m=function(e){function t(t,r){void 0===r&&(r={});var i=e.call(this)||this;i.type=c.TypeStrings.Session,i.method=s.C.INVITE,i.localHold=!1,i.status=c.SessionStatus.STATUS_NULL,i.rel100=s.C.supported.UNSUPPORTED,i.expiresTimer=void 0,i.userNoAnswerTimer=void 0,i._state=f.SessionState.Initial,i._stateEventEmitter=new n.EventEmitter,i.pendingReinvite=!1,i.tones=void 0,i.userAgent=t,i.delegate=r.delegate,i.logger=t.getLogger("sip.session");var o=i.userAgent.configuration.sessionDescriptionHandlerFactory;if(!o)throw new u.Exceptions.SessionDescriptionHandlerError("A session description handler is required for the session to function.");return i.sessionDescriptionHandlerFactory=o,i.errorListener=i.onTransportError.bind(i),t.transport&&t.transport.on("transportError",i.errorListener),i}return i.__extends(t,e),t.prototype.on=function(t,r){return e.prototype.on.call(this,t,r)},t.prototype.emit=function(t){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];return e.prototype.emit.apply(this,[t].concat(r))},Object.defineProperty(t.prototype,"sessionDescriptionHandler",{get:function(){return this._sessionDescriptionHandler},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stateChange",{get:function(){return p.makeEmitter(this._stateEventEmitter)},enumerable:!0,configurable:!0}),t.prototype.invite=function(e){var t=this;if(void 0===e&&(e={}),this.logger.log("Session.invite"),this.state!==f.SessionState.Established)return Promise.reject(new Error("Invalid session state "+this.state));if(this.pendingReinvite)return Promise.reject(new Error("Reinvite in progress. Please wait until complete, then try again."));if(!this._sessionDescriptionHandler)throw new Error("Session description handler undefined.");var r={sessionDescriptionHandlerOptions:e.sessionDescriptionHandlerOptions,sessionDescriptionHandlerModifiers:e.sessionDescriptionHandlerModifiers};return this.pendingReinvite=!0,this.getOffer(r).then(function(r){if(!t.dialog)throw new Error("Dialog undefined.");var i={onAccept:function(r){var i=r.ack();t.emit("ack",i.message),t.emit("reinviteAccepted",t),t.pendingReinvite=!1;var n=o.getBody(r.message);if(!n){t.logger.error("Received 2xx final response to re-invite without a description");var s=new Error("Invalid response to a re-invite.");throw t.emit("reinviteFailed",t),t.emit("renegotiationError",s),s}var a={sessionDescriptionHandlerOptions:t.sessionDescriptionHandlerOptions,sessionDescriptionHandlerModifiers:t.sessionDescriptionHandlerModifiers};t.setAnswer(n,a),e.requestDelegate&&e.requestDelegate.onAccept&&e.requestDelegate.onAccept(r)},onProgress:function(e){},onRedirect:function(e){},onReject:function(r){t.logger.error("Received a non-2xx final response to re-invite");var i=new Error("Invalid response to a re-invite.");t.emit("reinviteFailed",t),t.emit("renegotiationError",i),e.requestDelegate&&e.requestDelegate.onReject&&e.requestDelegate.onReject(r)},onTrying:function(e){}},n=e.requestOptions||{};return n.extraHeaders=(n.extraHeaders||[]).slice(),n.extraHeaders.push("Allow: "+a.AllowedMethods.toString()),n.extraHeaders.push("Contact: "+t.contact),n.body=r,t.dialog.invite(i,n)}).catch(function(e){throw t.logger.error(e.message),t.emit("reinviteFailed",t),t.emit("renegotiationError",e),t.pendingReinvite=!1,e})},t.prototype.byePending=function(){this.stateTransition(f.SessionState.Terminating),this.terminated()},t.prototype.byeSent=function(e){this.emit("bye",e.message),this.stateTransition(f.SessionState.Terminated),this.terminated()},t.prototype.bye=function(e,t){var r=this;if(!this.dialog)return Promise.reject(new Error("Session dialog undefined."));var i=this.dialog;switch(i.sessionState){case o.SessionState.Initial:case o.SessionState.Early:throw new Error("Invalid dialog state "+i.sessionState);case o.SessionState.AckWait:return this.byePending(),new Promise(function(n,s){i.delegate={onAck:function(){var s=i.bye(e,t);r.byeSent(s),n(s)},onAckTimeout:function(){var s=i.bye(e,t);r.byeSent(s),n(s)}}});case o.SessionState.Confirmed:var n=i.bye(e,t);return this.byeSent(n),Promise.resolve(n);case o.SessionState.Terminated:throw new Error("Invalid dialog state "+i.sessionState);default:throw new Error("Unrecognized state.")}},t.prototype.info=function(e,t){return this.dialog?Promise.resolve(this.dialog.info(e,t)):Promise.reject(new Error("Session dialog undefined."))},t.prototype.refer=function(e,t,r){return this.dialog?(this.referrer=e,Promise.resolve(this.dialog.refer(t,r))):Promise.reject(new Error("Session dialog undefined."))},t.prototype.close=function(){if(this.status!==c.SessionStatus.STATUS_TERMINATED){if(this.logger.log("closing INVITE session "+this.id),this._sessionDescriptionHandler&&this._sessionDescriptionHandler.close(),this.expiresTimer&&clearTimeout(this.expiresTimer),this.userNoAnswerTimer&&clearTimeout(this.userNoAnswerTimer),this.status=c.SessionStatus.STATUS_TERMINATED,this.userAgent.transport&&this.userAgent.transport.removeListener("transportError",this.errorListener),!this.id)throw new Error("Session id undefined.");delete this.userAgent.sessions[this.id]}},t.prototype.onRequestTimeout=function(){this.status===c.SessionStatus.STATUS_CONFIRMED?this.terminated(void 0,s.C.causes.REQUEST_TIMEOUT):this.status!==c.SessionStatus.STATUS_TERMINATED&&(this.failed(void 0,s.C.causes.REQUEST_TIMEOUT),this.terminated(void 0,s.C.causes.REQUEST_TIMEOUT))},t.prototype.onTransportError=function(){this.status!==c.SessionStatus.STATUS_CONFIRMED&&this.status!==c.SessionStatus.STATUS_TERMINATED&&this.failed(void 0,s.C.causes.CONNECTION_ERROR)},t.prototype.onAckRequest=function(e){var t=this;if(this.logger.log("Session.onAckRequest"),this.state===f.SessionState.Initial||this.state===f.SessionState.Establishing||this.state===f.SessionState.Established||this.state===f.SessionState.Terminating){this.state!==f.SessionState.Initial&&this.state!==f.SessionState.Establishing||this.stateTransition(f.SessionState.Established);var r=this.dialog;if(!r)throw new Error("Dialog undefined.");var i=function(){t.status=c.SessionStatus.STATUS_CONFIRMED,t.emit("confirmed",e.message)},n=o.getBody(e.message);if(n){if("render"===n.contentDisposition)return this.renderbody=n.content,this.rendertype=n.contentType,void i();if("session"===n.contentDisposition){var a={sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptions,sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiers};switch(r.signalingState){case o.SignalingState.Initial:throw new Error("Invalid signaling state "+r.signalingState+".");case o.SignalingState.Stable:return void this.setAnswer(n,a).then(function(){return i()}).catch(function(r){t.logger.error(r);var i=["Reason: "+d.Utils.getReasonHeaderValue(488,"Bad Media Description")];throw t.bye(void 0,{extraHeaders:i}),t.failed(e.message,s.C.causes.BAD_MEDIA_DESCRIPTION),t.terminated(e.message,s.C.causes.BAD_MEDIA_DESCRIPTION),r});case o.SignalingState.HaveLocalOffer:case o.SignalingState.HaveRemoteOffer:case o.SignalingState.Closed:default:throw new Error("Invalid signaling state "+r.signalingState+".")}}else i()}else i()}else this.logger.error("ACK received while in state "+this.state+", dropping request")},t.prototype.onByeRequest=function(e){this.logger.log("Session.onByeRequest"),this.state===f.SessionState.Established?(e.accept(),this.stateTransition(f.SessionState.Terminated),this.status===c.SessionStatus.STATUS_CONFIRMED&&(this.emit("bye",e.message),this.terminated(e.message,s.C.BYE))):this.logger.error("BYE received while in state "+this.state+", dropping request")},t.prototype.onInfoRequest=function(e){if(this.logger.log("Session.onInfoRequest"),this.state===f.SessionState.Established)if(this.delegate&&this.delegate.onInfo){var t=new h.Info(e);this.delegate.onInfo(t)}else e.accept();else this.logger.error("INFO received while in state "+this.state+", dropping request")},t.prototype.onInviteRequest=function(e){var t=this;if(this.logger.log("Session.onInviteRequest"),this.state===f.SessionState.Established){if(e.message.hasHeader("P-Asserted-Identity")){var r=e.message.getHeader("P-Asserted-Identity");if(!r)throw new Error("Header undefined.");this.assertedIdentity=o.Grammar.nameAddrHeaderParse(r)}this.emit("reinvite",this,e.message);var i=["Contact: "+this.contact],n={sessionDescriptionHandlerOptions:this.sessionDescriptionHandlerOptions,sessionDescriptionHandlerModifiers:this.sessionDescriptionHandlerModifiers}
;this.generateResponseOfferAnswerInDialog(n).then(function(r){e.accept({statusCode:200,extraHeaders:i,body:r}),t.emit("reinviteAccepted",t),t.delegate&&t.delegate.onReinviteSuccess&&t.delegate.onReinviteSuccess()}).catch(function(r){t.logger.error(r.message),e.reject({statusCode:488}),t.emit("reinviteFailed",t),t.emit("renegotiationError",r),t.delegate&&t.delegate.onReinviteFailure?t.delegate.onReinviteFailure(r):(t.logger.error("A failure occurred processing re-INVITE request with no delegate, terminating session..."),t.bye(void 0,{extraHeaders:["Reason: "+d.Utils.getReasonHeaderValue(488,"Not Acceptable Here")]}))})}else this.logger.error("INVITE received while in state "+this.state+", dropping request")},t.prototype.onNotifyRequest=function(e){if(this.logger.log("Session.onNotifyRequest"),this.state===f.SessionState.Established)if(this.referrer&&this.referrer.delegate&&this.referrer.delegate.onNotify){var t=new l.Notification(e);this.referrer.delegate.onNotify(t)}else{if(this.delegate&&this.delegate.onNotify){t=new l.Notification(e);this.delegate.onNotify(t)}else e.accept();this.emit("notify",e.message)}else this.logger.error("NOTIFY received while in state "+this.state+", dropping request")},t.prototype.onPrackRequest=function(e){if(this.logger.log("Session.onPrackRequest"),this.state===f.SessionState.Established)throw new Error("Unimplemented.");this.logger.error("PRACK received while in state "+this.state+", dropping request")},t.prototype.onReferRequest=function(e){var t=this;if(this.logger.log("Session.onReferRequest"),this.state===f.SessionState.Established){if(this.status===c.SessionStatus.STATUS_CONFIRMED){if(!e.message.hasHeader("refer-to"))return this.logger.warn("Invalid REFER packet. A refer-to header is required. Rejecting."),void e.reject();var r=new g.Referral(e,this);this.delegate&&this.delegate.onRefer?this.delegate.onRefer(r):(this.logger.log("No delegate available to handle REFER, automatically accepting and following."),r.accept().then(function(){return r.makeInviter(t.passedOptions).invite()}).catch(function(e){t.logger.error(e.message)}))}}else this.logger.error("REFER received while in state "+this.state+", dropping request")},t.prototype.accepted=function(e,t){e instanceof o.IncomingResponseMessage&&(t=d.Utils.getReasonPhrase(e.statusCode||0,t)),this.startTime=new Date,this.replacee&&(this.replacee.emit("replaced",this),this.replacee.bye()),this.emit("accepted",e,t)},t.prototype.canceled=function(){this._sessionDescriptionHandler&&this._sessionDescriptionHandler.close(),this.emit("cancel")},t.prototype.connecting=function(e){this.emit("connecting",{request:e})},t.prototype.failed=function(e,t){this.status!==c.SessionStatus.STATUS_TERMINATED&&this.emit("failed",e,t)},t.prototype.rejected=function(e,t){this.emit("rejected",e,t)},t.prototype.terminated=function(e,t){this.status!==c.SessionStatus.STATUS_TERMINATED&&(this.endTime=new Date,this.close(),this.emit("terminated",e,t))},t.prototype.generateResponseOfferAnswer=function(e,t){if(this.dialog)return this.generateResponseOfferAnswerInDialog(t);var r=o.getBody(e.message);return r&&"session"===r.contentDisposition?this.setOfferAndGetAnswer(r,t):this.getOffer(t)},t.prototype.generateResponseOfferAnswerInDialog=function(e){if(!this.dialog)throw new Error("Dialog undefined.");switch(this.dialog.signalingState){case o.SignalingState.Initial:return this.getOffer(e);case o.SignalingState.Stable:case o.SignalingState.HaveLocalOffer:return Promise.resolve(void 0);case o.SignalingState.HaveRemoteOffer:if(!this.dialog.offer)throw new Error("Session offer undefined in signaling state "+this.dialog.signalingState+".");return this.setOfferAndGetAnswer(this.dialog.offer,e);case o.SignalingState.Closed:default:throw new Error("Invalid signaling state "+this.dialog.signalingState+".")}},t.prototype.getOffer=function(e){var t=this.setupSessionDescriptionHandler(),r=e.sessionDescriptionHandlerOptions,i=e.sessionDescriptionHandlerModifiers;return t.getDescription(r,i).then(function(e){return d.Utils.fromBodyObj(e)}).catch(function(e){throw e instanceof Error?e:new Error(e)})},t.prototype.setAnswer=function(e,t){var r=this.setupSessionDescriptionHandler(),i=t.sessionDescriptionHandlerOptions,n=t.sessionDescriptionHandlerModifiers;return r.hasDescription(e.contentType)?r.setDescription(e.content,i,n).catch(function(e){throw e instanceof Error?e:new Error(e)}):Promise.reject(new u.Exceptions.UnsupportedSessionDescriptionContentTypeError)},t.prototype.setOfferAndGetAnswer=function(e,t){var r=this.setupSessionDescriptionHandler(),i=t.sessionDescriptionHandlerOptions,n=t.sessionDescriptionHandlerModifiers;return r.hasDescription(e.contentType)?r.setDescription(e.content,i,n).then(function(){return r.getDescription(i,n)}).then(function(e){return d.Utils.fromBodyObj(e)}).catch(function(e){throw e instanceof Error?e:new Error(e)}):Promise.reject(new u.Exceptions.UnsupportedSessionDescriptionContentTypeError)},t.prototype.setSessionDescriptionHandler=function(e){if(this._sessionDescriptionHandler)throw new Error("Sessionn description handler defined.");this._sessionDescriptionHandler=e},t.prototype.setupSessionDescriptionHandler=function(){return this._sessionDescriptionHandler?this._sessionDescriptionHandler:(this._sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.userAgent.configuration.sessionDescriptionHandlerFactoryOptions),this.emit("SessionDescriptionHandler-created",this._sessionDescriptionHandler),this._sessionDescriptionHandler)},t.prototype.stateTransition=function(e){var t=this,r=function(){throw new Error("Invalid state transition from "+t._state+" to "+e)};switch(this._state){case f.SessionState.Initial:e!==f.SessionState.Establishing&&e!==f.SessionState.Established&&e!==f.SessionState.Terminating&&e!==f.SessionState.Terminated&&r();break;case f.SessionState.Establishing:e!==f.SessionState.Established&&e!==f.SessionState.Terminating&&e!==f.SessionState.Terminated&&r();break;case f.SessionState.Established:e!==f.SessionState.Terminating&&e!==f.SessionState.Terminated&&r();break;case f.SessionState.Terminating:e!==f.SessionState.Terminated&&r();break;case f.SessionState.Terminated:r();break;default:throw new Error("Unrecognized state.")}this._state=e,this.logger.log("Session "+this.id+" transitioned to state "+this._state),this._stateEventEmitter.emit("event",this._state)},t.C=c.SessionStatus,t}(n.EventEmitter);t.Session=m},function(e,t,r){"use strict";function i(e,t){return void 0===t&&(t="event"),{on:function(r){e.on(t,r)},off:function(r){e.removeListener(t,r)},once:function(r){e.once(t,r)}}}Object.defineProperty(t,"__esModule",{value:!0}),t.makeEmitter=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.incomingInfoRequest=e}return Object.defineProperty(e.prototype,"request",{get:function(){return this.incomingInfoRequest.message},enumerable:!0,configurable:!0}),e.prototype.accept=function(e){return this.incomingInfoRequest.accept(e),Promise.resolve()},e.prototype.reject=function(e){return this.incomingInfoRequest.reject(e),Promise.resolve()},e}();t.Info=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.incomingNotifyRequest=e}return Object.defineProperty(e.prototype,"request",{get:function(){return this.incomingNotifyRequest.message},enumerable:!0,configurable:!0}),e.prototype.accept=function(e){return this.incomingNotifyRequest.accept(e),Promise.resolve()},e.prototype.reject=function(e){return this.incomingNotifyRequest.reject(e),Promise.resolve()},e}();t.Notification=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(2),n=function(){function e(e,t){this.incomingReferRequest=e,this.session=t}return Object.defineProperty(e.prototype,"referTo",{get:function(){var e=this.incomingReferRequest.message.parseHeader("refer-to");if(!(e instanceof i.NameAddrHeader))throw new Error("Failed to parse Refer-To header.");return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"referredBy",{get:function(){return this.incomingReferRequest.message.getHeader("referred-by")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"replaces",{get:function(){return this.referTo.uri.getHeader("replaces")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"request",{get:function(){return this.incomingReferRequest.message},enumerable:!0,configurable:!0}),e.prototype.accept=function(e){return void 0===e&&(e={statusCode:202}),this.incomingReferRequest.accept(e),Promise.resolve()},e.prototype.reject=function(e){return this.incomingReferRequest.reject(e),Promise.resolve()},e.prototype.makeInviter=function(e){if(this.inviter)return this.inviter;var t=this.referTo.uri.clone();t.clearHeaders(),e=e||{};var r=(e.extraHeaders||[]).slice(),i=this.replaces;i&&r.push("Replaces: "+decodeURIComponent(i));var n=this.referredBy;return n&&r.push("Referred-By: "+n),e.extraHeaders=r,this.inviter=this.session.userAgent.makeInviter(t,e),this.inviter.referred=this.session,this.session.referral=this.inviter,this.inviter},e}();t.Referral=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Initial="Initial",e.Establishing="Establishing",e.Established="Established",e.Terminating="Terminating",e.Terminated="Terminated"}(t.SessionState||(t.SessionState={}))},function(e,t,r){"use strict";function i(e){return e.sdp=(e.sdp||"").replace(/^a=candidate:\d+ \d+ tcp .*?\r\n/gim,""),Promise.resolve(e)}function n(e){return e.sdp=d(e.sdp||"","telephone-event"),Promise.resolve(e)}function s(e){return e.sdp=(e.sdp||"").replace(/^(a=imageattr:.*?)(x|y)=\[0-/gm,"$1$2=[1:"),Promise.resolve(e)}function o(e){return e.sdp=d(e.sdp||"","G722"),Promise.resolve(e)}function a(e){return function(t){return t.sdp=d(t.sdp||"",e),Promise.resolve(t)}}function c(e){return e.sdp=p(e.sdp||"","video"),Promise.resolve(e)}function u(e){var t=e.sdp||"";if(-1===t.search(/^a=mid.*$/gm)){var r=t.match(/^m=.*$/gm),i=t.split(/^m=.*$/gm);r&&r.forEach(function(e,t){r[t]=e+"\na=mid:"+t}),i.forEach(function(e,t){r&&r[t]&&(i[t]=e+r[t])}),t=i.join(""),e.sdp=t}return Promise.resolve(e)}Object.defineProperty(t,"__esModule",{value:!0});var d=function(e,t){for(var r,i=[],n=e.split(/\r\n/),s=0;s<n.length;){var o=n[s];if(/^m=(?:audio|video)/.test(o))r={index:s,stripped:[]},i.push(r);else if(r){var a=/^a=rtpmap:(\d+) ([^/]+)\//.exec(o);if(a&&t===a[2]){n.splice(s,1),r.stripped.push(a[1]);continue}}s++}for(var c=0,u=i;c<u.length;c++){for(var d=u[c],p=n[d.index].split(" "),h=3;h<p.length;)-1===d.stripped.indexOf(p[h])?h++:p.splice(h,1);n[d.index]=p.join(" ")}return n.join("\r\n")},p=function(e,t){var r=new RegExp("m="+t+".*$","gm"),i=new RegExp("^a=group:.*$","gm");if(r.test(e)){var n;e=e.split(/^m=/gm).filter(function(e){if(e.substr(0,t.length)===t){if(n=e.match(/^a=mid:.*$/gm),n){var r=n[0].match(/:.+$/g);r&&(n=r[0].substr(1))}return!1}return!0}).join("m=");var s=e.match(i);if(s&&1===s.length){var o=s[0],a=new RegExp(" *"+n+"[^ ]*","g");o=o.replace(a,""),e=e.split(i).join(o)}}return e};t.stripTcpCandidates=i,t.stripTelephoneEvent=n,t.cleanJitsiSdpImageattr=s,t.stripG722=o,t.stripRtpPayload=a,t.stripVideo=c,t.addMidLines=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(80),n=function(){function e(e,t){this.type=i.TypeStrings.SessionDescriptionHandlerObserver,this.session=e,this.options=t}return e.prototype.trackAdded=function(){this.session.emit("trackAdded")},e.prototype.directionChanged=function(){this.session.emit("directionChanged")},e}();t.SessionDescriptionHandlerObserver=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=r(2),o=r(80),a=r(82),c=r(81);(function(e){e[e.STATUS_CONNECTING=0]="STATUS_CONNECTING",e[e.STATUS_OPEN=1]="STATUS_OPEN",e[e.STATUS_CLOSING=2]="STATUS_CLOSING",e[e.STATUS_CLOSED=3]="STATUS_CLOSED"})(i=t.TransportStatus||(t.TransportStatus={}));var u=function(e){var t=.8*e;return 1e3*(Math.random()*(e-t)+t)},d=function(e){function t(t,r){void 0===r&&(r={});var n=e.call(this,t,r)||this;return n.type=o.TypeStrings.Transport,n.reconnectionAttempts=0,n.status=i.STATUS_CONNECTING,n.configuration=n.loadConfig(r),n.server=n.configuration.wsServers[0],n}return n.__extends(t,e),t.prototype.isConnected=function(){return this.status===i.STATUS_OPEN},t.prototype.sendPromise=function(e,t){if(void 0===t&&(t={}),!this.statusAssert(i.STATUS_OPEN,t.force))return this.onError("unable to send message - WebSocket not open"),Promise.reject();var r=e.toString();return this.ws?(!0===this.configuration.traceSip&&this.logger.log("sending WebSocket message:\n\n"+r+"\n"),this.ws.send(r),Promise.resolve({msg:r})):(this.onError("unable to send message - WebSocket does not exist"),Promise.reject())},t.prototype.disconnectPromise=function(e){var t=this;return void 0===e&&(e={}),this.disconnectionPromise?this.disconnectionPromise:(e.code=e.code||1e3,this.statusTransition(i.STATUS_CLOSING,e.force)?(this.emit("disconnecting"),this.disconnectionPromise=new Promise(function(r,i){t.disconnectDeferredResolve=r,t.reconnectTimer&&(clearTimeout(t.reconnectTimer),t.reconnectTimer=void 0),t.ws?(t.stopSendingKeepAlives(),t.logger.log("closing WebSocket "+t.server.wsUri),t.ws.close(e.code,e.reason)):i("Attempted to disconnect but the websocket doesn't exist")}),this.disconnectionPromise):this.status===i.STATUS_CLOSED?Promise.resolve({overrideEvent:!0}):this.connectionPromise?this.connectionPromise.then(function(){return Promise.reject("The websocket did not disconnect")}).catch(function(){return Promise.resolve({overrideEvent:!0})}):Promise.reject("The websocket did not disconnect"))},t.prototype.connectPromise=function(e){var t=this;return void 0===e&&(e={}),this.status!==i.STATUS_CLOSING||e.force?this.connectionPromise?this.connectionPromise:(this.server=this.server||this.getNextWsServer(e.force),this.connectionPromise=new Promise(function(r,n){if((t.status===i.STATUS_OPEN||t.status===i.STATUS_CLOSING)&&!e.force)return t.logger.warn("WebSocket "+t.server.wsUri+" is already connected"),void n("Failed status check - attempted to open a connection but already open/closing");t.connectDeferredResolve=r,t.connectDeferredReject=n,t.status=i.STATUS_CONNECTING,t.emit("connecting"),t.logger.log("connecting to WebSocket "+t.server.wsUri),t.disposeWs();try{t.ws=new WebSocket(t.server.wsUri,"sip")}catch(e){return t.ws=null,t.statusTransition(i.STATUS_CLOSED,!0),t.onError("error connecting to WebSocket "+t.server.wsUri+":"+e),n("Failed to create a websocket"),t.connectDeferredResolve=void 0,void(t.connectDeferredReject=void 0)}if(!t.ws)return n("Unexpected instance websocket not set"),t.connectDeferredResolve=void 0,void(t.connectDeferredReject=void 0);t.connectionTimeout=setTimeout(function(){t.statusTransition(i.STATUS_CLOSED),t.logger.warn("took too long to connect - exceeded time set in configuration.connectionTimeout: "+t.configuration.connectionTimeout+"s"),t.emit("disconnected",{code:1e3}),t.connectionPromise=void 0,n("Connection timeout"),t.connectDeferredResolve=void 0,t.connectDeferredReject=void 0;var e=t.ws;t.disposeWs(),e.close(1e3)},1e3*t.configuration.connectionTimeout),t.boundOnOpen=t.onOpen.bind(t),t.boundOnMessage=t.onMessage.bind(t),t.boundOnClose=t.onClose.bind(t),t.boundOnError=t.onWebsocketError.bind(t),t.ws.addEventListener("open",t.boundOnOpen),t.ws.addEventListener("message",t.boundOnMessage),t.ws.addEventListener("close",t.boundOnClose),t.ws.addEventListener("error",t.boundOnError)}),this.connectionPromise):Promise.reject("WebSocket "+this.server.wsUri+" is closing")},t.prototype.onMessage=function(e){var t,r=e.data;if(/^(\r\n)+$/.test(r))return this.clearKeepAliveTimeout(),void(!0===this.configuration.traceSip&&this.logger.log("received WebSocket message with CRLF Keep Alive response"));if(r){if("string"!=typeof r){try{t=String.fromCharCode.apply(null,new Uint8Array(r))}catch(e){return void this.logger.warn("received WebSocket binary message failed to be converted into string, message discarded")}!0===this.configuration.traceSip&&this.logger.log("received WebSocket binary message:\n\n"+r+"\n")}else!0===this.configuration.traceSip&&this.logger.log("received WebSocket text message:\n\n"+r+"\n"),t=r;this.emit("message",t)}else this.logger.warn("received empty message, message discarded")},t.prototype.onOpen=function(){if(this.status===i.STATUS_CLOSED){var e=this.ws;return this.disposeWs(),void e.close(1e3)}this.statusTransition(i.STATUS_OPEN,!0),this.emit("connected"),this.connectionTimeout&&(clearTimeout(this.connectionTimeout),this.connectionTimeout=void 0),this.logger.log("WebSocket "+this.server.wsUri+" connected"),void 0!==this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=void 0),this.reconnectionAttempts=0,this.disconnectionPromise=void 0,this.disconnectDeferredResolve=void 0,this.startSendingKeepAlives(),this.connectDeferredResolve?(this.connectDeferredResolve({overrideEvent:!0}),this.connectDeferredResolve=void 0,this.connectDeferredReject=void 0):this.logger.warn("Unexpected websocket.onOpen with no connectDeferredResolve")},t.prototype.onClose=function(e){if(this.logger.log("WebSocket disconnected (code: "+e.code+(e.reason?"| reason: "+e.reason:"")+")"),this.status!==i.STATUS_CLOSING&&(this.logger.warn("WebSocket closed without SIP.js requesting it"),this.emit("transportError")),this.stopSendingKeepAlives(),this.connectionTimeout&&clearTimeout(this.connectionTimeout),this.connectDeferredReject&&this.connectDeferredReject("Websocket Closed"),this.connectionTimeout=void 0,this.connectionPromise=void 0,this.connectDeferredResolve=void 0,this.connectDeferredReject=void 0,this.disconnectDeferredResolve)return this.disconnectDeferredResolve({overrideEvent:!0}),this.statusTransition(i.STATUS_CLOSED),void(this.disconnectDeferredResolve=void 0);this.statusTransition(i.STATUS_CLOSED,!0),this.emit("disconnected",{code:e.code,reason:e.reason}),this.disposeWs(),this.reconnect()},t.prototype.disposeWs=function(){this.ws&&(this.ws.removeEventListener("open",this.boundOnOpen),this.ws.removeEventListener("message",this.boundOnMessage),this.ws.removeEventListener("close",this.boundOnClose),this.ws.removeEventListener("error",this.boundOnError),this.ws=void 0)},t.prototype.onError=function(e){this.logger.warn("Transport error: "+e),this.emit("transportError")},t.prototype.onWebsocketError=function(){this.onError("The Websocket had an error")},t.prototype.reconnect=function(){var e=this;if(this.reconnectionAttempts>0&&this.logger.log("Reconnection attempt "+this.reconnectionAttempts+" failed"),this.noAvailableServers())return this.logger.warn("attempted to get next ws server but there are no available ws servers left"),this.logger.warn("no available ws servers left - going to closed state"),this.statusTransition(i.STATUS_CLOSED,!0),this.emit("closed"),void this.resetServerErrorStatus();this.isConnected()&&(this.logger.warn("attempted to reconnect while connected - forcing disconnect"),this.disconnect({force:!0})),this.reconnectionAttempts+=1,this.reconnectionAttempts>this.configuration.maxReconnectionAttempts?(this.logger.warn("maximum reconnection attempts for WebSocket "+this.server.wsUri),this.logger.log("transport "+this.server.wsUri+" failed | connection state set to 'error'"),this.server.isError=!0,this.emit("transportError"),this.noAvailableServers()||(this.server=this.getNextWsServer()),this.reconnectionAttempts=0,this.reconnect()):(this.logger.log("trying to reconnect to WebSocket "+this.server.wsUri+" (reconnection attempt "+this.reconnectionAttempts+")"),this.reconnectTimer=setTimeout(function(){e.connect(),e.reconnectTimer=void 0},1===this.reconnectionAttempts?0:1e3*this.configuration.reconnectionTimeout))},t.prototype.resetServerErrorStatus=function(){for(var e=0,t=this.configuration.wsServers;e<t.length;e++){var r=t[e];r.isError=!1}},t.prototype.getNextWsServer=function(e){if(void 0===e&&(e=!1),this.noAvailableServers())throw this.logger.warn("attempted to get next ws server but there are no available ws servers left"),new Error("Attempted to get next ws server, but there are no available ws servers left.");for(var t=[],r=0,i=this.configuration.wsServers;r<i.length;r++){var n=i[r];n.isError&&!e||(0===t.length?t.push(n):n.weight>t[0].weight?t=[n]:n.weight===t[0].weight&&t.push(n))}var s=Math.floor(Math.random()*t.length);return t[s]},t.prototype.noAvailableServers=function(){for(var e=0,t=this.configuration.wsServers;e<t.length;e++){var r=t[e];if(!r.isError)return!1}return!0},t.prototype.sendKeepAlive=function(){var e=this;if(!this.keepAliveDebounceTimeout)return this.keepAliveDebounceTimeout=setTimeout(function(){e.emit("keepAliveDebounceTimeout"),e.clearKeepAliveTimeout()},1e3*this.configuration.keepAliveDebounce),this.send("\r\n\r\n")},t.prototype.clearKeepAliveTimeout=function(){this.keepAliveDebounceTimeout&&clearTimeout(this.keepAliveDebounceTimeout),this.keepAliveDebounceTimeout=void 0},t.prototype.startSendingKeepAlives=function(){var e=this;this.configuration.keepAliveInterval&&!this.keepAliveInterval&&(this.keepAliveInterval=setInterval(function(){e.sendKeepAlive(),e.startSendingKeepAlives()},u(this.configuration.keepAliveInterval)))},t.prototype.stopSendingKeepAlives=function(){this.keepAliveInterval&&clearInterval(this.keepAliveInterval),this.keepAliveDebounceTimeout&&clearTimeout(this.keepAliveDebounceTimeout),this.keepAliveInterval=void 0,this.keepAliveDebounceTimeout=void 0},t.prototype.statusAssert=function(e,t){return e===this.status||(t?(this.logger.warn("Attempted to assert "+Object.keys(i)[this.status]+" as "+Object.keys(i)[e]+"- continuing with option: 'force'"),!0):(this.logger.warn("Tried to assert "+Object.keys(i)[e]+" but is currently "+Object.keys(i)[this.status]),!1))},t.prototype.statusTransition=function(e,t){return void 0===t&&(t=!1),this.logger.log("Attempting to transition status from "+Object.keys(i)[this.status]+" to "+Object.keys(i)[e]),e===i.STATUS_CONNECTING&&this.statusAssert(i.STATUS_CLOSED,t)||e===i.STATUS_OPEN&&this.statusAssert(i.STATUS_CONNECTING,t)||e===i.STATUS_CLOSING&&this.statusAssert(i.STATUS_OPEN,t)||e===i.STATUS_CLOSED?(this.status=e,!0):(this.logger.warn("Status transition failed - result: no-op - reason: either gave an nonexistent status or attempted illegal transition"),!1)},t.prototype.loadConfig=function(e){var t={wsServers:[{scheme:"WSS",sipUri:"<sip:edge.sip.onsip.com;transport=ws;lr>",weight:0,wsUri:"wss://edge.sip.onsip.com",isError:!1}],connectionTimeout:3,maxReconnectionAttempts:0,reconnectionTimeout:0,keepAliveInterval:0,keepAliveDebounce:0,traceSip:!1},r=this.getConfigurationCheck();for(var i in r.mandatory){if(!e.hasOwnProperty(i))throw new a.Exceptions.ConfigurationError(i);var n=e[i],s=r.mandatory[i](n);if(void 0===s)throw new a.Exceptions.ConfigurationError(i,n);t[i]=s}for(var i in r.optional)if(e.hasOwnProperty(i)){n=e[i];if(n instanceof Array&&0===n.length||null===n||""===n||void 0===n||"number"==typeof n&&isNaN(n))continue;s=r.optional[i](n);if(void 0===s)throw new a.Exceptions.ConfigurationError(i,n);t[i]=s}var o={};for(var i in t)t.hasOwnProperty(i)&&(o[i]={value:t[i]});var c=Object.defineProperties({},o);for(var i in this.logger.log("configuration parameters after validation:"),t)t.hasOwnProperty(i)&&this.logger.log("¬∑ "+i+": "+JSON.stringify(t[i]));return c},t.prototype.getConfigurationCheck=function(){return{mandatory:{},optional:{wsServers:function(e){if("string"==typeof e)e=[{wsUri:e}];else{if(!(e instanceof Array))return;for(var t=0;t<e.length;t++)"string"==typeof e[t]&&(e[t]={wsUri:e[t]})}if(0===e.length)return!1;for(var r=0,i=e;r<i.length;r++){var n=i[r];if(!n.wsUri)return;if(n.weight&&!Number(n.weight))return;var o=s.Grammar.parse(n.wsUri,"absoluteURI");if(-1===o)return;if(["wss","ws","udp"].indexOf(o.scheme)<0)return;n.sipUri="<sip:"+o.host+(o.port?":"+o.port:"")+";transport="+o.scheme.replace(/^wss$/i,"ws")+";lr>",n.weight||(n.weight=0),n.isError=!1,n.scheme=o.scheme.toUpperCase()}return e},keepAliveInterval:function(e){if(c.Utils.isDecimal(e)){var t=Number(e);if(t>0)return t}},keepAliveDebounce:function(e){if(c.Utils.isDecimal(e)){var t=Number(e);if(t>0)return t}},traceSip:function(e){if("boolean"==typeof e)return e},connectionTimeout:function(e){if(c.Utils.isDecimal(e)){var t=Number(e);if(t>0)return t}},maxReconnectionAttempts:function(e){if(c.Utils.isDecimal(e)){var t=Number(e);if(t>=0)return t}},reconnectionTimeout:function(e){if(c.Utils.isDecimal(e)){var t=Number(e);if(t>0)return t}}}}},t.C=i,t}(s.Transport);t.Transport=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=i.__importStar(r(99));t.Modifiers=n;var s=r(103);t.Simple=s.Simple;var o=r(92);t.SessionDescriptionHandler=o.SessionDescriptionHandler;var a=r(101);t.Transport=a.Transport},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=r(30),o=r(91),a=n.__importStar(r(99));(function(e){e[e.STATUS_NULL=0]="STATUS_NULL",e[e.STATUS_NEW=1]="STATUS_NEW",e[e.STATUS_CONNECTING=2]="STATUS_CONNECTING",e[e.STATUS_CONNECTED=3]="STATUS_CONNECTED",e[e.STATUS_COMPLETED=4]="STATUS_COMPLETED"})(i=t.SimpleStatus||(t.SimpleStatus={}));var c=function(e){function t(t){var r=e.call(this)||this;if(t.media.remote.video?r.video=!0:r.video=!1,t.media.remote.audio?r.audio=!0:r.audio=!1,!r.audio&&!r.video)throw new Error("At least one remote audio or video element is required for Simple.");r.options=t;var n=navigator.userAgent.toLowerCase(),s=!1,c=!1;n.indexOf("safari")>-1&&n.indexOf("chrome")<0?s=!0:n.indexOf("firefox")>-1&&n.indexOf("chrome")<0&&(c=!0);var u={};return s&&(u.modifiers=[a.stripG722]),c&&(u.alwaysAcquireMediaFirst=!0),r.options.ua.uri?r.anonymous=!1:r.anonymous=!0,r.ua=new o.UA({uri:r.options.ua.uri,authorizationUser:r.options.ua.authorizationUser,password:r.options.ua.password,displayName:r.options.ua.displayName,userAgentString:r.options.ua.userAgentString,register:!0,sessionDescriptionHandlerFactoryOptions:u,transportOptions:{traceSip:r.options.ua.traceSip,wsServers:r.options.ua.wsServers}}),r.state=i.STATUS_NULL,r.logger=r.ua.getLogger("sip.simple"),r.ua.on("registered",function(){r.emit("registered",r.ua)}),r.ua.on("unregistered",function(){r.emit("unregistered",r.ua)}),r.ua.on("registrationFailed",function(){r.emit("unregistered",r.ua)}),r.ua.on("invite",function(e){if(r.state!==i.STATUS_NULL&&r.state!==i.STATUS_COMPLETED)return r.logger.warn("Rejecting incoming call. Simple only supports 1 call at a time"),void e.reject();r.session=e,r.setupSession(),r.emit("ringing",r.session)}),r.ua.on("message",function(e){r.emit("message",e)}),r}return n.__extends(t,e),t.prototype.call=function(e){if(this.ua&&this.checkRegistration()){if(this.state===i.STATUS_NULL||this.state===i.STATUS_COMPLETED)return this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.autoplay=!0,this.options.media.local.video.volume=0),this.session=this.ua.invite(e,{sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}}),this.setupSession(),this.session;this.logger.warn("Cannot make more than a single call with Simple")}else this.logger.warn("A registered UA is required for calling")},t.prototype.answer=function(){if(this.state===i.STATUS_NEW||this.state===i.STATUS_CONNECTING)return this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.session.accept({sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}});this.logger.warn("No call to answer")},t.prototype.reject=function(){if(this.state===i.STATUS_NEW||this.state===i.STATUS_CONNECTING)return this.session.reject();this.logger.warn("Call is already answered")},t.prototype.hangup=function(){if(this.state===i.STATUS_CONNECTED||this.state===i.STATUS_CONNECTING||this.state===i.STATUS_NEW)return this.state!==i.STATUS_CONNECTED?this.session.cancel():this.session?this.session.bye():void 0;this.logger.warn("No active call to hang up on")},t.prototype.hold=function(){if(this.state===i.STATUS_CONNECTED&&this.session&&!this.session.localHold)return this.mute(),this.logger.log("Placing session on hold"),this.session.hold();this.logger.warn("Cannot put call on hold")},t.prototype.unhold=function(){if(this.state===i.STATUS_CONNECTED&&this.session&&this.session.localHold)return this.unmute(),this.logger.log("Placing call off hold"),this.session.unhold();this.logger.warn("Cannot unhold a call that is not on hold")},t.prototype.mute=function(){this.state===i.STATUS_CONNECTED?(this.logger.log("Muting Audio"),this.toggleMute(!0),this.emit("mute",this)):this.logger.warn("An acitve call is required to mute audio")},t.prototype.unmute=function(){this.state===i.STATUS_CONNECTED?(this.logger.log("Unmuting Audio"),this.toggleMute(!1),this.emit("unmute",this)):this.logger.warn("An active call is required to unmute audio")},t.prototype.sendDTMF=function(e){this.state===i.STATUS_CONNECTED&&this.session?(this.logger.log("Sending DTMF tone: "+e),this.session.dtmf(e)):this.logger.warn("An active call is required to send a DTMF tone")},t.prototype.message=function(e,t){this.ua&&this.checkRegistration()?e&&t?this.ua.message(e,t):this.logger.warn("A destination and message are required to send a message"):this.logger.warn("A registered UA is required to send a message")},t.prototype.checkRegistration=function(){return this.anonymous||this.ua&&this.ua.isRegistered()},t.prototype.setupRemoteMedia=function(){var e=this;if(this.session){var t,r=this.session.sessionDescriptionHandler.peerConnection;r.getReceivers?(t=new MediaStream,r.getReceivers().forEach(function(e){var r=e.track;r&&t.addTrack(r)})):t=r.getRemoteStreams()[0],this.video?(this.options.media.remote.video.srcObject=t,this.options.media.remote.video.play().catch(function(){e.logger.log("play was rejected")})):this.audio&&(this.options.media.remote.audio.srcObject=t,this.options.media.remote.audio.play().catch(function(){e.logger.log("play was rejected")}))}else this.logger.warn("No session to set remote media on")},t.prototype.setupLocalMedia=function(){if(this.session){if(this.video&&this.options.media.local&&this.options.media.local.video){var e,t=this.session.sessionDescriptionHandler.peerConnection;t.getSenders?(e=new MediaStream,t.getSenders().forEach(function(t){var r=t.track;r&&"video"===r.kind&&e.addTrack(r)})):e=t.getLocalStreams()[0],this.options.media.local.video.srcObject=e,this.options.media.local.video.volume=0,this.options.media.local.video.play()}}else this.logger.warn("No session to set local media on")},t.prototype.cleanupMedia=function(){this.video&&(this.options.media.remote.video.srcObject=null,this.options.media.remote.video.pause(),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.srcObject=null,this.options.media.local.video.pause())),this.audio&&(this.options.media.remote.audio.srcObject=null,this.options.media.remote.audio.pause())},t.prototype.setupSession=function(){var e=this;this.session?(this.state=i.STATUS_NEW,this.emit("new",this.session),this.session.on("progress",function(){return e.onProgress()}),this.session.on("accepted",function(){return e.onAccepted()}),this.session.on("rejected",function(){return e.onEnded()}),this.session.on("failed",function(){return e.onFailed()}),this.session.on("terminated",function(){return e.onEnded()})):this.logger.warn("No session to set up")},t.prototype.destroyMedia=function(){this.session&&this.session.sessionDescriptionHandler&&this.session.sessionDescriptionHandler.close()},t.prototype.toggleMute=function(e){if(this.session){var t=this.session.sessionDescriptionHandler.peerConnection
;t.getSenders?t.getSenders().forEach(function(t){t.track&&(t.track.enabled=!e)}):t.getLocalStreams().forEach(function(t){t.getAudioTracks().forEach(function(t){t.enabled=!e}),t.getVideoTracks().forEach(function(t){t.enabled=!e})})}else this.logger.warn("No session to toggle mute")},t.prototype.onAccepted=function(){var e=this;this.session?(this.state=i.STATUS_CONNECTED,this.emit("connected",this.session),this.setupLocalMedia(),this.setupRemoteMedia(),this.session.sessionDescriptionHandler&&(this.session.sessionDescriptionHandler.on("addTrack",function(){e.logger.log("A track has been added, triggering new remoteMedia setup"),e.setupRemoteMedia()}),this.session.sessionDescriptionHandler.on("addStream",function(){e.logger.log("A stream has been added, trigger new remoteMedia setup"),e.setupRemoteMedia()})),this.session.on("dtmf",function(t,r){e.emit("dtmf",r.tone)}),this.session.on("bye",function(){return e.onEnded()})):this.logger.warn("No session for accepting")},t.prototype.onProgress=function(){this.state=i.STATUS_CONNECTING,this.emit("connecting",this.session)},t.prototype.onFailed=function(){this.onEnded()},t.prototype.onEnded=function(){this.state=i.STATUS_COMPLETED,this.emit("ended",this.session),this.cleanupMedia()},t.C=i,t}(s.EventEmitter);t.Simple=c},function(e,t,r){"use strict";var i=null,n=null,s=r(91),o=r(79);t.cxWebPhone=function(e){let t={uri:"sip:"+e.userName+`@${e.server}`,authorizationUser:e.userName,password:e.password,displayName:e.userName,log:{builtinEnabled:e.builtinEnabled,level:3},rel100:o.C.supported.SUPPORTED,transportOptions:{wsServers:[`wss://${e.server}:7443`],traceSip:e.traceSip},hackWssInTransport:!0,hackIpInContact:e.server,registerOptions:{expires:60},contactName:e.userName};return i=document.getElementById(e.audioElement),n=new s.UA(t),n.transport.on("connecting",function(){e.ua.connecting&&e.ua.connecting({statusCode:200},"ua.connecting")}),n.transport.on("connected",function(){e.ua.connected&&e.ua.connected({statusCode:200},"ua.connected")}),n.transport.on("disconnecting",function(){e.ua.disconnecting&&e.ua.disconnecting({statusCode:200},"ua.disconnecting")}),n.transport.on("disconnected",function(){e.ua.disconnected&&e.ua.disconnected({statusCode:200},"ua.disconnected")}),n.on("registered",function(){e.ua.registered&&e.ua.registered({reasonPhrase:"OK",statusCode:200},"ua.registered")}),n.on("unregistered",function(t,r){e.ua.unregister&&e.ua.unregister(t,r,"ua.unregister")}),n.on("registrationFailed",function(t,r){e.ua.registrationFailed&&e.ua.registrationFailed(t,r,"ua.registrationFailed")}),n.on("invite",function(t){t.answer=(()=>{t.accept({sessionDescriptionHandlerOptions:{constraints:{audio:!0,video:!1}}})}),n.hangup=(()=>{t&&(t.startTime?t.bye():t.reject?t.reject():t.cancel&&t.cancel())}),t.on("progress",function(t){e.in.progress&&e.in.progress(t,"in.progress")}),t.on("failed",function(t,r){e.in.failed&&e.in.failed(t,r,"in.failed")}),t.on("rejected",function(t,r){e.in.rejected&&e.in.rejected(t,r,"in.rejected")}),t.on("cancel",function(){e.in.cancel&&e.in.cancel({statusCode:200},"in.cancel")}),t.on("terminated",function(t,r){e.in.terminated&&e.in.terminated(t,r,"in.terminated")}),t.on("accepted",function(t,r){var n,s=this.sessionDescriptionHandler.peerConnection;s.getReceivers?(n=new window.MediaStream,s.getReceivers().forEach(function(e){var t=e.track;t&&n.addTrack(t)})):n=s.getRemoteStreams()[0],i.srcObject=n,e.in.accepted&&e.in.accepted(t,r,"in.accepted")}),t.on("bye",function(t,r){e.in.bye&&e.in.bye(t,r,"in.bye")}),e.ua.invite&&e.ua.invite(t,"ua.invite")}),n},t.callWebPhone=function(e){let t=n.invite(e.phoneNumber,{sessionDescriptionHandlerOptions:{constraints:{audio:!0,video:!1},alwaysAcquireMediaFirst:!0}});n.hangup=(()=>{t&&(t.startTime?t.bye():t.reject?t.reject():t.cancel&&t.cancel())}),n.dtmf=((e,r={})=>{t.dtmf(e,r)}),t.on("dtmf",function(t,r){e.out.dtmf&&e.out.dtmf(t,r,"out.dtmf")}),t.on("progress",function(r,n){if(100!=r.statusCode){t.sessionDescriptionHandler.setDescription(r.body,t.sessionDescriptionHandlerOptions,t.modifiers).catch(function(e){t.logger.warn(e),t.failed(r,C.causes.BAD_MEDIA_DESCRIPTION),t.acceptAndTerminate({status_code:488,reason_phrase:"Bad Media Description"})});var s,o=this.sessionDescriptionHandler.peerConnection;o.getReceivers?(s=new window.MediaStream,o.getReceivers().forEach(function(e){var t=e.track;t&&s.addTrack(t)})):s=o.getRemoteStreams()[0],i.srcObject=s,e.out.progress&&e.out.progress(r,n,"out.progress")}}),t.on("accepted",function(t,r){var n,s=this.sessionDescriptionHandler.peerConnection;s.getReceivers?(n=new window.MediaStream,s.getReceivers().forEach(function(e){var t=e.track;t&&n.addTrack(t)})):n=s.getRemoteStreams()[0],i.srcObject=n,e.out.accepted&&e.out.accepted(t,r,"out.accepted")}),t.on("rejected",function(t,r){e.out.rejected&&e.out.rejected(t,r,"out.rejected")}),t.on("failed",function(t,r){e.out.failed&&e.out.failed(t,r,"out.failed")}),t.on("terminated",function(t,r){e.out.terminated&&e.out.terminated(t,r,"out.terminated")}),t.on("bye",function(t,r){e.out.bye&&e.out.bye(t,r,"out.bye")})}}])});